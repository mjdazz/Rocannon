SYNOPSIS                   *fortios_system_virtual_wan_link*

     • This module is able to configure a FortiGate or FortiOS (FOS) device by allowing the user to set and modify system feature and virtual_wan_link category. Examples include all parameters and
       values need to be adjusted to datasources before usage. Tested with FOS v6.0.5

REQUIREMENTS                   *fortios_system_virtual_wan_link-requirements*

   The below requirements are needed on the host that executes this module.

     • fortiosapi>=0.9.8

PARAMETERS                   *fortios_system_virtual_wan_link-parameters*

              Parameter                Choices/Defaults                                                                      Comments
   host                                                      FortiOS or FortiGate IP address.
   string
   https                             Choices:
   boolean                           • no                    Indicates if the requests towards FortiGate must use HTTPS protocol.
                                     • yes ←
   password                        Default:                  FortiOS or FortiGate password.
   string                          ""
   ssl_verify                        Choices:
   boolean                           • no                    Ensures FortiGate certificate must be verified by a proper CA.
   added in 2.9                      • yes ←
   system_virtual_wan_link         Default:                  Configure redundant internet connections using SD-WAN (formerly virtual WAN link).
   dictionary                      null
    fail_alert_interfaces                                    Physical interfaces that will be alerted.
    list
     name                                                    Physical interface name. Source system.interface.name.
     string / required
    fail_detect                      Choices:
    string                           • enable                Enable/disable SD-WAN Internet connection status checking (failure detection).
                                     • disable
    health_check                                             SD-WAN status checking or health checking. Identify a server on the Internet and determine how SD-WAN verifies that the FortiGate can
    list                                                     communicate with it.
     addr_mode                       Choices:
     string                          • ipv4                  Address mode (IPv4 or IPv6).
                                     • ipv6
     failtime                                                Number of failures before server is considered lost (1 - 3600).
     integer
     http_agent                                              String in the http-agent field in the HTTP header.
     string
     http_get                                                URL used to communicate with the server if the protocol if the protocol is HTTP.
     string
     http_match                                              Response string expected from the server if the protocol is HTTP.
     string
     interval                                                Status check interval, or the time between attempting to connect to the server (1 - 3600 sec).
     integer
     members                                                 Member sequence number list.
     list
            seq_num                                          Member sequence number. Source system.virtual-wan-link.members.seq-num.
            integer
     name                                                    Status check or health check name.
     string / required
     packet_size                                             Packet size of a twamp test session,
     integer
     password                                                Twamp controller password in authentication mode
     string
     port                                                    Port number used to communicate with the server over the selected protocol.
     integer
                                     Choices:
                                     • ping
     protocol                        • tcp-echo
     string                          • udp-echo              Protocol used to determine if the FortiGate can communicate with the server.
                                     • http
                                     • twamp
                                     • ping6
     recoverytime                                            Number of successful responses received before server is considered recovered (1 - 3600).
     integer
     security_mode                   Choices:
     string                          • none                  Twamp controller security mode.
                                     • authentication
     server                                                  IP address or FQDN name of the server.
     string
     sla                                                     Service level agreement (SLA).
     list
            id                                               SLA ID.
            integer / required
            jitter_threshold                                 Jitter for SLA to make decision in milliseconds. (0 - 10000000).
            integer
            latency_threshold                                Latency for SLA to make decision in milliseconds. (0 - 10000000).
            integer
                                     Choices:
            link_cost_factor         • latency               Criteria on which to base link selection.
            string                   • jitter
                                     • packet-loss
            packetloss_threshold                             Packet loss for SLA to make decision in percentage. (0 - 100).
            integer
     threshold_alert_jitter                                  Alert threshold for jitter (ms).
     integer
     threshold_alert_latency                                 Alert threshold for latency (ms).
     integer
     threshold_alert_packetloss                              Alert threshold for packet loss (percentage).
     integer
     threshold_warning_jitter                                Warning threshold for jitter (ms).
     integer
     threshold_warning_latency                               Warning threshold for latency (ms).
     integer
     threshold_warning_packetloss                            Warning threshold for packet loss (percentage).
     integer
     update_cascade_interface        Choices:
     string                          • enable                Enable/disable update cascade interface.
                                     • disable
     update_static_route             Choices:
     string                          • enable                Enable/disable updating the static route.
                                     • disable
                                     Choices:
                                     • source-ip-based
    load_balance_mode                • weight-based          Algorithm or mode to use for load balancing Internet traffic to SD-WAN members.
    string                           • usage-based
                                     • source-dest-ip-based
                                     • measured-volume-based
    members                                                  Physical FortiGate interfaces added to the virtual-wan-link.
    list
     comment                                                 Comments.
     string
     gateway                                                 The default gateway for this interface. Usually the default gateway of the Internet service provider that this interface is connected
     string                                                  to.
     gateway6                                                IPv6 gateway.
     string
     ingress_spillover_threshold                             Ingress spillover threshold for this interface (0 - 16776000 kbit/s). When this traffic volume threshold is reached, new sessions spill
     integer                                                 over to other interfaces in the SD-WAN.
     interface                                               Interface name. Source system.interface.name.
     string
     priority                                                Priority of the interface (0 - 4294967295). Used for SD-WAN rules or priority rules.
     integer
     seq_num                                                 Sequence number(1-255).
     integer
     source                                                  Source IP address used in the health-check packet to the server.
     string
     source6                                                 Source IPv6 address used in the health-check packet to the server.
     string
     spillover_threshold                                     Egress spillover threshold for this interface (0 - 16776000 kbit/s). When this traffic volume threshold is reached, new sessions spill
     integer                                                 over to other interfaces in the SD-WAN.
     status                          Choices:
     string                          • disable               Enable/disable this interface in the SD-WAN.
                                     • enable
     volume_ratio                                            Measured volume ratio (this value / sum of all values = percentage of link volume, 0 - 255).
     integer
     weight                                                  Weight of this interface for weighted load balancing. (0 - 255) More traffic is directed to interfaces with higher weights.
     integer
    service                                                  Create SD-WAN rules or priority rules (also called services) to control how sessions are distributed to physical interfaces in the
    list                                                     SD-WAN.
     addr_mode                       Choices:
     string                          • ipv4                  Address mode (IPv4 or IPv6).
                                     • ipv6
     bandwidth_weight                                        Coefficient of reciprocal of available bidirectional bandwidth in the formula of custom-profile-1.
     integer
     default                         Choices:
     string                          • enable                Enable/disable use of SD-WAN as default service.
                                     • disable
     dscp_forward                    Choices:
     string                          • enable                Enable/disable forward traffic DSCP tag.
                                     • disable
     dscp_forward_tag                                        Forward traffic DSCP tag.
     string
     dscp_reverse                    Choices:
     string                          • enable                Enable/disable reverse traffic DSCP tag.
                                     • disable
     dscp_reverse_tag                                        Reverse traffic DSCP tag.
     string
     dst                                                     Destination address name.
     list
            name                                             Address or address group name. Source firewall.address.name firewall.addrgrp.name.
            string / required
     dst6                                                    Destination address6 name.
     list
            name                                             Address6 or address6 group name. Source firewall.address6.name firewall.addrgrp6.name.
            string / required
     dst_negate                      Choices:
     string                          • enable                Enable/disable negation of destination address match.
                                     • disable
     end_port                                                End destination port number.
     integer
     gateway                         Choices:
     string                          • enable                Enable/disable SD-WAN service gateway.
                                     • disable
     groups                                                  User groups.
     list
            name                                             Group name. Source user.group.name.
            string / required
     health_check                                            Health check. Source system.virtual-wan-link.health-check.name.
     string
     hold_down_time                                          Waiting period in seconds when switching from the back-up member to the primary member (0 - 10000000).
     integer
     id                                                      Priority rule ID (1 - 4000).
     integer / required
     input_device                                            Source interface name.
     list
            name                                             Interface name. Source system.interface.name.
            string / required
     internet_service                Choices:
     string                          • enable                Enable/disable use of Internet service for application-based load balancing.
                                     • disable
     internet_service_ctrl                                   Control-based Internet Service ID list.
     list
            id                                               Control-based Internet Service ID.
            integer / required
     internet_service_ctrl_group                             Control-based Internet Service group list.
     list
            name                                             Control-based Internet Service group name. Source application.group.name.
            string / required
     internet_service_custom                                 Custom Internet service name list.
     list
            name                                             Custom Internet service name. Source firewall.internet-service-custom.name.
            string / required
     internet_service_custom_group                           Custom Internet Service group list.
     list
            name                                             Custom Internet Service group name. Source firewall.internet-service-custom-group.name.
            string / required
     internet_service_group                                  Internet Service group list.
     list
            name                                             Internet Service group name. Source firewall.internet-service-group.name.
            string / required
     internet_service_id                                     Internet service ID list.
     list
            id                                               Internet service ID. Source firewall.internet-service.id.
            integer / required
     jitter_weight                                           Coefficient of jitter in the formula of custom-profile-1.
     integer
     latency_weight                                          Coefficient of latency in the formula of custom-profile-1.
     integer
                                     Choices:
                                     • latency
                                     • jitter
     link_cost_factor                • packet-loss           Link cost factor.
     string                          • inbandwidth
                                     • outbandwidth
                                     • bibandwidth
                                     • custom-profile-1
     link_cost_threshold                                     Percentage threshold change of link cost values that will result in policy route regeneration (0 - 10000000).
     integer
     member                                                  Member sequence number.
     integer
                                     Choices:
     mode                            • auto
     string                          • manual                Control how the priority rule sets the priority of interfaces in the SD-WAN.
                                     • priority
                                     • sla
     name                                                    Priority rule name.
     string
     packet_loss_weight                                      Coefficient of packet-loss in the formula of custom-profile-1.
     integer
     priority_members                                        Member sequence number list.
     list
            seq_num                                          Member sequence number. Source system.virtual-wan-link.members.seq-num.
            integer
     protocol                                                Protocol number.
     integer
     quality_link                                            Quality grade.
     integer
     route_tag                                               IPv4 route map route-tag.
     integer
     sla                                                     Service level agreement (SLA).
     list
            health_check                                     Virtual WAN Link health-check. Source system.virtual-wan-link.health-check.name.
            string
            id                                               SLA ID.
            integer
     src                                                     Source address name.
     list
            name                                             Address or address group name. Source firewall.address.name firewall.addrgrp.name.
            string / required
     src6                                                    Source address6 name.
     list
            name                                             Address6 or address6 group name. Source firewall.address6.name firewall.addrgrp6.name.
            string / required
     src_negate                      Choices:
     string                          • enable                Enable/disable negation of source address match.
                                     • disable
     start_port                                              Start destination port number.
     integer
     status                          Choices:
     string                          • enable                Enable/disable SD-WAN service.
                                     • disable
     tos                                                     Type of service bit pattern.
     string
     tos_mask                                                Type of service evaluated bits.
     string
     users                                                   User name.
     list
            name                                             User name. Source user.local.name.
            string / required
    status                           Choices:
    string                           • disable               Enable/disable SD-WAN.
                                     • enable
   username                                                  FortiOS or FortiGate username.
   string
   vdom                            Default:                  Virtual domain, among those defined previously. A vdom is a virtual instance of the FortiGate that can be configured and used as a
   string                          "root"                    different unit.

NOTES                   *fortios_system_virtual_wan_link-notes*

   Note

     • Requires fortiosapi library developed by Fortinet
     • Run as a local_action in your playbook

EXAMPLES                   *fortios_system_virtual_wan_link-examples*

 - hosts: localhost
   vars:
    host: "192.168.122.40"
    username: "admin"
    password: ""
    vdom: "root"
    ssl_verify: "False"
   tasks:
   - name: Configure redundant internet connections using SD-WAN (formerly virtual WAN link).
     fortios_system_virtual_wan_link:
       host:  "{{ host }}"
       username: "{{ username }}"
       password: "{{ password }}"
       vdom:  "{{ vdom }}"
       https: "False"
       system_virtual_wan_link:
         fail_alert_interfaces:
          -
             name: "default_name_4 (source system.interface.name)"
         fail_detect: "enable"
         health_check:
          -
             addr_mode: "ipv4"
             failtime: "8"
             http_agent: "<your_own_value>"
             http_get: "<your_own_value>"
             http_match: "<your_own_value>"
             interval: "12"
             members:
              -
                 seq_num: "14 (source system.virtual-wan-link.members.seq-num)"
             name: "default_name_15"
             packet_size: "16"
             password: "<your_own_value>"
             port: "18"
             protocol: "ping"
             recoverytime: "20"
             security_mode: "none"
             server: "192.168.100.40"
             sla:
              -
                 id:  "24"
                 jitter_threshold: "25"
                 latency_threshold: "26"
                 link_cost_factor: "latency"
                 packetloss_threshold: "28"
             threshold_alert_jitter: "29"
             threshold_alert_latency: "30"
             threshold_alert_packetloss: "31"
             threshold_warning_jitter: "32"
             threshold_warning_latency: "33"
             threshold_warning_packetloss: "34"
             update_cascade_interface: "enable"
             update_static_route: "enable"
         load_balance_mode: "source-ip-based"
         members:
          -
             comment: "Comments."
             gateway: "<your_own_value>"
             gateway6: "<your_own_value>"
             ingress_spillover_threshold: "42"
             interface: "<your_own_value> (source system.interface.name)"
             priority: "44"
             seq_num: "45"
             source: "<your_own_value>"
             source6: "<your_own_value>"
             spillover_threshold: "48"
             status: "disable"
             volume_ratio: "50"
             weight: "51"
         service:
          -
             addr_mode: "ipv4"
             bandwidth_weight: "54"
             default: "enable"
             dscp_forward: "enable"
             dscp_forward_tag: "<your_own_value>"
             dscp_reverse: "enable"
             dscp_reverse_tag: "<your_own_value>"
             dst:
              -
                 name: "default_name_61 (source firewall.address.name firewall.addrgrp.name)"
             dst_negate: "enable"
             dst6:
              -
                 name: "default_name_64 (source firewall.address6.name firewall.addrgrp6.name)"
             end_port: "65"
             gateway: "enable"
             groups:
              -
                 name: "default_name_68 (source user.group.name)"
             health_check: "<your_own_value> (source system.virtual-wan-link.health-check.name)"
             hold_down_time: "70"
             id:  "71"
             input_device:
              -
                 name: "default_name_73 (source system.interface.name)"
             internet_service: "enable"
             internet_service_ctrl:
              -
                 id:  "76"
             internet_service_ctrl_group:
              -
                 name: "default_name_78 (source application.group.name)"
             internet_service_custom:
              -
                 name: "default_name_80 (source firewall.internet-service-custom.name)"
             internet_service_custom_group:
              -
                 name: "default_name_82 (source firewall.internet-service-custom-group.name)"
             internet_service_group:
              -
                 name: "default_name_84 (source firewall.internet-service-group.name)"
             internet_service_id:
              -
                 id:  "86 (source firewall.internet-service.id)"
             jitter_weight: "87"
             latency_weight: "88"
             link_cost_factor: "latency"
             link_cost_threshold: "90"
             member: "91"
             mode: "auto"
             name: "default_name_93"
             packet_loss_weight: "94"
             priority_members:
              -
                 seq_num: "96 (source system.virtual-wan-link.members.seq-num)"
             protocol: "97"
             quality_link: "98"
             route_tag: "99"
             sla:
              -
                 health_check: "<your_own_value> (source system.virtual-wan-link.health-check.name)"
                 id:  "102"
             src:
              -
                 name: "default_name_104 (source firewall.address.name firewall.addrgrp.name)"
             src_negate: "enable"
             src6:
              -
                 name: "default_name_107 (source firewall.address6.name firewall.addrgrp6.name)"
             start_port: "108"
             status: "enable"
             tos: "<your_own_value>"
             tos_mask: "<your_own_value>"
             users:
              -
                 name: "default_name_113 (source user.local.name)"
         status: "disable"

RETURN VALUES                   *fortios_system_virtual_wan_link-return values*

   Common return values are documented here, the following are the fields unique to this module:

       Key     Returned                                                                                  Description
   build                Build number of the fortigate image
   string      always   Sample:
                        1547
   http_method          Last method used to provision the content into FortiGate
   string      always   Sample:
                        PUT
   http_status          Last result given by FortiGate on last operation applied
   string      always   Sample:
                        200
   mkey                 Master key (id) used in the last call to FortiGate
   string      success  Sample:
                        id
   name                 Name of the table used to fulfill the request
   string      always   Sample:
                        urlfilter
   path                 Path of the table used to fulfill the request
   string      always   Sample:
                        webfilter
   revision             Internal revision number
   string      always   Sample:
                        17.0.2.10658
   serial               Serial number of the unit
   string      always   Sample:
                        FGVMEVYYQT3AB5352
   status               Indication of the operation's result
   string      always   Sample:
                        success
   vdom                 Virtual domain used
   string      always   Sample:
                        root
   version              Version of the FortiGate
   string      always   Sample:
                        v5.6.3

STATUS                   *fortios_system_virtual_wan_link-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Miguel Angel Munoz (@mamunozgonzalez)
     • Nicolas Thomas (@thomnico)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *fortios_system_virtual_wan_link-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/fortios_system_virtual_wan_link_module.html
