SYNOPSIS                   *fortios_firewall_vip*

     • This module is able to configure a FortiGate or FortiOS (FOS) device by allowing the user to set and modify firewall feature and vip category. Examples include all parameters and values need
       to be adjusted to datasources before usage. Tested with FOS v6.0.5

REQUIREMENTS                   *fortios_firewall_vip-requirements*

   The below requirements are needed on the host that executes this module.

     • fortiosapi>=0.9.8

PARAMETERS                   *fortios_firewall_vip-parameters*

               Parameter                     Choices/Defaults                                                                     Comments
   firewall_vip                      Default:                          Configure virtual IP for IPv4.
   dictionary                        null
    arp_reply                          Choices:
    string                             • disable                       Enable to respond to ARP requests for this virtual IP address. Enabled by default.
                                       • enable
    color                                                              Color of icon on the GUI.
    integer
    comment                                                            Comment.
    string
    dns_mapping_ttl                                                    DNS mapping TTL (Set to zero to use TTL in DNS response).
    integer
    extaddr                                                            External FQDN address name.
    list
             name                                                      Address name. Source firewall.address.name firewall.addrgrp.name.
             string / required
    extintf                                                            Interface connected to the source network that receives the packets that will be forwarded to the destination network. Source
    string                                                             system .interface.name.
    extip                                                              IP address or address range on the external interface that you want to map to an address or address range on the destination
    string                                                             network.
    extport                                                            Incoming port number range that you want to map to a port number range on the destination network.
    string
    gratuitous_arp_interval                                            Enable to have the VIP send gratuitous ARPs. 0=disabled. Set from 5 up to 8640000 seconds to enable.
    integer
    http_cookie_age                                                    Time in minutes that client web browsers should keep a cookie. Default is 60 seconds. 0 = no time limit.
    integer
    http_cookie_domain                                                 Domain that HTTP cookie persistence should apply to.
    string
    http_cookie_domain_from_host       Choices:
    string                             • disable                       Enable/disable use of HTTP cookie domain from host field in HTTP.
                                       • enable
    http_cookie_generation                                             Generation of HTTP cookie to be accepted. Changing invalidates all existing cookies.
    integer
    http_cookie_path                                                   Limit HTTP cookie persistence to the specified path.
    string
    http_cookie_share                  Choices:                        Control sharing of cookies across virtual servers. same-ip means a cookie from one virtual server can be used by another.
    string                             • disable                       Disable stops cookie sharing.
                                       • same-ip
    http_ip_header                     Choices:
    string                             • enable                        For HTTP multiplexing, enable to add the original client IP address in the XForwarded-For HTTP header.
                                       • disable
    http_ip_header_name                                                For HTTP multiplexing, enter a custom HTTPS header name. The original client IP address is added to this header. If empty,
    string                                                             X-Forwarded-For is used.
    http_multiplex                     Choices:
    string                             • enable                        Enable/disable HTTP multiplexing.
                                       • disable
    https_cookie_secure                Choices:
    string                             • disable                       Enable/disable verification that inserted HTTPS cookies are secure.
                                       • enable
    id                                                                 Custom defined ID.
    integer
                                       Choices:
                                       • static
                                       • round-robin
    ldb_method                         • weighted                      Method used to distribute sessions to real servers.
    string                             • least-session
                                       • least-rtt
                                       • first-alive
                                       • http-host
    mapped_addr                                                        Mapped FQDN address name. Source firewall.address.name.
    string
    mappedip                                                           IP address or address range on the destination network to which the external IP address is mapped.
    list
             range                                                     Mapped IP range.
             string / required
    mappedport                                                         Port number range on the destination network to which the external port number range is mapped.
    string
    max_embryonic_connections                                          Maximum number of incomplete connections.
    integer
    monitor                                                            Name of the health check monitor to use when polling to determine a virtual server's connectivity status.
    list
             name                                                      Health monitor name. Source firewall.ldb-monitor.name.
             string / required
    name                                                               Virtual IP name.
    string / required
    nat_source_vip                     Choices:
    string                             • disable                       Enable/disable forcing the source NAT mapped IP to the external IP for all traffic.
                                       • enable
    outlook_web_access                 Choices:
    string                             • disable                       Enable to add the Front-End-Https header for Microsoft Outlook Web Access.
                                       • enable
                                       Choices:
    persistence                        • none                          Configure how to make sure that clients connect to the same server every time they make a request that is part of the same
    string                             • http-cookie                   session.
                                       • ssl-session-id
    portforward                        Choices:
    string                             • disable                       Enable/disable port forwarding.
                                       • enable
    portmapping_type                   Choices:
    string                             • 1-to-1                        Port mapping type.
                                       • m-to-n
                                       Choices:
    protocol                           • tcp
    string                             • udp                           Protocol to use when forwarding packets.
                                       • sctp
                                       • icmp
    realservers                                                        Select the real servers that this server load balancing VIP will distribute traffic to.
    list
             client_ip                                                 Only clients in this IP range can connect to this real server.
             string
                                       Choices:
             healthcheck               • disable                       Enable to check the responsiveness of the real server before forwarding traffic.
             string                    • enable
                                       • vip
             holddown_interval                                         Time in seconds that the health check monitor continues to monitor and unresponsive server that should be active.
             integer
             http_host                                                 HTTP server domain name in HTTP header.
             string
             id                                                        Real server ID.
             integer / required
             ip                                                        IP address of the real server.
             string
             max_connections                                           Max number of active connections that can be directed to the real server. When reached, sessions are sent to other real
             integer                                                   servers.
             monitor                                                   Name of the health check monitor to use when polling to determine a virtual server's connectivity status. Source firewall
             string                                                    .ldb-monitor.name.
             port                                                      Port for communicating with the real server. Required if port forwarding is enabled.
             integer
                                       Choices:
             status                    • active                        Set the status of the real server to active so that it can accept traffic, or on standby or disabled so no traffic is sent.
             string                    • standby
                                       • disable
             weight                                                    Weight of the real server. If weighted load balancing is enabled, the server with the highest weight gets more connections.
             integer
                                       Choices:
                                       • http
                                       • https
                                       • imaps
    server_type                        • pop3s                         Protocol to be load balanced by the virtual server (also called the server load balance virtual IP).
    string                             • smtps
                                       • ssl
                                       • tcp
                                       • udp
                                       • ip
    service                                                            Service name.
    list
             name                                                      Service name. Source firewall.service.custom.name firewall.service.group.name.
             string / required
    src_filter                                                         Source address filter. Each address must be either an IP/subnet (x.x.x.x/n) or a range (x.x.x.x-y.y.y.y). Separate addresses
    list                                                               with spaces.
             range                                                     Source-filter range.
             string / required
    srcintf_filter                                                     Interfaces to which the VIP applies. Separate the names with spaces.
    list
             interface_name                                            Interface name. Source system.interface.name.
             string
                                       Choices:
    ssl_algorithm                      • high
    string                             • medium                        Permitted encryption algorithms for SSL sessions according to encryption strength.
                                       • low
                                       • custom
    ssl_certificate                                                    The name of the SSL certificate to use for SSL acceleration. Source vpn.certificate.local.name.
    string
    ssl_cipher_suites                                                  SSL/TLS cipher suites acceptable from a client, ordered by priority.
    list
                                       Choices:
             cipher                    • TLS-RSA-WITH-3DES-EDE-CBC-SHA Cipher suite name.
             string                    • TLS-DHE-RSA-WITH-DES-CBC-SHA
                                       • TLS-DHE-DSS-WITH-DES-CBC-SHA
             priority                                                  SSL/TLS cipher suites priority.
             integer / required
                                       Choices:
             versions                  • ssl-3.0
             string                    • tls-1.0                       SSL/TLS versions that the cipher suite can be used with.
                                       • tls-1.1
                                       • tls-1.2
    ssl_client_fallback                Choices:
    string                             • disable                       Enable/disable support for preventing Downgrade Attacks on client connections (RFC 7507).
                                       • enable
                                       Choices:
    ssl_client_renegotiation           • allow                         Allow, deny, or require secure renegotiation of client sessions to comply with RFC 5746.
    string                             • deny
                                       • secure
    ssl_client_session_state_max                                       Maximum number of client to FortiGate SSL session states to keep.
    integer
    ssl_client_session_state_timeout                                   Number of minutes to keep client to FortiGate SSL session state.
    integer
                                       Choices:
    ssl_client_session_state_type      • disable
    string                             • time                          How to expire SSL sessions for the segment of the SSL connection between the client and the FortiGate.
                                       • count
                                       • both
                                       Choices:
                                       • 768
    ssl_dh_bits                        • 1024
    string                             • 1536                          Number of bits to use in the Diffie-Hellman exchange for RSA encryption of SSL sessions.
                                       • 2048
                                       • 3072
                                       • 4096
                                       Choices:
    ssl_hpkp                           • disable                       Enable/disable including HPKP header in response.
    string                             • enable
                                       • report-only
    ssl_hpkp_age                                                       Number of seconds the client should honour the HPKP setting.
    integer
    ssl_hpkp_backup                                                    Certificate to generate backup HPKP pin from. Source vpn.certificate.local.name vpn.certificate.ca.name.
    string
    ssl_hpkp_include_subdomains        Choices:
    string                             • disable                       Indicate that HPKP header applies to all subdomains.
                                       • enable
    ssl_hpkp_primary                                                   Certificate to generate primary HPKP pin from. Source vpn.certificate.local.name vpn.certificate.ca.name.
    string
    ssl_hpkp_report_uri                                                URL to report HPKP violations to.
    string
    ssl_hsts                           Choices:
    string                             • disable                       Enable/disable including HSTS header in response.
                                       • enable
    ssl_hsts_age                                                       Number of seconds the client should honour the HSTS setting.
    integer
    ssl_hsts_include_subdomains        Choices:
    string                             • disable                       Indicate that HSTS header applies to all subdomains.
                                       • enable
    ssl_http_location_conversion       Choices:
    string                             • enable                        Enable to replace HTTP with HTTPS in the reply's Location HTTP header field.
                                       • disable
    ssl_http_match_host                Choices:
    string                             • enable                        Enable/disable HTTP host matching for location conversion.
                                       • disable
                                       Choices:
    ssl_max_version                    • ssl-3.0
    string                             • tls-1.0                       Highest SSL/TLS version acceptable from a client.
                                       • tls-1.1
                                       • tls-1.2
                                       Choices:
    ssl_min_version                    • ssl-3.0
    string                             • tls-1.0                       Lowest SSL/TLS version acceptable from a client.
                                       • tls-1.1
                                       • tls-1.2
    ssl_mode                           Choices:                        Apply SSL offloading between the client and the FortiGate (half) or from the client to the FortiGate and from the FortiGate to
    string                             • half                          the server (full).
                                       • full
                                       Choices:
    ssl_pfs                            • require                       Select the cipher suites that can be used for SSL perfect forward secrecy (PFS). Applies to both client and server sessions.
    string                             • deny
                                       • allow
    ssl_send_empty_frags               Choices:                        Enable/disable sending empty fragments to avoid CBC IV attacks (SSL 3.0 & TLS 1.0 only). May need to be disabled for
    string                             • enable                        compatibility with older systems.
                                       • disable
                                       Choices:
                                       • high
    ssl_server_algorithm               • medium                        Permitted encryption algorithms for the server side of SSL full mode sessions according to encryption strength.
    string                             • low
                                       • custom
                                       • client
    ssl_server_cipher_suites                                           SSL/TLS cipher suites to offer to a server, ordered by priority.
    list
                                       Choices:
             cipher                    • TLS-RSA-WITH-3DES-EDE-CBC-SHA Cipher suite name.
             string                    • TLS-DHE-RSA-WITH-DES-CBC-SHA
                                       • TLS-DHE-DSS-WITH-DES-CBC-SHA
             priority                                                  SSL/TLS cipher suites priority.
             integer / required
                                       Choices:
             versions                  • ssl-3.0
             string                    • tls-1.0                       SSL/TLS versions that the cipher suite can be used with.
                                       • tls-1.1
                                       • tls-1.2
                                       Choices:
                                       • ssl-3.0
    ssl_server_max_version             • tls-1.0                       Highest SSL/TLS version acceptable from a server. Use the client setting by default.
    string                             • tls-1.1
                                       • tls-1.2
                                       • client
                                       Choices:
                                       • ssl-3.0
    ssl_server_min_version             • tls-1.0                       Lowest SSL/TLS version acceptable from a server. Use the client setting by default.
    string                             • tls-1.1
                                       • tls-1.2
                                       • client
    ssl_server_session_state_max                                       Maximum number of FortiGate to Server SSL session states to keep.
    integer
    ssl_server_session_state_timeout                                   Number of minutes to keep FortiGate to Server SSL session state.
    integer
                                       Choices:
    ssl_server_session_state_type      • disable
    string                             • time                          How to expire SSL sessions for the segment of the SSL connection between the server and the FortiGate.
                                       • count
                                       • both
                                                                       Deprecated
                                       Choices:                        Starting with Ansible 2.9 we recommend using the top-level 'state' parameter.
    state                              • present
    string                             • absent                        ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

                                                                       Indicates whether to create or remove the object.
                                       Choices:
                                       • static-nat
    type                               • load-balance                  Configure a static NAT, load balance, server load balance, DNS translation, or FQDN VIP.
    string                             • server-load-balance
                                       • dns-translation
                                       • fqdn
    uuid                                                               Universally Unique Identifier (UUID; automatically assigned but can be manually reset).
    string
    weblogic_server                    Choices:
    string                             • disable                       Enable to add an HTTP header to indicate SSL offloading for a WebLogic server.
                                       • enable
    websphere_server                   Choices:
    string                             • disable                       Enable to add an HTTP header to indicate SSL offloading for a WebSphere server.
                                       • enable
   host                                                                FortiOS or FortiGate IP address.
   string
   https                               Choices:
   boolean                             • no                            Indicates if the requests towards FortiGate must use HTTPS protocol.
                                       • yes ←
   password                          Default:                          FortiOS or FortiGate password.
   string                            ""
   ssl_verify                          Choices:
   boolean                             • no                            Ensures FortiGate certificate must be verified by a proper CA.
   added in 2.9                        • yes ←
   state                               Choices:                        Indicates whether to create or remove the object. This attribute was present already in previous version in a deeper level. It
   string                              • present                       has been moved out to this outer level.
   added in 2.9                        • absent
   username                                                            FortiOS or FortiGate username.
   string
   vdom                              Default:                          Virtual domain, among those defined previously. A vdom is a virtual instance of the FortiGate that can be configured and used
   string                            "root"                            as a different unit.

NOTES                   *fortios_firewall_vip-notes*

   Note

     • Requires fortiosapi library developed by Fortinet
     • Run as a local_action in your playbook

EXAMPLES                   *fortios_firewall_vip-examples*

 - hosts: localhost
   vars:
    host: "192.168.122.40"
    username: "admin"
    password: ""
    vdom: "root"
    ssl_verify: "False"
   tasks:
   - name: Configure virtual IP for IPv4.
     fortios_firewall_vip:
       host:  "{{ host }}"
       username: "{{ username }}"
       password: "{{ password }}"
       vdom:  "{{ vdom }}"
       https: "False"
       state: "present"
       firewall_vip:
         arp_reply: "disable"
         color: "4"
         comment: "Comment."
         dns_mapping_ttl: "6"
         extaddr:
          -
             name: "default_name_8 (source firewall.address.name firewall.addrgrp.name)"
         extintf: "<your_own_value> (source system.interface.name)"
         extip: "<your_own_value>"
         extport: "<your_own_value>"
         gratuitous_arp_interval: "12"
         http_cookie_age: "13"
         http_cookie_domain: "<your_own_value>"
         http_cookie_domain_from_host: "disable"
         http_cookie_generation: "16"
         http_cookie_path: "<your_own_value>"
         http_cookie_share: "disable"
         http_ip_header: "enable"
         http_ip_header_name: "<your_own_value>"
         http_multiplex: "enable"
         https_cookie_secure: "disable"
         id:  "23"
         ldb_method: "static"
         mapped_addr: "<your_own_value> (source firewall.address.name)"
         mappedip:
          -
             range: "<your_own_value>"
         mappedport: "<your_own_value>"
         max_embryonic_connections: "29"
         monitor:
          -
             name: "default_name_31 (source firewall.ldb-monitor.name)"
         name: "default_name_32"
         nat_source_vip: "disable"
         outlook_web_access: "disable"
         persistence: "none"
         portforward: "disable"
         portmapping_type: "1-to-1"
         protocol: "tcp"
         realservers:
          -
             client_ip: "<your_own_value>"
             healthcheck: "disable"
             holddown_interval: "42"
             http_host: "myhostname"
             id:  "44"
             ip: "<your_own_value>"
             max_connections: "46"
             monitor: "<your_own_value> (source firewall.ldb-monitor.name)"
             port: "48"
             status: "active"
             weight: "50"
         server_type: "http"
         service:
          -
             name: "default_name_53 (source firewall.service.custom.name firewall.service.group.name)"
         src_filter:
          -
             range: "<your_own_value>"
         srcintf_filter:
          -
             interface_name: "<your_own_value> (source system.interface.name)"
         ssl_algorithm: "high"
         ssl_certificate: "<your_own_value> (source vpn.certificate.local.name)"
         ssl_cipher_suites:
          -
             cipher: "TLS-RSA-WITH-3DES-EDE-CBC-SHA"
             priority: "62"
             versions: "ssl-3.0"
         ssl_client_fallback: "disable"
         ssl_client_renegotiation: "allow"
         ssl_client_session_state_max: "66"
         ssl_client_session_state_timeout: "67"
         ssl_client_session_state_type: "disable"
         ssl_dh_bits: "768"
         ssl_hpkp: "disable"
         ssl_hpkp_age: "71"
         ssl_hpkp_backup: "<your_own_value> (source vpn.certificate.local.name vpn.certificate.ca.name)"
         ssl_hpkp_include_subdomains: "disable"
         ssl_hpkp_primary: "<your_own_value> (source vpn.certificate.local.name vpn.certificate.ca.name)"
         ssl_hpkp_report_uri: "<your_own_value>"
         ssl_hsts: "disable"
         ssl_hsts_age: "77"
         ssl_hsts_include_subdomains: "disable"
         ssl_http_location_conversion: "enable"
         ssl_http_match_host: "enable"
         ssl_max_version: "ssl-3.0"
         ssl_min_version: "ssl-3.0"
         ssl_mode: "half"
         ssl_pfs: "require"
         ssl_send_empty_frags: "enable"
         ssl_server_algorithm: "high"
         ssl_server_cipher_suites:
          -
             cipher: "TLS-RSA-WITH-3DES-EDE-CBC-SHA"
             priority: "89"
             versions: "ssl-3.0"
         ssl_server_max_version: "ssl-3.0"
         ssl_server_min_version: "ssl-3.0"
         ssl_server_session_state_max: "93"
         ssl_server_session_state_timeout: "94"
         ssl_server_session_state_type: "disable"
         type: "static-nat"
         uuid: "<your_own_value>"
         weblogic_server: "disable"
         websphere_server: "disable"

RETURN VALUES                   *fortios_firewall_vip-return values*

   Common return values are documented here, the following are the fields unique to this module:

       Key     Returned                                                                                  Description
   build                Build number of the fortigate image
   string      always   Sample:
                        1547
   http_method          Last method used to provision the content into FortiGate
   string      always   Sample:
                        PUT
   http_status          Last result given by FortiGate on last operation applied
   string      always   Sample:
                        200
   mkey                 Master key (id) used in the last call to FortiGate
   string      success  Sample:
                        id
   name                 Name of the table used to fulfill the request
   string      always   Sample:
                        urlfilter
   path                 Path of the table used to fulfill the request
   string      always   Sample:
                        webfilter
   revision             Internal revision number
   string      always   Sample:
                        17.0.2.10658
   serial               Serial number of the unit
   string      always   Sample:
                        FGVMEVYYQT3AB5352
   status               Indication of the operation's result
   string      always   Sample:
                        success
   vdom                 Virtual domain used
   string      always   Sample:
                        root
   version              Version of the FortiGate
   string      always   Sample:
                        v5.6.3

STATUS                   *fortios_firewall_vip-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Miguel Angel Munoz (@mamunozgonzalez)
     • Nicolas Thomas (@thomnico)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *fortios_firewall_vip-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/fortios_firewall_vip_module.html
