SYNOPSIS                   *ovirt_snapshot*

     • Module to manage Virtual Machine Snapshots in oVirt/RHV

REQUIREMENTS                   *ovirt_snapshot-requirements*

   The below requirements are needed on the host that executes this module.

     • python >= 2.7
     • ovirt-engine-sdk-python >= 4.3.0

PARAMETERS                   *ovirt_snapshot-parameters*

         Parameter        Choices/Defaults                                                                          Comments
   auth                                    Dictionary with values needed to create HTTP/HTTPS connection to oVirt:
   dictionary / required
                                           A PEM file containing the trusted CA certificates.
       ca_file                             The certificate presented by the server will be verified using these CA certificates.
       string                              If ca_file parameter is not set, system wide CA certificate store is used.
                                           Default value is set by OVIRT_CAFILE environment variable.
       headers                             Dictionary of HTTP headers to be added to each API call.
       dictionary
       hostname                            A string containing the hostname of the server, usually something like `server.example.com`.
       string                              Default value is set by OVIRT_HOSTNAME environment variable.
                                           Either url or hostname is required.
       insecure             Choices:
       boolean              • no           A boolean flag that indicates if the server TLS certificate and host name should be checked.
                            • yes
       kerberos             Choices:
       boolean              • no           A boolean flag indicating if Kerberos authentication should be used instead of the default basic authentication.
                            • yes
       password                            The password of the user.
       string / required                   Default value is set by OVIRT_PASSWORD environment variable.
       token                               Token to be used instead of login with username/password.
       string                              Default value is set by OVIRT_TOKEN environment variable.
       url                                 A string containing the API URL of the server, usually something like `https://server.example.com/ovirt-engine/api`.
       string                              Default value is set by OVIRT_URL environment variable.
                                           Either url or hostname is required.
       username                            The name of the user, something like [email protected].
       string / required                   Default value is set by OVIRT_USERNAME environment variable.
   description                             Description of the snapshot.
   -
   disk_id                                 Disk id which you want to upload or download
   -                                       To get disk, you need to define disk_id or disk_name
   added in 2.8
   disk_name
   -                                       Disk name which you want to upload or download
   added in 2.8
   download_image_path                     Path on a file system where snapshot should be downloaded.
   -                                       Note that you must have an valid oVirt/RHV engine CA in your system trust store or you must provide it in ca_file parameter.
   added in 2.8                            Note that the snapshot is not downloaded when the file already exists, but you can forcibly download the snapshot when using force I (true).
   fetch_nested             Choices:       If True the module will fetch additional data from the API.
   boolean                  • no           It will fetch IDs of the VMs disks, snapshots, etc. User can configure to fetch other attributes of the nested entities by specifying nested_attributes.
                            • yes
   keep_days_old                           Number of days after which should snapshot be deleted.
   -                                       It will check all snapshots of virtual machine and delete them, if they are older.
   added in 2.8
   nested_attributes                       Specifies list of the attributes which should be fetched from the API.
   list                                    This parameter apply only when fetch_nested is true.
   poll_interval          Default:         Number of the seconds the module waits until another poll request on entity status is sent.
   integer                3
   snapshot_id                             ID of the snapshot to manage.
   -
                            Choices:
   state                    • restore      Should the Virtual Machine snapshot be restore/present/absent.
   -                        • present ←
                            • absent
   timeout                Default:         The amount of time in seconds the module should wait for the instance to get into desired state.
   integer                180
   upload_image_path
   -                                       Path to disk image, which should be uploaded.
   added in 2.8
                            Choices:       If true and state is present save memory of the Virtual Machine if it's running.
   use_memory               • no           If true and state is restore restore memory of the Virtual Machine.
   boolean                  • yes          Note that Virtual Machine will be paused while saving the memory.
                                           aliases: restore_memory, save_memory
   vm_name                                 Name of the Virtual Machine to manage.
   - / required
   wait                     Choices:
   boolean                  • no           yes if the module should wait for the entity to get into desired state.
                            • yes ←

NOTES                   *ovirt_snapshot-notes*

   Note

     • Note that without a guest agent the data on the created snapshot may be inconsistent.
     • Deleting a snapshot does not remove any information from the virtual machine - it simply removes a return-point. However, restoring a virtual machine from a snapshot deletes any content that
       was written to the virtual machine after the time the snapshot was taken.
     • In order to use this module you have to install oVirt Python SDK. To ensure it’s installed with correct version you can create the following task: pip: name=ovirt-engine-sdk-python
       version=4.3.0

EXAMPLES                   *ovirt_snapshot-examples*

 # Examples don't contain auth parameter for simplicity,
 # look at ovirt_auth module to see how to reuse authentication:

 # Create snapshot:
 - ovirt_snapshot:
     vm_name: rhel7
     description: MySnapshot
   register: snapshot

 # Create snapshot and save memory:
 - ovirt_snapshot:
     vm_name: rhel7
     description: SnapWithMem
     use_memory: true
   register: snapshot

 # Restore snapshot:
 - ovirt_snapshot:
     state: restore
     vm_name: rhel7
     snapshot_id: "{{ snapshot.id }}"

 # Remove snapshot:
 - ovirt_snapshot:
     state: absent
     vm_name: rhel7
     snapshot_id: "{{ snapshot.id }}"

 # Upload local image to disk and attach it to vm:
 # Since Ansible 2.8
 - ovirt_snapshot:
     name: mydisk
     vm_name: myvm
     upload_image_path: /path/to/mydisk.qcow2

 # Download snapshot to local file system:
 # Since Ansible 2.8
 - ovirt_snapshot:
     snapshot_id: 7de90f31-222c-436c-a1ca-7e655bd5b60c
     disk_name: DiskName
     vm_name: myvm
     download_image_path: /home/user/mysnaphost.qcow2

 # Delete all snapshots older than 2 days
 - ovirt_snapshot:
     vm_name: test
     keep_days_old: 2

RETURN VALUES                   *ovirt_snapshot-return values*

   Common return values are documented here, the following are the fields unique to this module:

      Key     Returned                                                                                   Description
              On
   id         success   ID of the snapshot which is managed
   string     if        Sample:
              snapshot  7de90f31-222c-436c-a1ca-7e655bd5b60c
              is found.
              On
   snapshot   success   Dictionary of all the snapshot attributes. Snapshot attributes can be found on your oVirt/RHV instance at following url:
   dictionary if        http://ovirt.github.io/ovirt-engine-api-model/master/#types/snapshot.
              snapshot
              is found.
              On
   snapshots  success
   list       returns   List of deleted snapshots when keep_days_old is defined and snapshot is older than the input days
              deleted
              snapshots

STATUS                   *ovirt_snapshot-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Ondra Machacek (@machacekondra)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *ovirt_snapshot-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/ovirt_snapshot_module.html
