SYNOPSIS                   *ovirt_cluster*

     • Module to manage clusters in oVirt/RHV

REQUIREMENTS                   *ovirt_cluster-requirements*

   The below requirements are needed on the host that executes this module.

     • python >= 2.7
     • ovirt-engine-sdk-python >= 4.3.0

PARAMETERS                   *ovirt_cluster-parameters*

                Parameter                     Choices/Defaults                                                                   Comments
   auth                                                              Dictionary with values needed to create HTTP/HTTPS connection to oVirt:
   dictionary / required
                                                                     A PEM file containing the trusted CA certificates.
                ca_file                                              The certificate presented by the server will be verified using these CA certificates.
                string                                               If ca_file parameter is not set, system wide CA certificate store is used.
                                                                     Default value is set by OVIRT_CAFILE environment variable.
                headers                                              Dictionary of HTTP headers to be added to each API call.
                dictionary
                hostname                                             A string containing the hostname of the server, usually something like `server.example.com`.
                string                                               Default value is set by OVIRT_HOSTNAME environment variable.
                                                                     Either url or hostname is required.
                insecure                  Choices:
                boolean                   • no                       A boolean flag that indicates if the server TLS certificate and host name should be checked.
                                          • yes
                kerberos                  Choices:
                boolean                   • no                       A boolean flag indicating if Kerberos authentication should be used instead of the default basic authentication.
                                          • yes
                password                                             The password of the user.
                string / required                                    Default value is set by OVIRT_PASSWORD environment variable.
                token                                                Token to be used instead of login with username/password.
                string                                               Default value is set by OVIRT_TOKEN environment variable.
                url                                                  A string containing the API URL of the server, usually something like `https://server.example.com/ovirt-engine/api`.
                string                                               Default value is set by OVIRT_URL environment variable.
                                                                     Either url or hostname is required.
                username                                             The name of the user, something like [email protected].
                string / required                                    Default value is set by OVIRT_USERNAME environment variable.
   ballooning                             Choices:                   If True enable memory balloon optimization. Memory balloon is used to re-distribute / reclaim the host memory based on VM needs
   boolean                                • no                       in a dynamic way.
                                          • yes
   comment                                                           Comment of the cluster.
   -
   compatibility_version                                             The compatibility version of the cluster. All hosts in this cluster must support at least this compatibility version.
   -
                                          Choices:
   cpu_arch                               • x86_64                   CPU architecture of cluster.
   -                                      • ppc64
                                          • undefined
   cpu_type                                                          CPU codename. For example Intel SandyBridge Family.
   -
   data_center                                                       Datacenter name where cluster reside.
   -
   description                                                       Description of the cluster.
   -
   external_network_providers                                        List of references to the external network providers available in the cluster. If the automatic deployment of the external
   -                                                                 network provider is supported, the networks of the referenced network provider are available on every host in the cluster.
   added in 2.5                                                      This is supported since oVirt version 4.2.
                id                                                   ID of the external network provider. Either name or id is required.
                -
                name                                                 Name of the external network provider. Either name or id is required.
                -
   fence_connectivity_threshold                                      The threshold used by fence_skip_if_connectivity_broken.
   -
   fence_enabled                          Choices:                   If True enables fencing on the cluster.
   boolean                                • no                       Fencing is enabled by default.
                                          • yes
   fence_skip_if_connectivity_broken      Choices:                   If True fencing will be temporarily disabled if the percentage of hosts in the cluster that are experiencing connectivity issues
   boolean                                • no                       is greater than or equal to the defined threshold.
                                          • yes                      The threshold can be specified by fence_connectivity_threshold.
   fence_skip_if_gluster_bricks_up        Choices:                   A flag indicating if fencing should be skipped if Gluster bricks are up and running in the host being fenced.
   boolean                                • no                       This flag is optional, and the default value is `false`.
   added in 2.8                           • yes
   fence_skip_if_gluster_quorum_not_met   Choices:                   A flag indicating if fencing should be skipped if Gluster bricks are up and running and Gluster quorum will not be met without
   boolean                                • no                       those bricks.
   added in 2.8                           • yes                      This flag is optional, and the default value is `false`.
   fence_skip_if_sd_active                Choices:
   boolean                                • no                       If True any hosts in the cluster that are Non Responsive and still connected to storage will not be fenced.
                                          • yes
   fetch_nested                           Choices:                   If True the module will fetch additional data from the API.
   boolean                                • no                       It will fetch IDs of the VMs disks, snapshots, etc. User can configure to fetch other attributes of the nested entities by
                                          • yes                      specifying nested_attributes.
   firewall_type                          Choices:                   The type of firewall to be used on hosts in this cluster.
   string                                 • firewalld                Up to version 4.1, it was always iptables. Since version 4.2, you can choose between iptables and firewalld. For clusters with a
   added in 2.8                           • iptables                 compatibility version of 4.2 and higher, the default firewall type is firewalld.
   gluster                                Choices:                   If True, hosts in this cluster will be used as Gluster Storage server nodes, and not for running virtual machines.
   boolean                                • no                       By default the cluster is created for virtual machine hosts.
                                          • yes
   gluster_tuned_profile                                             The name of the https://fedorahosted.org/tuned to set on all the hosts in the cluster. This is not mandatory and relevant only
   string                                                            for clusters with Gluster service.
   added in 2.8                                                      Could be for example virtual-host, rhgs-sequential-io, rhgs-random-io
   ha_reservation                         Choices:
   boolean                                • no                       If True enables the oVirt/RHV to monitor cluster capacity for highly available virtual machines.
                                          • yes
   host_reason                            Choices:                   If True enables an optional reason field when a host is placed into maintenance mode from the Manager, allowing the
   boolean                                • no                       administrator to provide an explanation for the maintenance.
                                          • yes
   id
   -                                                                 ID of the cluster to manage.
   added in 2.8
   ksm                                    Choices:                   I True MoM enables to run Kernel Same-page Merging KSM when necessary and when it can yield a memory saving benefit that
   boolean                                • no                       outweighs its CPU cost.
                                          • yes
   ksm_numa                               Choices:
   boolean                                • no                       If True enables KSM ksm for best performance inside NUMA nodes.
                                          • yes
   mac_pool                                                          MAC pool to be used by this cluster.
   -                                                                 Note:
   added in 2.4                                                      This is supported since oVirt version 4.1.
                                          Choices:                   disabled - Disables memory page sharing.
   memory_policy                          • disabled                 server - Sets the memory page sharing threshold to 150% of the system memory on each host.
   -                                      • server                   desktop - Sets the memory page sharing threshold to 200% of the system memory on each host.
                                          • desktop
                                                                     If True auto-convergence is used during live migration of virtual machines.
                                          Choices:                   Used only when migration_policy is set to legacy.
   migration_auto_converge                • true                     Following options are supported:
   -                                      • false                    true - Override the global setting to true.
                                          • inherit                  false - Override the global setting to false.
                                                                     inherit - Use value which is set globally.
                                          Choices:                   The bandwidth settings define the maximum bandwidth of both outgoing and incoming migrations per host.
   migration_bandwidth                    • auto                     Following bandwidth options are supported:
   -                                      • hypervisor_default       auto - Bandwidth is copied from the rate limit [Mbps] setting in the data center host network QoS.
                                          • custom                   hypervisor_default - Bandwidth is controlled by local VDSM setting on sending host.
                                                                     custom - Defined by user (in Mbps).
   migration_bandwidth_limit                                         Set the custom migration bandwidth limit.
   -                                                                 This parameter is used only when migration_bandwidth is custom.
                                                                     If True compression is used during live migration of the virtual machine.
                                          Choices:                   Used only when migration_policy is set to legacy.
   migration_compressed                   • true                     Following options are supported:
   -                                      • false                    true - Override the global setting to true.
                                          • inherit                  false - Override the global setting to false.
                                                                     inherit - Use value which is set globally.
                                                                     A migration policy defines the conditions for live migrating virtual machines in the event of host failure.
                                          Choices:                   Following policies are supported:
   migration_policy                       • legacy                   legacy - Legacy behavior of 3.6 version.
   -                                      • minimal_downtime         minimal_downtime - Virtual machines should not experience any significant downtime.
                                          • suspend_workload         suspend_workload - Virtual machines may experience a more significant downtime.
                                          • post_copy                post_copy - Virtual machines should not experience any significant downtime. If the VM migration is not converging for a long
                                                                     time, the migration will be switched to post-copy. Added in version 2.4.
   name                                                              Name of the cluster to manage.
   - / required
   nested_attributes                                                 Specifies list of the attributes which should be fetched from the API.
   list                                                              This parameter apply only when fetch_nested is true.
   network                                                           Management network of cluster to access cluster hosts.
   -
   poll_interval                        Default:                     Number of the seconds the module waits until another poll request on entity status is sent.
   integer                              3
                                          Choices:                   The resilience policy defines how the virtual machines are prioritized in the migration.
   resilience_policy                      • do_not_migrate           Following values are supported:
   -                                      • migrate                  do_not_migrate - Prevents virtual machines from being migrated.
                                          • migrate_highly_available migrate - Migrates all virtual machines in order of their defined priority.
                                                                     migrate_highly_available - Migrates only highly available virtual machines to prevent overloading other hosts.
   rng_sources                                                       List that specify the random number generator devices that all hosts in the cluster will use.
   -                                                                 Supported generators are: hwrng and random.
   scheduling_policy                                                 Name of the scheduling policy to be used for cluster.
   -
   scheduling_policy_properties                                      Custom scheduling policy properties of the cluster.
   -                                                                 These optional properties override the properties of the scheduling policy specified by the scheduling_policy parameter.
   added in 2.6
                                                                     Specify a serial number policy for the virtual machines in the cluster.
   serial_policy                                                     Following options are supported:
   -                                                                 vm - Sets the virtual machine's UUID as its serial number.
                                                                     host - Sets the host's UUID as the virtual machine's serial number.
                                                                     custom - Allows you to specify a custom serial number in serial_policy_value.
   serial_policy_value                                               Allows you to specify a custom serial number.
   -                                                                 This parameter is used only when serial_policy is custom.
   spice_proxy                                                       The proxy by which the SPICE client will connect to virtual machines.
   -                                                                 The address must be in the following format: protocol://[host]:[port]
   state                                  Choices:
   -                                      • present ←                Should the cluster be present or absent.
                                          • absent
   switch_type                            Choices:
   -                                      • legacy                   Type of switch to be used by all networks in given cluster. Either legacy which is using linux bridge or ovs using Open vSwitch.
                                          • ovs
   threads_as_cores                       Choices:
   boolean                                • no                       If True the exposed host threads would be treated as cores which can be utilized by virtual machines.
                                          • yes
   timeout                              Default:                     The amount of time in seconds the module should wait for the instance to get into desired state.
   integer                              180
   trusted_service                        Choices:
   boolean                                • no                       If True enables integration with an OpenAttestation server.
                                          • yes
   virt                                   Choices:
   boolean                                • no                       If True, hosts in this cluster will be used to run virtual machines.
                                          • yes
   vm_reason                              Choices:                   If True enables an optional reason field when a virtual machine is shut down from the Manager, allowing the administrator to
   boolean                                • no                       provide an explanation for the maintenance.
                                          • yes
   wait                                   Choices:
   boolean                                • no                       yes if the module should wait for the entity to get into desired state.
                                          • yes ←

NOTES                   *ovirt_cluster-notes*

   Note

     • In order to use this module you have to install oVirt Python SDK. To ensure it’s installed with correct version you can create the following task: pip: name=ovirt-engine-sdk-python
       version=4.3.0

EXAMPLES                   *ovirt_cluster-examples*

 # Examples don't contain auth parameter for simplicity,
 # look at ovirt_auth module to see how to reuse authentication:

 # Create cluster
 - ovirt_cluster:
     data_center: mydatacenter
     name: mycluster
     cpu_type: Intel SandyBridge Family
     description: mycluster
     compatibility_version: 4.0

 # Create virt service cluster:
 - ovirt_cluster:
     data_center: mydatacenter
     name: mycluster
     cpu_type: Intel Nehalem Family
     description: mycluster
     switch_type: legacy
     compatibility_version: 4.0
     ballooning: true
     gluster: false
     threads_as_cores: true
     ha_reservation: true
     trusted_service: false
     host_reason: false
     vm_reason: true
     ksm_numa: true
     memory_policy: server
     rng_sources:
       - hwrng
       - random

 # Create cluster with default network provider
 - ovirt_cluster:
     name: mycluster
     data_center: Default
     cpu_type: Intel SandyBridge Family
     external_network_providers:
       - name: ovirt-provider-ovn

 # Remove cluster
 - ovirt_cluster:
     state: absent
     name: mycluster

 # Change cluster Name
 - ovirt_cluster:
     id: 00000000-0000-0000-0000-000000000000
     name: "new_cluster_name"

RETURN VALUES                   *ovirt_cluster-return values*

   Common return values are documented here, the following are the fields unique to this module:

      Key     Returned                                                                                  Description
              On
              success
   cluster    if       Dictionary of all the cluster attributes. Cluster attributes can be found on your oVirt/RHV instance at following url:
   dictionary cluster  http://ovirt.github.io/ovirt-engine-api-model/master/#types/cluster.
              is
              found.
              On
              success  ID of the cluster which is managed
   id         if       Sample:
   string     cluster  7de90f31-222c-436c-a1ca-7e655bd5b60c
              is
              found.

STATUS                   *ovirt_cluster-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Ondra Machacek (@machacekondra)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *ovirt_cluster-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/ovirt_cluster_module.html
