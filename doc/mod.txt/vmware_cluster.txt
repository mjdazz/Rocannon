SYNOPSIS                   *vmware_cluster*

     • Adds or removes VMware vSphere clusters.
     • Although this module can manage DRS, HA and VSAN related configurations, this functionality is deprecated and will be removed in 2.12.
     • To manage DRS, HA and VSAN related configurations, use the new modules vmware_cluster_drs, vmware_cluster_ha and vmware_cluster_vsan.
     • All values and VMware object names are case sensitive.

REQUIREMENTS                   *vmware_cluster-requirements*

   The below requirements are needed on the host that executes this module.

     • Tested on ESXi 5.5 and 6.5.
     • PyVmomi installed.

PARAMETERS                   *vmware_cluster-parameters*

              Parameter                  Choices/Defaults                                                                     Comments
   cluster_name                                                The name of the cluster to be managed.
   string / required
   datacenter                                                  The name of the datacenter.
   string / required                                           aliases: datacenter_name
                                                               Specifies the cluster-wide default DRS behavior for virtual machines.
                                                               If set to partiallyAutomated, then vCenter generate recommendations for virtual machine migration and for the placement with a host.
                                      Choices:                 vCenter automatically implement placement at power on.
   drs_default_vm_behavior            • fullyAutomated ←       If set to manual, then vCenter generate recommendations for virtual machine migration and for the placement with a host. vCenter
   -                                  • manual                 should not implement the recommendations automatically.
   added in 2.8                       • partiallyAutomated     If set to fullyAutomated, then vCenter should automate both the migration of virtual machines and their placement with a host at power
                                                               on.
                                                               Use drs_default_vm_behavior of vmware_cluster_drs instead.
                                                               Deprecated option, will be removed in version 2.12.
   drs_enable_vm_behavior_overrides   Choices:                 Determines whether DRS Behavior overrides for individual virtual machines are enabled.
   boolean                            • no                     If set to True, overrides drs_default_vm_behavior.
   added in 2.8                       • yes ←                  Use drs_enable_vm_behavior_overrides of vmware_cluster_drs instead.
                                                               Deprecated option, will be removed in version 2.12.
                                      Choices:
   drs_vmotion_rate                   • 1                      Threshold for generated ClusterRecommendations.
   -                                  • 2                      Use drs_vmotion_rate of vmware_cluster_drs instead.
   added in 2.8                       • 3 ←                    Deprecated option, will be removed in version 2.12.
                                      • 4
                                      • 5
   enable_drs                         Choices:                 If set to yes, will enable DRS when the cluster is created.
   boolean                            • no ←                   Use enable_drs of vmware_cluster_drs instead.
                                      • yes                    Deprecated option, will be removed in version 2.12.
   enable_ha                          Choices:                 If set to yes will enable HA when the cluster is created.
   boolean                            • no ←                   Use enable_ha of vmware_cluster_ha instead.
                                      • yes                    Deprecated option, will be removed in version 2.12.
   enable_vsan                        Choices:                 If set to yes will enable vSAN when the cluster is created.
   boolean                            • no ←                   Use enable_vsan of vmware_cluster_vsan instead.
                                      • yes                    Deprecated option, will be removed in version 2.12.
   ha_admission_control_enabled       Choices:                 Determines if strict admission control is enabled.
   boolean                            • no                     It is recommended to set this parameter to True, please refer documentation for more details.
   added in 2.8                       • yes ←                  Use slot_based_admission_control, reservation_based_admission_control or failover_host_admission_control of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
                                                               Number of host failures that should be tolerated, still guaranteeing sufficient resources to restart virtual machines on available
   ha_failover_level                Default:                   hosts.
   -                                2                          Accepts integer values only.
   added in 2.8                                                Use slot_based_admission_control, reservation_based_admission_control or failover_host_admission_control of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
                                                               Indicates whether HA restarts virtual machines after a host fails.
   ha_host_monitoring                 Choices:                 If set to enabled, HA restarts virtual machines after a host fails.
   -                                  • enabled ←              If set to disabled, HA does not restart virtual machines after a host fails.
   added in 2.8                       • disabled               If enable_ha is set to no, then this value is ignored.
                                                               Use ha_host_monitoring of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
                                                               Determines the preference that HA gives to a virtual machine if sufficient capacity is not available to power on all failed virtual
                                                               machines.
                                                               This setting is only valid if ha_vm_monitoring is set to, either vmAndAppMonitoring or vmMonitoringOnly.
                                      Choices:                 If set to disabled, then HA is disabled for this virtual machine.
   ha_restart_priority                • disabled               If set to high, then virtual machine with this priority have a higher chance of powering on after a failure, when there is
   -                                  • high                   insufficient capacity on hosts to meet all virtual machine needs.
   added in 2.8                       • low                    If set to medium, then virtual machine with this priority have an intermediate chance of powering on after a failure, when there is
                                      • medium ←               insufficient capacity on hosts to meet all virtual machine needs.
                                                               If set to low, then virtual machine with this priority have a lower chance of powering on after a failure, when there is insufficient
                                                               capacity on hosts to meet all virtual machine needs.
                                                               Use ha_restart_priority of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
                                                               The number of seconds after which virtual machine is declared as failed if no heartbeat has been received.
   ha_vm_failure_interval           Default:                   This setting is only valid if ha_vm_monitoring is set to, either vmAndAppMonitoring or vmMonitoringOnly.
   -                                30                         Unit is seconds.
   added in 2.8                                                Use ha_vm_failure_interval of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
                                                               The number of seconds for the window during which up to ha_vm_max_failures resets can occur before automated responses stop.
   ha_vm_max_failure_window                                    This setting is only valid if ha_vm_monitoring is set to, either vmAndAppMonitoring or vmMonitoringOnly.
   -                                Default:                   Unit is seconds.
   added in 2.8                     -1                         Default specifies no failure window.
                                                               Use ha_vm_max_failure_window of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
   ha_vm_max_failures                                          Maximum number of failures and automated resets allowed during the time that ha_vm_max_failure_window specifies.
   -                                Default:                   This setting is only valid if ha_vm_monitoring is set to, either vmAndAppMonitoring or vmMonitoringOnly.
   added in 2.8                     3                          Use ha_vm_max_failures of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
                                                               The number of seconds for the virtual machine's heartbeats to stabilize after the virtual machine has been powered on.
   ha_vm_min_up_time                Default:                   This setting is only valid if ha_vm_monitoring is set to, either vmAndAppMonitoring or vmMonitoringOnly.
   -                                120                        Unit is seconds.
   added in 2.8                                                Use ha_vm_min_up_time of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
                                                               Indicates the state of virtual machine health monitoring service.
                                      Choices:                 If set to vmAndAppMonitoring, HA response to both virtual machine and application heartbeat failure.
   ha_vm_monitoring                   • vmAndAppMonitoring     If set to vmMonitoringDisabled, virtual machine health monitoring is disabled.
   -                                  • vmMonitoringOnly       If set to vmMonitoringOnly, HA response to virtual machine heartbeat failure.
   added in 2.8                       • vmMonitoringDisabled ← If enable_ha is set to no, then this value is ignored.
                                                               Use ha_vm_monitoring of vmware_cluster_ha instead.
                                                               Deprecated option, will be removed in version 2.12.
   hostname                                                    The hostname or IP address of the vSphere vCenter or ESXi server.
   string                                                      If the value is not specified in the task, the value of environment variable VMWARE_HOST will be used instead.
                                                               Environment variable support added in Ansible 2.6.
   ignore_drs                         Choices:
   boolean                            • no ←                   If set to yes, DRS will not be configured; all explicit and default DRS related configurations will be ignored.
   added in 2.9                       • yes
   ignore_ha                          Choices:
   boolean                            • no ←                   If set to yes, HA will not be configured; all explicit and default HA related configurations will be ignored.
   added in 2.9                       • yes
   ignore_vsan                        Choices:
   boolean                            • no ←                   If set to yes, VSAN will not be configured; all explicit and default VSAN related configurations will be ignored.
   added in 2.9                       • yes
                                                               The password of the vSphere vCenter or ESXi server.
   password                                                    If the value is not specified in the task, the value of environment variable VMWARE_PASSWORD will be used instead.
   string                                                      Environment variable support added in Ansible 2.6.
                                                               aliases: pass, pwd
   port                             Default:                   The port number of the vSphere vCenter or ESXi server.
   integer                          443                        If the value is not specified in the task, the value of environment variable VMWARE_PORT will be used instead.
   added in 2.5                                                Environment variable support added in Ansible 2.6.
   proxy_host                                                  Address of a proxy that will receive all HTTPS requests and relay them.
   string                                                      The format is a hostname or a IP.
   added in 2.9                                                If the value is not specified in the task, the value of environment variable VMWARE_PROXY_HOST will be used instead.
                                                               This feature depends on a version of pyvmomi greater than v6.7.1.2018.12
   proxy_port                                                  Port of the HTTP proxy that will receive all HTTPS requests and relay them.
   integer                                                     If the value is not specified in the task, the value of environment variable VMWARE_PROXY_PORT will be used instead.
   added in 2.9
   state                              Choices:
   -                                  • absent                 Create present or remove absent a VMware vSphere cluster.
                                      • present ←
                                                               The username of the vSphere vCenter or ESXi server.
   username                                                    If the value is not specified in the task, the value of environment variable VMWARE_USER will be used instead.
   string                                                      Environment variable support added in Ansible 2.6.
                                                               aliases: admin, user
                                      Choices:                 Allows connection when SSL certificates are not valid. Set to false when certificates are not trusted.
   validate_certs                     • no                     If the value is not specified in the task, the value of environment variable VMWARE_VALIDATE_CERTS will be used instead.
   boolean                            • yes ←                  Environment variable support added in Ansible 2.6.
                                                               If set to yes, please make sure Python >= 2.7.9 is installed on the given machine.
   vsan_auto_claim_storage            Choices:                 Determines whether the VSAN service is configured to automatically claim local storage on VSAN-enabled hosts in the cluster.
   boolean                            • no ←                   Use vsan_auto_claim_storage of vmware_cluster_vsan instead.
   added in 2.8                       • yes                    Deprecated option, will be removed in version 2.12.

SEE ALSO                   *vmware_cluster-see also*

   See also

   vmware_cluster_drs – Manage Distributed Resource Scheduler (DRS) on VMware vSphere clusters
   The official documentation on the vmware_cluster_drs module.

   vmware_cluster_ha – Manage High Availability (HA) on VMware vSphere clusters
   The official documentation on the vmware_cluster_ha module.

   vmware_cluster_vsan – Manages virtual storage area network (vSAN) configuration on VMware vSphere clusters
   The official documentation on the vmware_cluster_vsan module.

EXAMPLES                   *vmware_cluster-examples*

 - name: Create Cluster
   vmware_cluster:
     hostname: '{{ vcenter_hostname }}'
     username: '{{ vcenter_username }}'
     password: '{{ vcenter_password }}'
     datacenter_name: datacenter
     cluster_name: cluster
     enable_ha: yes
     enable_drs: yes
     enable_vsan: yes
   delegate_to: localhost

 - name: Create Cluster with additional changes
   vmware_cluster:
     hostname: "{{ vcenter_server }}"
     username: "{{ vcenter_user }}"
     password: "{{ vcenter_pass }}"
     validate_certs: no
     datacenter_name: DC0
     cluster_name: "{{ cluster_name }}"
     enable_ha: True
     ha_vm_monitoring: vmMonitoringOnly
     enable_drs: True
     drs_default_vm_behavior: partiallyAutomated
     enable_vsan: True
   register: cl_result
   delegate_to: localhost

 - name: Delete Cluster
   vmware_cluster:
     hostname: "{{ vcenter_server }}"
     username: "{{ vcenter_user }}"
     password: "{{ vcenter_pass }}"
     datacenter_name: datacenter
     cluster_name: cluster
     enable_ha: yes
     enable_drs: yes
     enable_vsan: yes
     state: absent

STATUS                   *vmware_cluster-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Joseph Callen (@jcpowermac)
     • Abhijeet Kasurde (@Akasurde)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *vmware_cluster-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/vmware_cluster_module.html
