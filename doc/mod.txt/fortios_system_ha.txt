SYNOPSIS                   *fortios_system_ha*

     • This module is able to configure a FortiGate or FortiOS (FOS) device by allowing the user to set and modify system feature and ha category. Examples include all parameters and values need to
       be adjusted to datasources before usage. Tested with FOS v6.0.5

REQUIREMENTS                   *fortios_system_ha-requirements*

   The below requirements are needed on the host that executes this module.

     • fortiosapi>=0.9.8

PARAMETERS                   *fortios_system_ha-parameters*

              Parameter               Choices/Defaults                                                                     Comments
   host                                                   FortiOS or FortiGate IP address.
   string
   https                             Choices:
   boolean                           • no                 Indicates if the requests towards FortiGate must use HTTPS protocol.
                                     • yes ←
   password                        Default:               FortiOS or FortiGate password.
   string                          ""
   ssl_verify                        Choices:
   boolean                           • no                 Ensures FortiGate certificate must be verified by a proper CA.
                                     • yes ←
   system_ha                       Default:               Configure HA.
   dictionary                      null
    arps                                                  Number of gratuitous ARPs (1 - 60). Lower to reduce traffic. Higher to reduce failover time.
    integer
    arps_interval                                         Time between gratuitous ARPs (1 - 20 sec). Lower to reduce failover time. Higher to reduce traffic.
    integer
    authentication                   Choices:
    string                           • enable             Enable/disable heartbeat message authentication.
                                     • disable
    cpu_threshold                                         Dynamic weighted load balancing CPU usage weight and high and low thresholds.
    string
    encryption                       Choices:
    string                           • enable             Enable/disable heartbeat message encryption.
                                     • disable
    ftp_proxy_threshold                                   Dynamic weighted load balancing weight and high and low number of FTP proxy sessions.
    string
    gratuitous_arps                  Choices:
    string                           • enable             Enable/disable gratuitous ARPs. Disable if link-failed-signal enabled.
                                     • disable
    group_id                                              Cluster group ID (0 - 255). Must be the same for all members.
    integer
    group_name                                            Cluster group name. Must be the same for all members.
    string
    ha_direct                        Choices:
    string                           • enable             Enable/disable using ha-mgmt interface for syslog, SNMP, remote authentication (RADIUS), FortiAnalyzer, and FortiSandbox.
                                     • disable
    ha_eth_type                                           HA heartbeat packet Ethertype (4-digit hex).
    string
    ha_mgmt_interfaces                                    Reserve interfaces to manage individual cluster units.
    list
     dst                                                  Default route destination for reserved HA management interface.
     string
     gateway                                              Default route gateway for reserved HA management interface.
     string
     gateway6                                             Default IPv6 gateway for reserved HA management interface.
     string
     id                                                   Table ID.
     integer / required
     interface                                            Interface to reserve for HA management. Source system.interface.name.
     string
    ha_mgmt_status                   Choices:
    string                           • enable             Enable to reserve interfaces to manage individual cluster units.
                                     • disable
    ha_uptime_diff_margin                                 Normally you would only reduce this value for failover testing.
    integer
    hb_interval                                           Time between sending heartbeat packets (1 - 20 (100"ms)). Increase to reduce false positives.
    integer
    hb_lost_threshold                                     Number of lost heartbeats to signal a failure (1 - 60). Increase to reduce false positives.
    integer
    hbdev                                                 Heartbeat interfaces. Must be the same for all members.
    string
    hc_eth_type                                           Transparent mode HA heartbeat packet Ethertype (4-digit hex).
    string
    hello_holddown                                        Time to wait before changing from hello to work state (5 - 300 sec).
    integer
    http_proxy_threshold                                  Dynamic weighted load balancing weight and high and low number of HTTP proxy sessions.
    string
    imap_proxy_threshold                                  Dynamic weighted load balancing weight and high and low number of IMAP proxy sessions.
    string
    inter_cluster_session_sync       Choices:
    string                           • enable             Enable/disable synchronization of sessions among HA clusters.
                                     • disable
    key                                                   key
    string
    l2ep_eth_type                                         Telnet session HA heartbeat packet Ethertype (4-digit hex).
    string
    link_failed_signal               Choices:
    string                           • enable             Enable to shut down all interfaces for 1 sec after a failover. Use if gratuitous ARPs do not update network.
                                     • disable
    load_balance_all                 Choices:
    string                           • enable             Enable to load balance TCP sessions. Disable to load balance proxy sessions only.
                                     • disable
    memory_compatible_mode           Choices:
    string                           • enable             Enable/disable memory compatible mode.
                                     • disable
    memory_threshold                                      Dynamic weighted load balancing memory usage weight and high and low thresholds.
    string
                                     Choices:
    mode                             • standalone         HA mode. Must be the same for all members. FGSP requires standalone.
    string                           • a-a
                                     • a-p
    monitor                                               Interfaces to check for port monitoring (or link failure). Source system.interface.name.
    string
    multicast_ttl                                         HA multicast TTL on master (5 - 3600 sec).
    integer
    nntp_proxy_threshold                                  Dynamic weighted load balancing weight and high and low number of NNTP proxy sessions.
    string
    override                         Choices:
    string                           • enable             Enable and increase the priority of the unit that should always be primary (master).
                                     • disable
    override_wait_time                                    Delay negotiating if override is enabled (0 - 3600 sec). Reduces how often the cluster negotiates.
    integer
    password                                              Cluster password. Must be the same for all members.
    string
    pingserver_failover_threshold                         Remote IP monitoring failover threshold (0 - 50).
    integer
    pingserver_flip_timeout                               Time to wait in minutes before renegotiating after a remote IP monitoring failover.
    integer
    pingserver_monitor_interface                          Interfaces to check for remote IP monitoring. Source system.interface.name.
    string
    pingserver_slave_force_reset     Choices:
    string                           • enable             Enable to force the cluster to negotiate after a remote IP monitoring failover.
                                     • disable
    pop3_proxy_threshold                                  Dynamic weighted load balancing weight and high and low number of POP3 proxy sessions.
    string
    priority                                              Increase the priority to select the primary unit (0 - 255).
    integer
    route_hold                                            Time to wait between routing table updates to the cluster (0 - 3600 sec).
    integer
    route_ttl                                             TTL for primary unit routes (5 - 3600 sec). Increase to maintain active routes during failover.
    integer
    route_wait                                            Time to wait before sending new routes to the cluster (0 - 3600 sec).
    integer
                                     Choices:
                                     • none
                                     • hub
    schedule                         • leastconnection
    string                           • round-robin        Type of A-A load balancing. Use none if you have external load balancers.
                                     • weight-round-robin
                                     • random
                                     • ip
                                     • ipport
    secondary_vcluster                                    Configure virtual cluster 2.
    dictionary
     monitor                                              Interfaces to check for port monitoring (or link failure). Source system.interface.name.
     string
     override                        Choices:
     string                          • enable             Enable and increase the priority of the unit that should always be primary (master).
                                     • disable
     override_wait_time                                   Delay negotiating if override is enabled (0 - 3600 sec). Reduces how often the cluster negotiates.
     integer
     pingserver_failover_threshold                        Remote IP monitoring failover threshold (0 - 50).
     integer
     pingserver_monitor_interface                         Interfaces to check for remote IP monitoring. Source system.interface.name.
     string
     pingserver_slave_force_reset    Choices:
     string                          • enable             Enable to force the cluster to negotiate after a remote IP monitoring failover.
                                     • disable
     priority                                             Increase the priority to select the primary unit (0 - 255).
     integer
     vcluster_id                                          Cluster ID.
     integer
     vdom                                                 VDOMs in virtual cluster 2.
     string
    session_pickup                   Choices:
    string                           • enable             Enable/disable session pickup. Enabling it can reduce session down time when fail over happens.
                                     • disable
    session_pickup_connectionless    Choices:
    string                           • enable             Enable/disable UDP and ICMP session sync for FGSP.
                                     • disable
    session_pickup_delay             Choices:
    string                           • enable             Enable to sync sessions longer than 30 sec. Only longer lived sessions need to be synced.
                                     • disable
    session_pickup_expectation       Choices:
    string                           • enable             Enable/disable session helper expectation session sync for FGSP.
                                     • disable
    session_pickup_nat               Choices:
    string                           • enable             Enable/disable NAT session sync for FGSP.
                                     • disable
    session_sync_dev                                      Offload session sync to one or more interfaces to distribute traffic and prevent delays if needed. Source system.interface.name.
    string
    smtp_proxy_threshold                                  Dynamic weighted load balancing weight and high and low number of SMTP proxy sessions.
    string
    standalone_config_sync           Choices:
    string                           • enable             Enable/disable FGSP configuration synchronization.
                                     • disable
    standalone_mgmt_vdom             Choices:
    string                           • enable             Enable/disable standalone management VDOM.
                                     • disable
    sync_config                      Choices:
    string                           • enable             Enable/disable configuration synchronization.
                                     • disable
    sync_packet_balance              Choices:
    string                           • enable             Enable/disable HA packet distribution to multiple CPUs.
                                     • disable
    unicast_hb                       Choices:
    string                           • enable             Enable/disable unicast heartbeat.
                                     • disable
    unicast_hb_netmask                                    Unicast heartbeat netmask.
    string
    unicast_hb_peerip                                     Unicast heartbeat peer IP.
    string
    uninterruptible_upgrade          Choices:
    string                           • enable             Enable to upgrade a cluster without blocking network traffic.
                                     • disable
    vcluster2                        Choices:
    string                           • enable             Enable/disable virtual cluster 2 for virtual clustering.
                                     • disable
    vcluster_id                                           Cluster ID.
    integer
    vdom                                                  VDOMs in virtual cluster 1.
    string
    weight                                                Weight-round-robin weight for each cluster unit. Syntax <priority> <weight>.
    string
   username                                               FortiOS or FortiGate username.
   string
   vdom                            Default:               Virtual domain, among those defined previously. A vdom is a virtual instance of the FortiGate that can be configured and used as a
   string                          "root"                 different unit.

NOTES                   *fortios_system_ha-notes*

   Note

     • Requires fortiosapi library developed by Fortinet
     • Run as a local_action in your playbook

EXAMPLES                   *fortios_system_ha-examples*

 - hosts: localhost
   vars:
    host: "192.168.122.40"
    username: "admin"
    password: ""
    vdom: "root"
    ssl_verify: "False"
   tasks:
   - name: Configure HA.
     fortios_system_ha:
       host:  "{{ host }}"
       username: "{{ username }}"
       password: "{{ password }}"
       vdom:  "{{ vdom }}"
       https: "False"
       system_ha:
         arps: "3"
         arps_interval: "4"
         authentication: "enable"
         cpu_threshold: "<your_own_value>"
         encryption: "enable"
         ftp_proxy_threshold: "<your_own_value>"
         gratuitous_arps: "enable"
         group_id: "10"
         group_name: "<your_own_value>"
         ha_direct: "enable"
         ha_eth_type: "<your_own_value>"
         ha_mgmt_interfaces:
          -
             dst: "<your_own_value>"
             gateway: "<your_own_value>"
             gateway6: "<your_own_value>"
             id:  "18"
             interface: "<your_own_value> (source system.interface.name)"
         ha_mgmt_status: "enable"
         ha_uptime_diff_margin: "21"
         hb_interval: "22"
         hb_lost_threshold: "23"
         hbdev: "<your_own_value>"
         hc_eth_type: "<your_own_value>"
         hello_holddown: "26"
         http_proxy_threshold: "<your_own_value>"
         imap_proxy_threshold: "<your_own_value>"
         inter_cluster_session_sync: "enable"
         key: "<your_own_value>"
         l2ep_eth_type: "<your_own_value>"
         link_failed_signal: "enable"
         load_balance_all: "enable"
         memory_compatible_mode: "enable"
         memory_threshold: "<your_own_value>"
         mode: "standalone"
         monitor: "<your_own_value> (source system.interface.name)"
         multicast_ttl: "38"
         nntp_proxy_threshold: "<your_own_value>"
         override: "enable"
         override_wait_time: "41"
         password: "<your_own_value>"
         pingserver_failover_threshold: "43"
         pingserver_flip_timeout: "44"
         pingserver_monitor_interface: "<your_own_value> (source system.interface.name)"
         pingserver_slave_force_reset: "enable"
         pop3_proxy_threshold: "<your_own_value>"
         priority: "48"
         route_hold: "49"
         route_ttl: "50"
         route_wait: "51"
         schedule: "none"
         secondary_vcluster:
             monitor: "<your_own_value> (source system.interface.name)"
             override: "enable"
             override_wait_time: "56"
             pingserver_failover_threshold: "57"
             pingserver_monitor_interface: "<your_own_value> (source system.interface.name)"
             pingserver_slave_force_reset: "enable"
             priority: "60"
             vcluster_id: "61"
             vdom: "<your_own_value>"
         session_pickup: "enable"
         session_pickup_connectionless: "enable"
         session_pickup_delay: "enable"
         session_pickup_expectation: "enable"
         session_pickup_nat: "enable"
         session_sync_dev: "<your_own_value> (source system.interface.name)"
         smtp_proxy_threshold: "<your_own_value>"
         standalone_config_sync: "enable"
         standalone_mgmt_vdom: "enable"
         sync_config: "enable"
         sync_packet_balance: "enable"
         unicast_hb: "enable"
         unicast_hb_netmask: "<your_own_value>"
         unicast_hb_peerip: "<your_own_value>"
         uninterruptible_upgrade: "enable"
         vcluster_id: "78"
         vcluster2: "enable"
         vdom: "<your_own_value>"
         weight: "<your_own_value>"

RETURN VALUES                   *fortios_system_ha-return values*

   Common return values are documented here, the following are the fields unique to this module:

       Key     Returned                                                                                  Description
   build                Build number of the fortigate image
   string      always   Sample:
                        1547
   http_method          Last method used to provision the content into FortiGate
   string      always   Sample:
                        PUT
   http_status          Last result given by FortiGate on last operation applied
   string      always   Sample:
                        200
   mkey                 Master key (id) used in the last call to FortiGate
   string      success  Sample:
                        id
   name                 Name of the table used to fulfill the request
   string      always   Sample:
                        urlfilter
   path                 Path of the table used to fulfill the request
   string      always   Sample:
                        webfilter
   revision             Internal revision number
   string      always   Sample:
                        17.0.2.10658
   serial               Serial number of the unit
   string      always   Sample:
                        FGVMEVYYQT3AB5352
   status               Indication of the operation's result
   string      always   Sample:
                        success
   vdom                 Virtual domain used
   string      always   Sample:
                        root
   version              Version of the FortiGate
   string      always   Sample:
                        v5.6.3

STATUS                   *fortios_system_ha-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Miguel Angel Munoz (@mamunozgonzalez)
     • Nicolas Thomas (@thomnico)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *fortios_system_ha-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/fortios_system_ha_module.html
