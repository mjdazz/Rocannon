SYNOPSIS                   *postgresql_pg_hba*

     • The fundamental function of the module is to create, or delete lines in pg_hba files.
     • The lines in the file should be in a typical pg_hba form and lines should be unique per key (type, databases, users, source). If they are not unique and the SID is ‘the one to change’, only
       one for state=present or none for state=absent of the SID’s will remain.

REQUIREMENTS                   *postgresql_pg_hba-requirements*

   The below requirements are needed on the host that executes this module.

     • ipaddress

PARAMETERS                   *postgresql_pg_hba-parameters*

     Parameter   Choices/Defaults                                                                               Comments
                                   The source address/net where the connections could come from.
   address       Default:          Will not be used for entries of type=local.
   string        "samehost"        You can also use keywords all, samehost, and samenet.
                                   aliases: source, src
                                   The attributes the resulting file or directory should have.
   attributes                      To get supported flags look at the man page for chattr on the target system.
   string                          This string should contain the attributes in the same order as the one displayed by lsattr.
                                   The = operator is assumed as default, otherwise + or - operators need to be included in the string.
                                   aliases: attr
   backup          Choices:
   boolean         • no ←          If set, create a backup of the pg_hba file before it is modified. The location of the backup is returned in the (backup) variable by this module.
                   • yes
   backup_file                     Write backup to a specific backupfile rather than a temp file.
   string
                   Choices:
   contype         • local
   string          • host          Type of the rule. If not set, postgresql_pg_hba will only return contents.
                   • hostnossl
                   • hostssl
   create          Choices:        Create an pg_hba file if none exists.
   boolean         • no ←          When set to false, an error is raised when the pg_hba file doesn't exist.
                   • yes
   databases     Default:          Databases this line applies to.
   string        "all"
   dest
   path /                          Path to pg_hba file to modify.
   required
   group                           Name of the group that should own the file/directory, as would be fed to chown.
   string
                   Choices:
                   • cert
                   • gss
                   • ident
                   • krb5
                   • ldap
   method          • md5 ←
   string          • pam           Authentication method to be used.
                   • password
                   • peer
                   • radius
                   • reject
                   • scram-sha-256
                   • sspi
                   • trust
                                   The permissions the resulting file or directory should have.
                                   For those used to /usr/bin/chmod remember that modes are actually octal numbers. You must either add a leading zero so that Ansible's YAML parser knows it is an
   mode                            octal number (like 0644 or 01777) or quote it (like '644' or '1777') so Ansible receives a string and can do its own conversion from string into number.
   string                          Giving Ansible a number without following one of these rules will end up with a decimal number which will have unexpected results.
                                   As of Ansible 1.8, the mode may be specified as a symbolic mode (for example, u+rwx or u=rw,g=r,o=r).
                                   As of Ansible 2.6, the mode may also be the special string preserve.
                                   When set to preserve the file will be given the same permissions as the source file.
   netmask                         The netmask of the source address.
   string
   options                         Additional options for the authentication method.
   string
                   Choices:
                   • sdu ←
   order           • sud           The entries will be written out in a specific order. With this option you can control by which field they are ordered first, second and last. s=source,
   -               • dsu           d=databases, u=users. This option is deprecated since 2.9 and will be removed in 2.11. Sortorder is now hardcoded to sdu.
                   • dus
                   • usd
                   • uds
   owner                           Name of the user that should own the file/directory, as would be fed to chown.
   string
   selevel       Default:          The level part of the SELinux file context.
   string        "s0"              This is the MLS/MCS attribute, sometimes known as the range.
                                   When set to _default, it will use the level portion of the policy if available.
   serole                          The role part of the SELinux file context.
   string                          When set to _default, it will use the role portion of the policy if available.
   setype                          The type part of the SELinux file context.
   string                          When set to _default, it will use the type portion of the policy if available.
   seuser                          The user part of the SELinux file context.
   string                          By default it uses the system policy, where applicable.
                                   When set to _default, it will use the user portion of the policy if available.
   state           Choices:
   -               • absent        The lines will be added/modified when state=present and removed when state=absent.
                   • present ←
                                   Influence when to use atomic operation to prevent data corruption or inconsistent reads from the target file.
                                   By default this module uses atomic operations to prevent data corruption or inconsistent reads from the target files, but sometimes systems are configured or just
   unsafe_writes   Choices:        broken in ways that prevent this. One example is docker mounted files, which cannot be updated atomically from inside the container and can only be written in an
   boolean         • no ←          unsafe manner.
                   • yes           This option allows Ansible to fall back to unsafe methods of updating files when atomic operations fail (however, it doesn't force Ansible to perform unsafe
                                   writes).
                                   IMPORTANT! Unsafe writes are subject to race conditions and can lead to data corruption.
   users         Default:          Users this line applies to.
   -             "all"

NOTES                   *postgresql_pg_hba-notes*

   Note

     • The default authentication assumes that on the host, you are either logging in as or sudo’ing to an account with appropriate permissions to read and modify the file.
     • This module also returns the pg_hba info. You can use this module to only retrieve it by only specifying dest. The info can be found in the returned data under key pg_hba, being a list,
       containing a dict per rule.
     • This module will sort resulting pg_hba files if a rule change is required. This could give unexpected results with manual created hba files, if it was improperly sorted. For example a rule
       was created for a net first and for a ip in that net range next. In that situation, the ‘ip specific rule’ will never hit, it is in the pg_hba file obsolete. After the pg_hba file is
       rewritten by the postgresql_pg_hba module, the ip specific rule will be sorted above the range rule. And then it will hit, which will give unexpected results.
     • With the ‘order’ parameter you can control which field is used to sort first, next and last.
     • The module supports a check mode and a diff mode.

SEE ALSO                   *postgresql_pg_hba-see also*

   See also

   PostgreSQL pg_hba.conf file reference
   Complete reference of the PostgreSQL pg_hba.conf file documentation.

EXAMPLES                   *postgresql_pg_hba-examples*

 - name: Grant users joe and simon access to databases sales and logistics from ipv6 localhost ::1/128 using peer authentication.
   postgresql_pg_hba:
     dest: /var/lib/postgres/data/pg_hba.conf
     contype: host
     users: joe,simon
     source: ::1
     databases: sales,logistics
     method: peer
     create: true

 - name: Grant user replication from network 192.168.0.100/24 access for replication with client cert authentication.
   postgresql_pg_hba:
     dest: /var/lib/postgres/data/pg_hba.conf
     contype: host
     users: replication
     source: 192.168.0.100/24
     databases: replication
     method: cert

 - name: Revoke access from local user mary on database mydb.
   postgresql_pg_hba:
     dest: /var/lib/postgres/data/pg_hba.conf
     contype: local
     users: mary
     databases: mydb
     state: absent

RETURN VALUES                   *postgresql_pg_hba-return values*

   Common return values are documented here, the following are the fields unique to this module:

       Key     Returned                                                                                  Description
   backup_file          File that the original pg_hba file was backed up to
   string      changed  Sample:
                        /tmp/pg_hba_jxobj_p
   msgs                 List of textual messages what was done
   list        always   Sample:
                        {'msgs': ['Removing', 'Changed', 'Writing']}
   pg_hba               List of the pg_hba rules as they are configured in the specified hba file
   list        always   Sample:
                        {'pg_hba': [{'db': 'all', 'method': 'md5', 'src': 'samehost', 'type': 'host', 'usr': 'all'}]}

STATUS                   *postgresql_pg_hba-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Sebastiaan Mannem (@sebasmannem)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *postgresql_pg_hba-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/postgresql_pg_hba_module.html
