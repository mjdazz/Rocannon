SYNOPSIS                   *avi_virtualservice*

     • This module is used to configure VirtualService object
     • more examples at https://github.com/avinetworks/devops

REQUIREMENTS                   *avi_virtualservice-requirements*

   The below requirements are needed on the host that executes this module.

     • avisdk

PARAMETERS                   *avi_virtualservice-parameters*

               Parameter              Choices/Defaults                                                                    Comments
                                                       This configuration only applies if the virtualservice is in legacy active standby ha mode and load distribution among active standby is
                                                       enabled.
                                                       This field is used to tag the virtualservice so that virtualservices with the same tag will share the same active serviceengine.
   active_standby_se_tag                               Virtualservices with different tags will have different active serviceengines.
   -                                                   If one of the serviceengine's in the serviceenginegroup fails, all virtualservices will end up using the same active serviceengine.
                                                       Redistribution of the virtualservices can be either manual or automated when the failed serviceengine recovers.
                                                       Redistribution is based on the auto redistribute property of the serviceenginegroup.
                                                       Enum options - ACTIVE_STANDBY_SE_1, ACTIVE_STANDBY_SE_2.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as ACTIVE_STANDBY_SE_1.
   allow_invalid_client_cert            Choices:       Process request even if invalid client certificate is presented.
   boolean                              • no           Datascript apis need to be used for processing of such requests.
   added in 2.9                         • yes          Field introduced in 18.2.3.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as False.
   analytics_policy                                    Determines analytics settings for the application.
   -
   analytics_profile_ref                               Specifies settings related to analytics.
   -                                                   It is a reference to an object of type analyticsprofile.
   api_context                                         Avi API context that includes current session ID and CSRF Token.
   dictionary                                          This allows user to perform single login and re-use the session.
   added in 2.5
   api_version                        Default:         Avi API version of to use for Avi API and objects.
   string                             "16.4.4"
   apic_contract_graph                                 The name of the contract/graph associated with the virtual service.
   -                                                   Should be in the <contract name> <graph name> format.
   added in 2.9                                        This is applicable only for service integration mode with cisco apic controller.
                                                       Field introduced in 17.2.12,18.1.2.
   application_profile_ref                             Enable application layer specific features for the virtual service.
   -                                                   It is a reference to an object of type applicationprofile.
   auto_allocate_floating_ip            Choices:       Auto-allocate floating/elastic ip from the cloud infrastructure.
   boolean                              • no           Field deprecated in 17.1.1.
                                        • yes
   auto_allocate_ip                     Choices:       Auto-allocate vip from the provided subnet.
   boolean                              • no           Field deprecated in 17.1.1.
                                        • yes
   availability_zone                                   Availability-zone to place the virtual service.
   -                                                   Field deprecated in 17.1.1.
   avi_allocated_fip                    Choices:       (internal-use) fip allocated by avi in the cloud infrastructure.
   boolean                              • no           Field deprecated in 17.1.1.
                                        • yes
   avi_allocated_vip                    Choices:       (internal-use) vip allocated by avi in the cloud infrastructure.
   boolean                              • no           Field deprecated in 17.1.1.
                                        • yes
   avi_api_patch_op                     Choices:
   -                                    • add          Patch operation to use when using avi_api_update_method as patch.
   added in 2.5                         • replace
                                        • delete
   avi_api_update_method                Choices:       Default method for object update is HTTP PUT.
   -                                    • put ←        Setting to patch will override that behavior to use HTTP PATCH.
   added in 2.5                         • patch
   avi_credentials
   dictionary                                          Avi Credentials dictionary which can be used in lieu of enumerating Avi Controller login details.
   added in 2.5
                api_version           Default:         Avi controller version
                -                     "16.4.4"
                controller                             Avi controller IP or SQDN
                -
                csrftoken                              Avi controller API csrftoken to reuse existing session with session id
                -
                password                               Avi controller password
                -
                port                                   Avi controller port
                -
                session_id                             Avi controller API session id to reuse existing session with csrftoken
                -
                tenant                Default:         Avi controller tenant
                -                     "admin"
                tenant_uuid                            Avi controller tenant UUID
                -
                timeout               Default:         Avi controller request timeout
                -                     300
                token                                  Avi controller API token
                -
                username                               Avi controller username
                -
   avi_disable_session_cache_as_fact    Choices:
   boolean                              • no           It disables avi session information to be cached as a fact.
   added in 2.6                         • yes
   azure_availability_set                              (internal-use)applicable for azure only.
   -                                                   Azure availability set to which this vs is associated.
   added in 2.9                                        Internally set by the cloud connector.
                                                       Field introduced in 17.2.12, 18.1.2.
                                                       (this is a beta feature).
   bulk_sync_kvcache                    Choices:       Sync key-value cache to the new ses when vs is scaled out.
   boolean                              • no           For ex ssl sessions are stored using vs's key-value cache.
   added in 2.6                         • yes          When the vs is scaled out, the ssl session information is synced to the new se, allowing existing ssl sessions to be reused on the new se.
                                                       Field introduced in 17.2.7, 18.1.1.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as False.
   client_auth                                         Http authentication configuration for protected resources.
   -
   close_client_conn_on_config_update   Choices:       Close client connection on vs config update.
   boolean                              • no           Field introduced in 17.2.4.
   added in 2.5                         • yes          Default value when not specified in API or module is interpreted by Avi Controller as False.
   cloud_config_cksum                                  Checksum of cloud configuration for vs.
   -                                                   Internally set by cloud connector.
   cloud_ref                                           It is a reference to an object of type cloud.
   -
   cloud_type                                          Enum options - cloud_none, cloud_vcenter, cloud_openstack, cloud_aws, cloud_vca, cloud_apic, cloud_mesos, cloud_linuxserver, cloud_docker_ucp,
   -                                                   cloud_rancher, cloud_oshift_k8s, cloud_azure, cloud_gcp.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as CLOUD_NONE.
   connections_rate_limit                              Rate limit the incoming connections to this virtual service.
   -
   content_rewrite                                     Profile used to match and rewrite strings in request and/or response body.
   -
   controller                         Default:         IP address or hostname of the controller. The default value is the environment variable AVI_CONTROLLER.
   string                             ""
   created_by                                          Creator name.
   -
   delay_fairness                       Choices:       Select the algorithm for qos fairness.
   boolean                              • no           This determines how multiple virtual services sharing the same service engines will prioritize traffic over a congested network.
                                        • yes          Default value when not specified in API or module is interpreted by Avi Controller as False.
   description                                         User defined description for the object.
   -
                                                       (internal-use) discovered networks providing reachability for client facing virtual service ip.
   discovered_network_ref                              This field is deprecated.
   -                                                   It is a reference to an object of type network.
                                                       Field deprecated in 17.1.1.
   discovered_networks                                 (internal-use) discovered networks providing reachability for client facing virtual service ip.
   -                                                   This field is used internally by avi, not editable by the user.
                                                       Field deprecated in 17.1.1.
   discovered_subnet                                   (internal-use) discovered subnets providing reachability for client facing virtual service ip.
   -                                                   This field is deprecated.
                                                       Field deprecated in 17.1.1.
   dns_info                                            Service discovery specific data including fully qualified domain name, type and time-to-live of the dns record.
   -                                                   Note that only one of fqdn and dns_info setting is allowed.
   dns_policies                                        Dns policies applied on the dns traffic of the virtual service.
   -                                                   Field introduced in 17.1.1.
   added in 2.4
   east_west_placement                  Choices:       Force placement on all se's in service group (mesos mode only).
   boolean                              • no           Default value when not specified in API or module is interpreted by Avi Controller as False.
                                        • yes
   enable_autogw                        Choices:       Response traffic to clients will be sent back to the source mac address of the connection, rather than statically sent to a default gateway.
   boolean                              • no           Default value when not specified in API or module is interpreted by Avi Controller as True.
                                        • yes
   enable_rhi                           Choices:
   boolean                              • no           Enable route health injection using the bgp config in the vrf context.
                                        • yes
   enable_rhi_snat                      Choices:
   boolean                              • no           Enable route health injection for source nat'ted floating ip address using the bgp config in the vrf context.
                                        • yes
   enabled                              Choices:       Enable or disable the virtual service.
   boolean                              • no           Default value when not specified in API or module is interpreted by Avi Controller as True.
                                        • yes
   error_page_profile_ref                              Error page profile to be used for this virtualservice.this profile is used to send the custom error page to the client generated by the proxy.
   -                                                   It is a reference to an object of type errorpageprofile.
   added in 2.5                                        Field introduced in 17.2.4.
   floating_ip                                         Floating ip to associate with this virtual service.
   -                                                   Field deprecated in 17.1.1.
                                                       If auto_allocate_floating_ip is true and more than one floating-ip subnets exist, then the subnet for the floating ip address allocation.
   floating_subnet_uuid                                This field is applicable only if the virtualservice belongs to an openstack or aws cloud.
   -                                                   In openstack or aws cloud it is required when auto_allocate_floating_ip is selected.
                                                       Field deprecated in 17.1.1.
   flow_dist                                           Criteria for flow distribution among ses.
   -                                                   Enum options - LOAD_AWARE, CONSISTENT_HASH_SOURCE_IP_ADDRESS, CONSISTENT_HASH_SOURCE_IP_ADDRESS_AND_PORT.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as LOAD_AWARE.
   flow_label_type                                     Criteria for flow labelling.
   -                                                   Enum options - NO_LABEL, APPLICATION_LABEL, SERVICE_LABEL.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as NO_LABEL.
   fqdn                                                Dns resolvable, fully qualified domain name of the virtualservice.
   -                                                   Only one of 'fqdn' and 'dns_info' configuration is allowed.
   host_name_xlate                                     Translate the host name sent to the servers to this value.
   -                                                   Translate the host name sent from servers back to the value used by the client.
   http_policies                                       Http policies applied on the data traffic of the virtual service.
   -
   ign_pool_net_reach                   Choices:       Ignore pool servers network reachability constraints for virtual service placement.
   boolean                              • no           Default value when not specified in API or module is interpreted by Avi Controller as False.
                                        • yes
   ip_address                                          Ip address of the virtual service.
   -                                                   Field deprecated in 17.1.1.
   ipam_network_subnet                                 Subnet and/or network for allocating virtualservice ip by ipam provider module.
   -                                                   Field deprecated in 17.1.1.
   l4_policies                                         L4 policies applied to the data traffic of the virtual service.
   -                                                   Field introduced in 17.2.7.
   added in 2.6
   limit_doser                          Choices:       Limit potential dos attackers who exceed max_cps_per_client significantly to a fraction of max_cps_per_client for a while.
   boolean                              • no           Default value when not specified in API or module is interpreted by Avi Controller as False.
                                        • yes
                                                       Maximum connections per second per client ip.
   max_cps_per_client                                  Allowed values are 10-1000.
   -                                                   Special values are 0- 'unlimited'.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as 0.
   microservice_ref                                    Microservice representing the virtual service.
   -                                                   It is a reference to an object of type microservice.
   min_pools_up                                        Minimum number of up pools to mark vs up.
   -                                                   Field introduced in 18.2.1, 17.2.12.
   added in 2.9
   name                                                Name for the virtual service.
   - / required
   network_profile_ref                                 Determines network settings such as protocol, tcp or udp, and related options for the protocol.
   -                                                   It is a reference to an object of type networkprofile.
   network_ref                                         Manually override the network on which the virtual service is placed.
   -                                                   It is a reference to an object of type network.
                                                       Field deprecated in 17.1.1.
   network_security_policy_ref                         Network security policies for the virtual service.
   -                                                   It is a reference to an object of type networksecuritypolicy.
   nsx_securitygroup                                   A list of nsx service groups representing the clients which can access the virtual ip of the virtual service.
   -                                                   Field introduced in 17.1.1.
   added in 2.4
   password                           Default:         Password of Avi user in Avi controller. The default value is the environment variable AVI_PASSWORD.
   string                             ""
   performance_limits                                  Optional settings that determine performance limits like max connections or bandwidth etc.
   -
   pool_group_ref                                      The pool group is an object that contains pools.
   -                                                   It is a reference to an object of type poolgroup.
   pool_ref                                            The pool is an object that contains destination servers and related attributes such as load-balancing and persistence.
   -                                                   It is a reference to an object of type pool.
   port_uuid                                           (internal-use) network port assigned to the virtual service ip address.
   -                                                   Field deprecated in 17.1.1.
   remove_listening_port_on_vs_down     Choices:       Remove listening port if virtualservice is down.
   boolean                              • no           Default value when not specified in API or module is interpreted by Avi Controller as False.
                                        • yes
   requests_rate_limit                                 Rate limit the incoming requests to this virtual service.
   -
   saml_sp_config                                      Application-specific saml config.
   -                                                   Field introduced in 18.2.3.
   added in 2.9
   scaleout_ecmp                        Choices:       Disable re-distribution of flows across service engines for a virtual service.
   boolean                              • no           Enable if the network itself performs flow hashing with ecmp in environments such as gcp.
                                        • yes          Default value when not specified in API or module is interpreted by Avi Controller as False.
   se_group_ref                                        The service engine group to use for this virtual service.
   -                                                   Moving to a new se group is disruptive to existing connections for this vs.
                                                       It is a reference to an object of type serviceenginegroup.
   security_policy_ref                                 Security policy applied on the traffic of the virtual service.
   -                                                   This policy is used to perform security actions such as distributed denial of service (ddos) attack mitigation, etc.
   added in 2.9                                        It is a reference to an object of type securitypolicy.
                                                       Field introduced in 18.2.1.
   server_network_profile_ref                          Determines the network settings profile for the server side of tcp proxied connections.
   -                                                   Leave blank to use the same settings as the client to vs side of the connection.
                                                       It is a reference to an object of type networkprofile.
   service_metadata                                    Metadata pertaining to the service provided by this virtual service.
   -                                                   In openshift/kubernetes environments, egress pod info is stored.
   added in 2.4                                        Any user input to this field will be overwritten by avi vantage.
   service_pool_select                                 Select pool based on destination port.
   -
   services                                            List of services defined for this virtual service.
   -
   sideband_profile
   -                                                   Sideband configuration to be used for this virtualservice.it can be used for sending traffic to sideband vips for external inspection etc.
   added in 2.4
   snat_ip                                             Nat'ted floating source ip address(es) for upstream connection to servers.
   -
                                                       Gslb pools used to manage site-persistence functionality.
   sp_pool_refs                                        Each site-persistence pool contains the virtualservices in all the other sites, that is auto-generated by the gslb manager.
   -                                                   This is a read-only field for the user.
   added in 2.5                                        It is a reference to an object of type pool.
                                                       Field introduced in 17.2.2.
   ssl_key_and_certificate_refs                        Select or create one or two certificates, ec and/or rsa, that will be presented to ssl/tls terminated connections.
   -                                                   It is a reference to an object of type sslkeyandcertificate.
   ssl_profile_ref                                     Determines the set of ssl versions and ciphers to accept for ssl/tls terminated connections.
   -                                                   It is a reference to an object of type sslprofile.
   ssl_profile_selectors                               Select ssl profile based on client ip address match.
   -                                                   Field introduced in 18.2.3.
   added in 2.9
   ssl_sess_cache_avg_size                             Expected number of ssl session cache entries (may be exceeded).
   -                                                   Allowed values are 1024-16383.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as 1024.
   sso_policy                                          Client authentication and authorization policy for the virtualservice.
   -                                                   Field deprecated in 18.2.3.
   added in 2.9                                        Field introduced in 18.2.1.
   sso_policy_ref                                      The sso policy attached to the virtualservice.
   -                                                   It is a reference to an object of type ssopolicy.
   added in 2.9                                        Field introduced in 18.2.3.
   state                                Choices:
   -                                    • absent       The state that should be applied on the entity.
                                        • present ←
   static_dns_records                                  List of static dns records applied to this virtual service.
   -                                                   These are static entries and no health monitoring is performed against the ip addresses.
   subnet                                              Subnet providing reachability for client facing virtual service ip.
   -                                                   Field deprecated in 17.1.1.
                                                       It represents subnet for the virtual service ip address allocation when auto_allocate_ip is true.it is only applicable in openstack or aws
   subnet_uuid                                         cloud.
   -                                                   This field is required if auto_allocate_ip is true.
                                                       Field deprecated in 17.1.1.
   tenant                             Default:         Name of tenant used for all Avi API calls and context of object.
   string                             "admin"
   tenant_ref                                          It is a reference to an object of type tenant.
   -
   tenant_uuid                        Default:         UUID of tenant used for all Avi API calls and context of object.
   string                             ""
   topology_policies                                   Topology policies applied on the dns traffic of the virtual service based ongslb topology algorithm.
   -                                                   Field introduced in 18.2.3.
   added in 2.9
   traffic_clone_profile_ref                           Server network or list of servers for cloning traffic.
   -                                                   It is a reference to an object of type trafficcloneprofile.
   added in 2.4                                        Field introduced in 17.1.1.
   traffic_enabled                      Choices:       Knob to enable the virtual service traffic on its assigned service engines.
   boolean                              • no           This setting is effective only when the enabled flag is set to true.
   added in 2.6                         • yes          Field introduced in 17.2.8.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as True.
   type                                                Specify if this is a normal virtual service, or if it is the parent or child of an sni-enabled virtual hosted virtual service.
   -                                                   Enum options - VS_TYPE_NORMAL, VS_TYPE_VH_PARENT, VS_TYPE_VH_CHILD.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as VS_TYPE_NORMAL.
   url                                                 Avi controller URL of the object.
   -
   use_bridge_ip_as_vip                 Choices:       Use bridge ip as vip on each host in mesos deployments.
   boolean                              • no           Default value when not specified in API or module is interpreted by Avi Controller as False.
                                        • yes
                                                       Use the virtual ip as the snat ip for health monitoring and sending traffic to the backend servers instead of the service engine interface ip.
   use_vip_as_snat                      Choices:       The caveat of enabling this option is that the virtualservice cannot be configued in an active-active ha mode.
   boolean                              • no           Dns based multi vip solution has to be used for ha & non-disruptive upgrade purposes.
   added in 2.5                         • yes          Field introduced in 17.1.9,17.2.3.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as False.
   username                           Default:         Username used for accessing Avi controller. The default value is the environment variable AVI_USERNAME.
   string                             ""
   uuid                                                Uuid of the virtualservice.
   -
   vh_domain_name                                      The exact name requested from the client's sni-enabled tls hello domain name field.
   -                                                   If this is a match, the parent vs will forward the connection to this child vs.
   vh_parent_vs_uuid                                   Specifies the virtual service acting as virtual hosting (sni) parent.
   -
   vip                                                 List of virtual service ips.
   -                                                   While creating a 'shared vs',please use vsvip_ref to point to the shared entities.
   added in 2.4                                        Field introduced in 17.1.1.
   vrf_context_ref                                     Virtual routing context that the virtual service is bound to.
   -                                                   This is used to provide the isolation of the set of networks the application is attached to.
                                                       It is a reference to an object of type vrfcontext.
   vs_datascripts                                      Datascripts applied on the data traffic of the virtual service.
   -
   vsvip_cloud_config_cksum                            Checksum of cloud configuration for vsvip.
   -                                                   Internally set by cloud connector.
   added in 2.9                                        Field introduced in 17.2.9, 18.1.2.
   vsvip_ref                                           Mostly used during the creation of shared vs, this field refers to entities that can be shared across virtual services.
   -                                                   It is a reference to an object of type vsvip.
   added in 2.4                                        Field introduced in 17.1.1.
   waf_policy_ref                                      Waf policy for the virtual service.
   -                                                   It is a reference to an object of type wafpolicy.
   added in 2.5                                        Field introduced in 17.2.1.
                                                       The quality of service weight to assign to traffic transmitted from this virtual service.
   weight                                              A higher weight will prioritize traffic versus other virtual services sharing the same service engines.
   -                                                   Allowed values are 1-128.
                                                       Default value when not specified in API or module is interpreted by Avi Controller as 1.

NOTES                   *avi_virtualservice-notes*

   Note

     • For more information on using Ansible to manage Avi Network devices see https://www.ansible.com/ansible-avi-networks.

EXAMPLES                   *avi_virtualservice-examples*

 - name: Create SSL Virtual Service using Pool testpool2
   avi_virtualservice:
     controller: 10.10.27.90
     username: admin
     password: AviNetworks123!
     name: newtestvs
     state: present
     performance_limits:
     max_concurrent_connections: 1000
     services:
         - port: 443
           enable_ssl: true
         - port: 80
     ssl_profile_ref: '/api/sslprofile?name=System-Standard'
     application_profile_ref: '/api/applicationprofile?name=System-Secure-HTTP'
     ssl_key_and_certificate_refs:
         - '/api/sslkeyandcertificate?name=System-Default-Cert'
     ip_address:
     addr: 10.90.131.103
     type: V4
     pool_ref: '/api/pool?name=testpool2'

RETURN VALUES                   *avi_virtualservice-return values*

   Common return values are documented here, the following are the fields unique to this module:

      Key         Returned                                                                                  Description
   obj        success, changed VirtualService (api/virtualservice) object
   dictionary

STATUS                   *avi_virtualservice-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Gaurav Rastogi (@grastogi23) <grastogi@avinetworks.com>

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *avi_virtualservice-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/avi_virtualservice_module.html
