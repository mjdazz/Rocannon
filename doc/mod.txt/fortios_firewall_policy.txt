SYNOPSIS                   *fortios_firewall_policy*

     • This module is able to configure a FortiGate or FortiOS (FOS) device by allowing the user to set and modify firewall feature and policy category. Examples include all parameters and values
       need to be adjusted to datasources before usage. Tested with FOS v6.0.5

REQUIREMENTS                   *fortios_firewall_policy-requirements*

   The below requirements are needed on the host that executes this module.

     • fortiosapi>=0.9.8

PARAMETERS                   *fortios_firewall_policy-parameters*

            Parameter            Choices/Defaults                                                                       Comments
   firewall_policy              Default:            Configure IPv4 policies.
   dictionary                   null
                                  Choices:
    action                        • accept          Policy action (allow/deny/ipsec).
    string                        • deny
                                  • ipsec
    app_category                                    Application category ID list.
    list
           id                                       Category IDs.
           integer / required
    app_group                                       Application group names.
    list
           name                                     Application group names. Source application.group.name.
           string / required
    application                                     Application ID list.
    list
           id                                       Application IDs.
           integer / required
    application_list                                Name of an existing Application list. Source application.list.name.
    string
    auth_cert                                       HTTPS server certificate for policy authentication. Source vpn.certificate.local.name.
    string
    auth_path                     Choices:
    string                        • enable          Enable/disable authentication-based routing.
                                  • disable
    auth_redirect_addr                              HTTP-to-HTTPS redirect address for firewall authentication.
    string
    av_profile                                      Name of an existing Antivirus profile. Source antivirus.profile.name.
    string
    block_notification            Choices:
    string                        • enable          Enable/disable block notification.
                                  • disable
    captive_portal_exempt         Choices:
    string                        • enable          Enable to exempt some users from the captive portal.
                                  • disable
    capture_packet                Choices:
    string                        • enable          Enable/disable capture packets.
                                  • disable
    comments                                        Comment.
    string
    custom_log_fields                               Custom fields to append to log messages for this policy.
    list
           field_id                                 Custom log field. Source log.custom-field.id.
           string
    delay_tcp_npu_session         Choices:
    string                        • enable          Enable TCP NPU session delay to guarantee packet order of 3-way handshake.
                                  • disable
    devices                                         Names of devices or device groups that can be matched by the policy.
    list
           name                                     Device or group name. Source user.device.alias user.device-group.name user.device-category.name.
           string / required
    diffserv_forward              Choices:
    string                        • enable          Enable to change packet's DiffServ values to the specified diffservcode-forward value.
                                  • disable
    diffserv_reverse              Choices:
    string                        • enable          Enable to change packet's reverse (reply) DiffServ values to the specified diffservcode-rev value.
                                  • disable
    diffservcode_forward                            Change packet's DiffServ to this value.
    string
    diffservcode_rev                                Change packet's reverse (reply) DiffServ to this value.
    string
    disclaimer                    Choices:
    string                        • enable          Enable/disable user authentication disclaimer.
                                  • disable
    dlp_sensor                                      Name of an existing DLP sensor. Source dlp.sensor.name.
    string
    dnsfilter_profile                               Name of an existing DNS filter profile. Source dnsfilter.profile.name.
    string
    dscp_match                    Choices:
    string                        • enable          Enable DSCP check.
                                  • disable
    dscp_negate                   Choices:
    string                        • enable          Enable negated DSCP match.
                                  • disable
    dscp_value                                      DSCP value.
    string
    dsri                          Choices:
    string                        • enable          Enable DSRI to ignore HTTP server responses.
                                  • disable
    dstaddr                                         Destination address and address group names.
    list
           name                                     Address name. Source firewall.address.name firewall.addrgrp.name firewall.vip.name firewall.vipgrp.name.
           string / required
    dstaddr_negate                Choices:
    string                        • enable          When enabled dstaddr specifies what the destination address must NOT be.
                                  • disable
    dstintf                                         Outgoing (egress) interface.
    list
           name                                     Interface name. Source system.interface.name system.zone.name.
           string / required
    firewall_session_dirty        Choices:
    string                        • check-all       How to handle sessions if the configuration of this firewall policy changes.
                                  • check-new
    fixedport                     Choices:
    string                        • enable          Enable to prevent source NAT from changing a session's source port.
                                  • disable
    fsso                          Choices:
    string                        • enable          Enable/disable Fortinet Single Sign-On.
                                  • disable
    fsso_agent_for_ntlm                             FSSO agent to use for NTLM authentication. Source user.fsso.name.
    string
    global_label                                    Label for the policy that appears when the GUI is in Global View mode.
    string
    groups                                          Names of user groups that can authenticate with this policy.
    list
           name                                     Group name. Source user.group.name.
           string / required
    icap_profile                                    Name of an existing ICAP profile. Source icap.profile.name.
    string
    identity_based_route                            Name of identity-based routing rule. Source firewall.identity-based-route.name.
    string
    inbound                       Choices:
    string                        • enable          Policy-based IPsec VPN: only traffic from the remote network can initiate a VPN.
                                  • disable
    internet_service              Choices:
    string                        • enable          Enable/disable use of Internet Services for this policy. If enabled, destination address and service are not used.
                                  • disable
    internet_service_custom                         Custom Internet Service name.
    list
           name                                     Custom Internet Service name. Source firewall.internet-service-custom.name.
           string / required
    internet_service_id                             Internet Service ID.
    list
           id                                       Internet Service ID. Source firewall.internet-service.id.
           integer / required
    internet_service_negate       Choices:
    string                        • enable          When enabled internet-service specifies what the service must NOT be.
                                  • disable
    internet_service_src          Choices:
    string                        • enable          Enable/disable use of Internet Services in source for this policy. If enabled, source address is not used.
                                  • disable
    internet_service_src_custom                     Custom Internet Service source name.
    list
           name                                     Custom Internet Service name. Source firewall.internet-service-custom.name.
           string / required
    internet_service_src_id                         Internet Service source ID.
    list
           id                                       Internet Service ID. Source firewall.internet-service.id.
           integer / required
    internet_service_src_negate   Choices:
    string                        • enable          When enabled internet-service-src specifies what the service must NOT be.
                                  • disable
    ippool                        Choices:
    string                        • enable          Enable to use IP Pools for source NAT.
                                  • disable
    ips_sensor                                      Name of an existing IPS sensor. Source ips.sensor.name.
    string
    label                                           Label for the policy that appears when the GUI is in Section View mode.
    string
    learning_mode                 Choices:
    string                        • enable          Enable to allow everything, but log all of the meaningful data for security information gathering. A learning report will be generated.
                                  • disable
                                  Choices:
    logtraffic                    • all             Enable or disable logging. Log all sessions or security profile sessions.
    string                        • utm
                                  • disable
    logtraffic_start              Choices:
    string                        • enable          Record logs when a session starts and ends.
                                  • disable
    match_vip                     Choices:
    string                        • enable          Enable to match packets that have had their destination addresses changed by a VIP.
                                  • disable
    name                                            Policy name.
    string
    nat                           Choices:
    string                        • enable          Enable/disable source NAT.
                                  • disable
    natinbound                    Choices:
    string                        • enable          Policy-based IPsec VPN: apply destination NAT to inbound traffic.
                                  • disable
    natip                                           Policy-based IPsec VPN: source NAT IP address for outgoing traffic.
    string
    natoutbound                   Choices:
    string                        • enable          Policy-based IPsec VPN: apply source NAT to outbound traffic.
                                  • disable
    ntlm                          Choices:
    string                        • enable          Enable/disable NTLM authentication.
                                  • disable
    ntlm_enabled_browsers                           HTTP-User-Agent value of supported browsers.
    list
           user_agent_string                        User agent string.
           string
    ntlm_guest                    Choices:
    string                        • enable          Enable/disable NTLM guest user access.
                                  • disable
    outbound                      Choices:
    string                        • enable          Policy-based IPsec VPN: only traffic from the internal network can initiate a VPN.
                                  • disable
    per_ip_shaper                                   Per-IP traffic shaper. Source firewall.shaper.per-ip-shaper.name.
    string
    permit_any_host               Choices:
    string                        • enable          Accept UDP packets from any host.
                                  • disable
    permit_stun_host              Choices:
    string                        • enable          Accept UDP packets from any Session Traversal Utilities for NAT (STUN) host.
                                  • disable
    policyid                                        Policy ID.
    integer / required
    poolname                                        IP Pool names.
    list
           name                                     IP pool name. Source firewall.ippool.name.
           string / required
    profile_group                                   Name of profile group. Source firewall.profile-group.name.
    string
    profile_protocol_options                        Name of an existing Protocol options profile. Source firewall.profile-protocol-options.name.
    string
    profile_type                  Choices:
    string                        • single          Determine whether the firewall policy allows security profile groups or single profiles only.
                                  • group
    radius_mac_auth_bypass        Choices:
    string                        • enable          Enable MAC authentication bypass. The bypassed MAC address must be received from RADIUS server.
                                  • disable
    redirect_url                                    URL users are directed to after seeing and accepting the disclaimer or authenticating.
    string
    replacemsg_override_group                       Override the default replacement message group for this policy. Source system.replacemsg-group.name.
    string
    rsso                          Choices:
    string                        • enable          Enable/disable RADIUS single sign-on (RSSO).
                                  • disable
    rtp_addr                                        Address names if this is an RTP NAT policy.
    list
           name                                     Address name. Source firewall.address.name firewall.addrgrp.name.
           string / required
    rtp_nat                       Choices:
    string                        • disable         Enable Real Time Protocol (RTP) NAT.
                                  • enable
                                  Choices:
    scan_botnet_connections       • disable         Block or monitor connections to Botnet servers or disable Botnet scanning.
    string                        • block
                                  • monitor
    schedule                                        Schedule name. Source firewall.schedule.onetime.name firewall.schedule.recurring.name firewall.schedule.group.name.
    string
    schedule_timeout              Choices:
    string                        • enable          Enable to force current sessions to end when the schedule object times out. Disable allows them to end from inactivity.
                                  • disable
    send_deny_packet              Choices:
    string                        • disable         Enable to send a reply when a session is denied or blocked by a firewall policy.
                                  • enable
    service                                         Service and service group names.
    list
           name                                     Service and service group names. Source firewall.service.custom.name firewall.service.group.name.
           string / required
    service_negate                Choices:
    string                        • enable          When enabled service specifies what the service must NOT be.
                                  • disable
    session_ttl                                     TTL in seconds for sessions accepted by this policy (0 means use the system default session TTL).
    integer
    spamfilter_profile                              Name of an existing Spam filter profile. Source spamfilter.profile.name.
    string
    srcaddr                                         Source address and address group names.
    list
           name                                     Address name. Source firewall.address.name firewall.addrgrp.name.
           string / required
    srcaddr_negate                Choices:
    string                        • enable          When enabled srcaddr specifies what the source address must NOT be.
                                  • disable
    srcintf                                         Incoming (ingress) interface.
    list
           name                                     Interface name. Source system.interface.name system.zone.name.
           string / required
    ssh_filter_profile                              Name of an existing SSH filter profile. Source ssh-filter.profile.name.
    string
    ssl_mirror                    Choices:
    string                        • enable          Enable to copy decrypted SSL traffic to a FortiGate interface (called SSL mirroring).
                                  • disable
    ssl_mirror_intf                                 SSL mirror interface name.
    list
           name                                     Mirror Interface name. Source system.interface.name system.zone.name.
           string / required
    ssl_ssh_profile                                 Name of an existing SSL SSH profile. Source firewall.ssl-ssh-profile.name.
    string
                                                    Deprecated
                                  Choices:          Starting with Ansible 2.9 we recommend using the top-level 'state' parameter.
    state                         • present
    string                        • absent          ═════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

                                                    Indicates whether to create or remove the object.
    status                        Choices:
    string                        • enable          Enable or disable this policy.
                                  • disable
    tcp_mss_receiver                                Receiver TCP maximum segment size (MSS).
    integer
    tcp_mss_sender                                  Sender TCP maximum segment size (MSS).
    integer
                                  Choices:
    tcp_session_without_syn       • all             Enable/disable creation of TCP session without SYN flag.
    string                        • data-only
                                  • disable
    timeout_send_rst              Choices:
    string                        • enable          Enable/disable sending RST packets when TCP sessions expire.
                                  • disable
    traffic_shaper                                  Traffic shaper. Source firewall.shaper.traffic-shaper.name.
    string
    traffic_shaper_reverse                          Reverse traffic shaper. Source firewall.shaper.traffic-shaper.name.
    string
    url_category                                    URL category ID list.
    list
           id                                       URL category ID.
           integer / required
    users                                           Names of individual users that can authenticate with this policy.
    list
           name                                     Names of individual users that can authenticate with this policy. Source user.local.name.
           string / required
    utm_status                    Choices:
    string                        • enable          Enable to add one or more security profiles (AV, IPS, etc.) to the firewall policy.
                                  • disable
    uuid                                            Universally Unique Identifier (UUID; automatically assigned but can be manually reset).
    string
    vlan_cos_fwd                                    VLAN forward direction user priority: 255 passthrough, 0 lowest, 7 highest.
    integer
    vlan_cos_rev                                    VLAN reverse direction user priority: 255 passthrough, 0 lowest, 7 highest..
    integer
    vlan_filter                                     Set VLAN filters.
    string
    voip_profile                                    Name of an existing VoIP profile. Source voip.profile.name.
    string
    vpntunnel                                       Policy-based IPsec VPN: name of the IPsec VPN Phase 1. Source vpn.ipsec.phase1.name vpn.ipsec.manualkey.name.
    string
    waf_profile                                     Name of an existing Web application firewall profile. Source waf.profile.name.
    string
    wanopt                        Choices:
    string                        • enable          Enable/disable WAN optimization.
                                  • disable
                                  Choices:
    wanopt_detection              • active          WAN optimization auto-detection mode.
    string                        • passive
                                  • no
                                  Choices:
    wanopt_passive_opt            • default         WAN optimization passive mode options. This option decides what IP address will be used to connect server.
    string                        • transparent
                                  • non-transparent
    wanopt_peer                                     WAN optimization peer. Source wanopt.peer.peer-host-id.
    string
    wanopt_profile                                  WAN optimization profile. Source wanopt.profile.name.
    string
    wccp                          Choices:
    string                        • enable          Enable/disable forwarding traffic matching this policy to a configured WCCP server.
                                  • disable
    webcache                      Choices:
    string                        • enable          Enable/disable web cache.
                                  • disable
    webcache_https                Choices:
    string                        • disable         Enable/disable web cache for HTTPS.
                                  • enable
    webfilter_profile                               Name of an existing Web filter profile. Source webfilter.profile.name.
    string
    wsso                          Choices:
    string                        • enable          Enable/disable WiFi Single Sign On (WSSO).
                                  • disable
   host                                             FortiOS or FortiGate IP address.
   string
   https                          Choices:
   boolean                        • no              Indicates if the requests towards FortiGate must use HTTPS protocol.
                                  • yes ←
   password                     Default:            FortiOS or FortiGate password.
   string                       ""
   ssl_verify                     Choices:
   boolean                        • no              Ensures FortiGate certificate must be verified by a proper CA.
   added in 2.9                   • yes ←
   state                          Choices:          Indicates whether to create or remove the object. This attribute was present already in previous version in a deeper level. It has been moved out
   string                         • present         to this outer level.
   added in 2.9                   • absent
   username                                         FortiOS or FortiGate username.
   string
   vdom                         Default:            Virtual domain, among those defined previously. A vdom is a virtual instance of the FortiGate that can be configured and used as a different
   string                       "root"              unit.

NOTES                   *fortios_firewall_policy-notes*

   Note

     • Requires fortiosapi library developed by Fortinet
     • Run as a local_action in your playbook

EXAMPLES                   *fortios_firewall_policy-examples*

 - hosts: localhost
   vars:
    host: "192.168.122.40"
    username: "admin"
    password: ""
    vdom: "root"
    ssl_verify: "False"
   tasks:
   - name: Configure IPv4 policies.
     fortios_firewall_policy:
       host:  "{{ host }}"
       username: "{{ username }}"
       password: "{{ password }}"
       vdom:  "{{ vdom }}"
       https: "False"
       state: "present"
       firewall_policy:
         action: "accept"
         app_category:
          -
             id:  "5"
         app_group:
          -
             name: "default_name_7 (source application.group.name)"
         application:
          -
             id:  "9"
         application_list: "<your_own_value> (source application.list.name)"
         auth_cert: "<your_own_value> (source vpn.certificate.local.name)"
         auth_path: "enable"
         auth_redirect_addr: "<your_own_value>"
         av_profile: "<your_own_value> (source antivirus.profile.name)"
         block_notification: "enable"
         captive_portal_exempt: "enable"
         capture_packet: "enable"
         comments: "<your_own_value>"
         custom_log_fields:
          -
             field_id: "<your_own_value> (source log.custom-field.id)"
         delay_tcp_npu_session: "enable"
         devices:
          -
             name: "default_name_23 (source user.device.alias user.device-group.name user.device-category.name)"
         diffserv_forward: "enable"
         diffserv_reverse: "enable"
         diffservcode_forward: "<your_own_value>"
         diffservcode_rev: "<your_own_value>"
         disclaimer: "enable"
         dlp_sensor: "<your_own_value> (source dlp.sensor.name)"
         dnsfilter_profile: "<your_own_value> (source dnsfilter.profile.name)"
         dscp_match: "enable"
         dscp_negate: "enable"
         dscp_value: "<your_own_value>"
         dsri: "enable"
         dstaddr:
          -
             name: "default_name_36 (source firewall.address.name firewall.addrgrp.name firewall.vip.name firewall.vipgrp.name)"
         dstaddr_negate: "enable"
         dstintf:
          -
             name: "default_name_39 (source system.interface.name system.zone.name)"
         firewall_session_dirty: "check-all"
         fixedport: "enable"
         fsso: "enable"
         fsso_agent_for_ntlm: "<your_own_value> (source user.fsso.name)"
         global_label: "<your_own_value>"
         groups:
          -
             name: "default_name_46 (source user.group.name)"
         icap_profile: "<your_own_value> (source icap.profile.name)"
         identity_based_route: "<your_own_value> (source firewall.identity-based-route.name)"
         inbound: "enable"
         internet_service: "enable"
         internet_service_custom:
          -
             name: "default_name_52 (source firewall.internet-service-custom.name)"
         internet_service_id:
          -
             id:  "54 (source firewall.internet-service.id)"
         internet_service_negate: "enable"
         internet_service_src: "enable"
         internet_service_src_custom:
          -
             name: "default_name_58 (source firewall.internet-service-custom.name)"
         internet_service_src_id:
          -
             id:  "60 (source firewall.internet-service.id)"
         internet_service_src_negate: "enable"
         ippool: "enable"
         ips_sensor: "<your_own_value> (source ips.sensor.name)"
         label: "<your_own_value>"
         learning_mode: "enable"
         logtraffic: "all"
         logtraffic_start: "enable"
         match_vip: "enable"
         name: "default_name_69"
         nat: "enable"
         natinbound: "enable"
         natip: "<your_own_value>"
         natoutbound: "enable"
         ntlm: "enable"
         ntlm_enabled_browsers:
          -
             user_agent_string: "<your_own_value>"
         ntlm_guest: "enable"
         outbound: "enable"
         per_ip_shaper: "<your_own_value> (source firewall.shaper.per-ip-shaper.name)"
         permit_any_host: "enable"
         permit_stun_host: "enable"
         policyid: "82"
         poolname:
          -
             name: "default_name_84 (source firewall.ippool.name)"
         profile_group: "<your_own_value> (source firewall.profile-group.name)"
         profile_protocol_options: "<your_own_value> (source firewall.profile-protocol-options.name)"
         profile_type: "single"
         radius_mac_auth_bypass: "enable"
         redirect_url: "<your_own_value>"
         replacemsg_override_group: "<your_own_value> (source system.replacemsg-group.name)"
         rsso: "enable"
         rtp_addr:
          -
             name: "default_name_93 (source firewall.address.name firewall.addrgrp.name)"
         rtp_nat: "disable"
         scan_botnet_connections: "disable"
         schedule: "<your_own_value> (source firewall.schedule.onetime.name firewall.schedule.recurring.name firewall.schedule.group.name)"
         schedule_timeout: "enable"
         send_deny_packet: "disable"
         service:
          -
             name: "default_name_100 (source firewall.service.custom.name firewall.service.group.name)"
         service_negate: "enable"
         session_ttl: "102"
         spamfilter_profile: "<your_own_value> (source spamfilter.profile.name)"
         srcaddr:
          -
             name: "default_name_105 (source firewall.address.name firewall.addrgrp.name)"
         srcaddr_negate: "enable"
         srcintf:
          -
             name: "default_name_108 (source system.interface.name system.zone.name)"
         ssh_filter_profile: "<your_own_value> (source ssh-filter.profile.name)"
         ssl_mirror: "enable"
         ssl_mirror_intf:
          -
             name: "default_name_112 (source system.interface.name system.zone.name)"
         ssl_ssh_profile: "<your_own_value> (source firewall.ssl-ssh-profile.name)"
         status: "enable"
         tcp_mss_receiver: "115"
         tcp_mss_sender: "116"
         tcp_session_without_syn: "all"
         timeout_send_rst: "enable"
         traffic_shaper: "<your_own_value> (source firewall.shaper.traffic-shaper.name)"
         traffic_shaper_reverse: "<your_own_value> (source firewall.shaper.traffic-shaper.name)"
         url_category:
          -
             id:  "122"
         users:
          -
             name: "default_name_124 (source user.local.name)"
         utm_status: "enable"
         uuid: "<your_own_value>"
         vlan_cos_fwd: "127"
         vlan_cos_rev: "128"
         vlan_filter: "<your_own_value>"
         voip_profile: "<your_own_value> (source voip.profile.name)"
         vpntunnel: "<your_own_value> (source vpn.ipsec.phase1.name vpn.ipsec.manualkey.name)"
         waf_profile: "<your_own_value> (source waf.profile.name)"
         wanopt: "enable"
         wanopt_detection: "active"
         wanopt_passive_opt: "default"
         wanopt_peer: "<your_own_value> (source wanopt.peer.peer-host-id)"
         wanopt_profile: "<your_own_value> (source wanopt.profile.name)"
         wccp: "enable"
         webcache: "enable"
         webcache_https: "disable"
         webfilter_profile: "<your_own_value> (source webfilter.profile.name)"
         wsso: "enable"

RETURN VALUES                   *fortios_firewall_policy-return values*

   Common return values are documented here, the following are the fields unique to this module:

       Key     Returned                                                                                  Description
   build                Build number of the fortigate image
   string      always   Sample:
                        1547
   http_method          Last method used to provision the content into FortiGate
   string      always   Sample:
                        PUT
   http_status          Last result given by FortiGate on last operation applied
   string      always   Sample:
                        200
   mkey                 Master key (id) used in the last call to FortiGate
   string      success  Sample:
                        id
   name                 Name of the table used to fulfill the request
   string      always   Sample:
                        urlfilter
   path                 Path of the table used to fulfill the request
   string      always   Sample:
                        webfilter
   revision             Internal revision number
   string      always   Sample:
                        17.0.2.10658
   serial               Serial number of the unit
   string      always   Sample:
                        FGVMEVYYQT3AB5352
   status               Indication of the operation's result
   string      always   Sample:
                        success
   vdom                 Virtual domain used
   string      always   Sample:
                        root
   version              Version of the FortiGate
   string      always   Sample:
                        v5.6.3

STATUS                   *fortios_firewall_policy-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Miguel Angel Munoz (@mamunozgonzalez)
     • Nicolas Thomas (@thomnico)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *fortios_firewall_policy-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/fortios_firewall_policy_module.html
