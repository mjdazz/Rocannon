SYNOPSIS                   *ec2_instance*

     • Create and manage AWS EC2 instance

REQUIREMENTS                   *ec2_instance-requirements*

   The below requirements are needed on the host that executes this module.

     • boto
     • boto3
     • botocore
     • python >= 2.6

PARAMETERS                   *ec2_instance-parameters*

                Parameter                          Choices/Defaults                                                                   Comments
   availability_zone                                                           Specify an availability zone to use the default subnet it. Useful if not specifying the vpc_subnet_id parameter.
   -                                                                           If no subnet, ENI, or availability zone is provided, the default subnet in the default VPC will be used in the first
                                                                               AZ (alphabetically sorted).
   aws_access_key                                                              AWS access key. If not set then the value of the AWS_ACCESS_KEY_ID, AWS_ACCESS_KEY or EC2_ACCESS_KEY environment
   string                                                                      variable is used.
                                                                               aliases: ec2_access_key, access_key
   aws_secret_key                                                              AWS secret key. If not set then the value of the AWS_SECRET_ACCESS_KEY, AWS_SECRET_KEY, or EC2_SECRET_KEY environment
   string                                                                      variable is used.
                                                                               aliases: ec2_secret_key, secret_key
   cpu_credit_specification               Choices:                             For T2 series instances, choose whether to allow increased charges to buy CPU credits if the default pool is depleted.
   -                                      • unlimited                          Choose unlimited to enable buying additional CPU credits.
                                          • standard
   cpu_options                                                                 Reduce the number of vCPU exposed to the instance.
   -                                                                           Those parameters can only be set at instance launch. The two suboptions threads_per_core and core_count are mandatory.
   added in 2.7                                                                See https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-optimize-cpu.html for combinations available.
                                                                               Requires botocore >= 1.10.16
              core_count                                                       Set the number of core to enable.
              - / required
              threads_per_core            Choices:
              - / required                • 1                                  Select the number of threads per core to enable. Disable or Enable Intel HT.
                                          • 2
   debug_botocore_endpoint_logs           Choices:                             Use a botocore.endpoint logger to parse the unique (rather than total) "resource:action" API calls made during a task,
   boolean                                • no ←                               outputing the set to the resource_actions key in the task results. Use the aws_resource_action callback to output to
   added in 2.8                           • yes                                total list made during a playbook. The ANSIBLE_DEBUG_BOTOCORE_LOGS environment variable may also be used.
   detailed_monitoring                    Choices:
   boolean                                • no                                 Whether to allow detailed cloudwatch metrics to be collected, enabling more detailed alerting.
                                          • yes
   ebs_optimized                          Choices:                             Whether instance is should use optimized EBS volumes, see
   boolean                                • no                                 https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSOptimized.html.
                                          • yes
   ec2_url                                                                     Url to use to connect to EC2 or your Eucalyptus cloud (by default the module will use EC2 endpoints). Ignored for
   string                                                                      modules where region is required. Must be specified for all other modules if region is not used. If not set then the
                                                                               value of the EC2_URL environment variable, if any, is used.
                                        Default:                               A dict of filters to apply when deciding whether existing instances match and should be altered. Each dict item
                                        {"subnet-id":                          consists of a filter key and a filter value. See
   filters                              "\u003cprovided-or-default             https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeInstances.html. for possible filters. Filter names
   -                                    subnet\u003e", "tag:Name":             and values are case sensitive. By default, instances are filtered for counting by their "Name" tag, base AMI, state
                                        "\u003cprovided-Name-attribute\u003e"} (running, by default), and subnet ID. Any queryable filter can be used. Good candidates are specific tags, SSH keys,
                                                                               or security groups.
                                                                               An image to use for the instance. The ec2_ami_info module may be used to retrieve images. One of image or image_id are
                                                                               required when instance is not already present.
   image                                                                       Complex object containing image.id, image.ramdisk, and image.kernel.
   -                                                                           image.id is the AMI ID.
                                                                               image.ramdisk overrides the AMI's default ramdisk ID.
                                                                               image.kernel is a string AKI to override the AMI kernel.
   image_id                                                                    ami ID to use for the instance. One of image or image_id are required when instance is not already present.
   -                                                                           This is an alias for image.id.
   instance_ids                                                                If you specify one or more instance IDs, only instances that have the specified IDs are returned.
   -
   instance_initiated_shutdown_behavior   Choices:
   -                                      • stop                               Whether to stop or terminate an instance upon shutdown.
                                          • terminate
                                                                               The ARN or name of an EC2-enabled instance role to be used. If a name is not provided in arn format then the
   instance_role                                                               ListInstanceProfiles permission must also be granted.
   -                                                                           https://docs.aws.amazon.com/IAM/latest/APIReference/API_ListInstanceProfiles.html If no full ARN is provided, the role
                                                                               with a matching name will be used from the active AWS account.
   instance_type                        Default:                               Instance type to use for the instance, see https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instance-types.html
   -                                    "t2.micro"                             Only required when instance is not already present.
   key_name                                                                    Name of the SSH access key to assign to the instance - must exist in the region the instance is created.
   -
                                                                               The EC2 launch template to base instance configuration on.
   launch_template                                                             launch_template.id the ID or the launch template (optional if name is specified).
   -                                                                           launch_template.name the pretty name of the launch template (optional if id is specified).
                                                                               launch_template.version the specific version of the launch template to use. If unspecified, the template default is
                                                                               chosen.
   name                                                                        The Name tag for the instance.
   -
                                                                               Either a dictionary containing the key 'interfaces' corresponding to a list of network interface IDs or containing
                                                                               specifications for a single network interface.
   network                                                                     If specifications for a single network are given, accepted keys are assign_public_ip (bool), private_ip_address (str),
   -                                                                           ipv6_addresses (list), source_dest_check (bool), description (str), delete_on_termination (bool), device_index (int),
                                                                               groups (list of security group IDs), private_ip_addresses (list), subnet_id (str).
                                                                               network.interfaces should be a list of ENI IDs (strings) or a list of objects containing the key id.
                                                                               Use the ec2_eni to create ENIs with special settings.
   placement_group
   -                                                                           The placement group that needs to be assigned to the instance
   added in 2.8
   profile                                                                     Uses a boto profile. Only works with boto >= 2.24.0.
   string
   purge_tags                             Choices:                             Delete any tags not specified in the task that are on the instance. This means you have to specify all the desired
   boolean                                • no ←                               tags on each task affecting an instance.
                                          • yes
   region                                                                      The AWS region to use. If not specified then the value of the AWS_REGION or EC2_REGION environment variable, if any,
   string                                                                      is used. See http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region
                                                                               aliases: aws_region, ec2_region
   security_group                                                              A security group ID or name. Mutually exclusive with security_groups.
   -
   security_groups                                                             A list of security group IDs or names (strings). Mutually exclusive with security_group.
   -
   security_token                                                              AWS STS security token. If not set then the value of the AWS_SECURITY_TOKEN or EC2_SECURITY_TOKEN environment variable
   string                                                                      is used.
                                                                               aliases: access_token
                                          Choices:
                                          • present ←
                                          • terminated
   state                                  • running
   -                                      • started                            Goal state for the instances.
                                          • stopped
                                          • restarted
                                          • rebooted
                                          • absent
   tags                                                                        A hash/dictionary of tags to add to the new instance or to add/remove from an existing one.
   -
   tenancy                                Choices:                             What type of tenancy to allow an instance to use. Default is shared tenancy. Dedicated tenancy will incur additional
   -                                      • dedicated                          charges.
                                          • default
   termination_protection                 Choices:                             Whether to enable termination protection. This module will not terminate an instance with termination protection
   boolean                                • no                                 active, it must be turned off first.
                                          • yes
                                                                               Preconfigured user-data to enable an instance to perform a Tower callback (Linux only).
                                                                               Mutually exclusive with user_data.
   tower_callback                                                              For Windows instances, to enable remote access via Ansible set tower_callback.windows to true, and optionally set an
   -                                                                           admin password.
                                                                               If using 'windows' and 'set_password', callback to Tower will not be performed but the instance will be ready to
                                                                               receive winrm connections from Ansible.
              host_config_key                                                  Host configuration secret key generated by the Tower job template.
              -
              job_template_id                                                  Either the integer ID of the Tower Job Template, or the name (name supported only for Tower 3.2+).
              -
              tower_address                                                    IP address or DNS name of Tower server. Must be accessible via this address from the VPC that this instance will be
              -                                                                launched in.
   user_data                                                                   Opaque blob of data which is made available to the ec2 instance
   -
   validate_certs                         Choices:
   boolean                                • no                                 When set to "no", SSL certificates will not be validated for boto versions >= 2.6.0.
                                          • yes ←
                                                                               A list of block device mappings, by default this will always use the AMI root device so the volumes option is
                                                                               primarily for adding more storage.
   volumes                                                                     A mapping contains the (optional) keys device_name, virtual_name, ebs.volume_type, ebs.volume_size, ebs.kms_key_id,
   -                                                                           ebs.iops, and ebs.delete_on_termination.
                                                                               For more information about each parameter, see
                                                                               https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_BlockDeviceMapping.html.
   vpc_subnet_id                                                               The subnet ID in which to launch the instance (VPC) If none is provided, ec2_instance will chose the default zone of
   -                                                                           the default VPC.
                                                                               aliases: subnet_id
   wait                                   Choices:
   boolean                                • no                                 Whether or not to wait for the desired state (use wait_timeout to customize this).
                                          • yes ←
   wait_timeout                         Default:                               How long to wait (in seconds) for the instance to finish booting/terminating.
   -                                    600

NOTES                   *ec2_instance-notes*

   Note

     • If parameters are not set within the module, the following environment variables can be used in decreasing order of precedence AWS_URL or EC2_URL, AWS_ACCESS_KEY_ID or AWS_ACCESS_KEY or
       EC2_ACCESS_KEY, AWS_SECRET_ACCESS_KEY or AWS_SECRET_KEY or EC2_SECRET_KEY, AWS_SECURITY_TOKEN or EC2_SECURITY_TOKEN, AWS_REGION or EC2_REGION
     • Ansible uses the boto configuration file (typically ~/.boto) if no credentials are provided. See https://boto.readthedocs.io/en/latest/boto_config_tut.html
     • AWS_REGION or EC2_REGION can be typically be used to specify the AWS region, when required, but this can also be configured in the boto config file

EXAMPLES                   *ec2_instance-examples*

 # Note: These examples do not set authentication details, see the AWS Guide for details.

 # Terminate every running instance in a region. Use with EXTREME caution.
 - ec2_instance:
     state: absent
     filters:
       instance-state-name: running

 # restart a particular instance by its ID
 - ec2_instance:
     state: restarted
     instance_ids:
       - i-12345678

 # start an instance with a public IP address
 - ec2_instance:
     name: "public-compute-instance"
     key_name: "prod-ssh-key"
     vpc_subnet_id: subnet-5ca1ab1e
     instance_type: c5.large
     security_group: default
     network:
       assign_public_ip: true
     image_id: ami-123456
     tags:
       Environment: Testing

 # start an instance and Add EBS
 - ec2_instance:
     name: "public-withebs-instance"
     vpc_subnet_id: subnet-5ca1ab1e
     instance_type: t2.micro
     key_name: "prod-ssh-key"
     security_group: default
     volumes:
       - device_name: /dev/sda1
         ebs:
           volume_size: 16
           delete_on_termination: true

 # start an instance with a cpu_options
 - ec2_instance:
     name: "public-cpuoption-instance"
     vpc_subnet_id: subnet-5ca1ab1e
     tags:
       Environment: Testing
     instance_type: c4.large
     volumes:
     - device_name: /dev/sda1
       ebs:
         delete_on_termination: true
     cpu_options:
         core_count: 1
         threads_per_core: 1

 # start an instance and have it begin a Tower callback on boot
 - ec2_instance:
     name: "tower-callback-test"
     key_name: "prod-ssh-key"
     vpc_subnet_id: subnet-5ca1ab1e
     security_group: default
     tower_callback:
       # IP or hostname of tower server
       tower_address: 1.2.3.4
       job_template_id: 876
       host_config_key: '[secret config key goes here]'
     network:
       assign_public_ip: true
     image_id: ami-123456
     cpu_credit_specification: unlimited
     tags:
       SomeThing: "A value"

 # start an instance with ENI (An existing ENI ID is required)
 - ec2_instance:
     name: "public-eni-instance"
     key_name: "prod-ssh-key"
     vpc_subnet_id: subnet-5ca1ab1e
     network:
       interfaces:
         - id: "eni-12345"
     tags:
       Env: "eni_on"
     volumes:
     - device_name: /dev/sda1
       ebs:
         delete_on_termination: true
     instance_type: t2.micro
     image_id: ami-123456

 # add second ENI interface
 - ec2_instance:
     name: "public-eni-instance"
     network:
       interfaces:
         - id: "eni-12345"
         - id: "eni-67890"
     image_id: ami-123456
     tags:
       Env: "eni_on"
     instance_type: t2.micro

RETURN VALUES                   *ec2_instance-return values*

   Common return values are documented here, the following are the fields unique to this module:

               Key                 Returned                                                                          Description
   instances                   when wait == true a list of ec2 instances
   complex
     ami_launch_index          always            The AMI launch index, which can be used to find this instance in the launch group.
     integer
     architecture                                The architecture of the image
     string                    always            Sample:
                                                 x86_64
     block_device_mappings     always            Any block device mapping entries for the instance.
     complex
       device_name                               The device name exposed to the instance (for example, /dev/sdh or xvdh).
       string                  always            Sample:
                                                 /dev/sdh
       ebs                     always            Parameters used to automatically set up EBS volumes when the instance is launched.
       complex
         attach_time                             The time stamp when the attachment initiated.
         string                always            Sample:
                                                 2017-03-23T22:51:24+00:00
         delete_on_termination                   Indicates whether the volume is deleted on instance termination.
         boolean               always            Sample:
                                                 True
         status                                  The attachment state.
         string                always            Sample:
                                                 attached
         volume_id                               The ID of the EBS volume
         string                always            Sample:
                                                 vol-12345678
     client_token                                The idempotency token you provided when you launched the instance, if applicable.
     string                    always            Sample:
                                                 mytoken
     ebs_optimized             always            Indicates whether the instance is optimized for EBS I/O.
     boolean
     hypervisor                                  The hypervisor type of the instance.
     string                    always            Sample:
                                                 xen
     iam_instance_profile      always            The IAM instance profile associated with the instance, if applicable.
     complex
       arn                                       The Amazon Resource Name (ARN) of the instance profile.
       string                  always            Sample:
                                                 arn:aws:iam::000012345678:instance-profile/myprofile
       id                                        The ID of the instance profile
       string                  always            Sample:
                                                 JFJ397FDG400FG9FD1N
     image_id                                    The ID of the AMI used to launch the instance.
     string                    always            Sample:
                                                 ami-0011223344
     instance_id                                 The ID of the instance.
     string                    always            Sample:
                                                 i-012345678
     instance_type                               The instance type size of the running instance.
     string                    always            Sample:
                                                 t2.micro
     key_name                                    The name of the key pair, if this instance was launched with an associated key pair.
     string                    always            Sample:
                                                 my-key
     launch_time                                 The time the instance was launched.
     string                    always            Sample:
                                                 2017-03-23T22:51:24+00:00
     monitoring                always            The monitoring for the instance.
     complex
       state                                     Indicates whether detailed monitoring is enabled. Otherwise, basic monitoring is enabled.
       string                  always            Sample:
                                                 disabled
     network.source_dest_check                   Indicates whether source/destination checking is enabled.
     boolean                   always            Sample:
                                                 True
     network_interfaces        always            One or more network interfaces for the instance.
     complex
       association             always            The association information for an Elastic IPv4 associated with the network interface.
       complex
         ip_owner_id                             The ID of the owner of the Elastic IP address.
         string                always            Sample:
                                                 amazon
         public_dns_name       always            The public DNS name.
         string
         public_ip                               The public IP address or Elastic IP address bound to the network interface.
         string                always            Sample:
                                                 1.2.3.4
       attachment              always            The network interface attachment.
       complex
         attach_time                             The time stamp when the attachment initiated.
         string                always            Sample:
                                                 2017-03-23T22:51:24+00:00
         attachment_id                           The ID of the network interface attachment.
         string                always            Sample:
                                                 eni-attach-3aff3f
         delete_on_termination                   Indicates whether the network interface is deleted when the instance is terminated.
         boolean               always            Sample:
                                                 True
         device_index          always            The index of the device on the instance for the network interface attachment.
         integer
         status                                  The attachment state.
         string                always            Sample:
                                                 attached
       description                               The description.
       string                  always            Sample:
                                                 My interface
       groups                  always            One or more security groups.
       list of complex
         group_id                                The ID of the security group.
         string                always            Sample:
                                                 sg-abcdef12
         group_name                              The name of the security group.
         string                always            Sample:
                                                 mygroup
       ipv6_addresses          always            One or more IPv6 addresses associated with the network interface.
       complex
         ipv6_address                            The IPv6 address.
         string                always            Sample:
                                                 2001:0db8:85a3:0000:0000:8a2e:0370:7334
       mac_address                               The MAC address.
       string                  always            Sample:
                                                 00:11:22:33:44:55
       network_interface_id                      The ID of the network interface.
       string                  always            Sample:
                                                 eni-01234567
       owner_id                                  The AWS account ID of the owner of the network interface.
       string                  always            Sample:
                                                 01234567890
       private_ip_address                        The IPv4 address of the network interface within the subnet.
       string                  always            Sample:
                                                 10.0.0.1
       private_ip_addresses    always            The private IPv4 addresses associated with the network interface.
       list of complex
         association           always            The association information for an Elastic IP address (IPv4) associated with the network interface.
         complex
             ip_owner_id                         The ID of the owner of the Elastic IP address.
             string            always            Sample:
                                                 amazon
             public_dns_name   always            The public DNS name.
             string
             public_ip                           The public IP address or Elastic IP address bound to the network interface.
             string            always            Sample:
                                                 1.2.3.4
         primary                                 Indicates whether this IPv4 address is the primary private IP address of the network interface.
         boolean               always            Sample:
                                                 True
         private_ip_address                      The private IPv4 address of the network interface.
         string                always            Sample:
                                                 10.0.0.1
       source_dest_check                         Indicates whether source/destination checking is enabled.
       boolean                 always            Sample:
                                                 True
       status                                    The status of the network interface.
       string                  always            Sample:
                                                 in-use
       subnet_id                                 The ID of the subnet for the network interface.
       string                  always            Sample:
                                                 subnet-0123456
       vpc_id                                    The ID of the VPC for the network interface.
       string                  always            Sample:
                                                 vpc-0123456
     placement                 always            The location where the instance launched, if applicable.
     complex
       availability_zone                         The Availability Zone of the instance.
       string                  always            Sample:
                                                 ap-southeast-2a
       group_name              always            The name of the placement group the instance is in (for cluster compute instances).
       string
       tenancy                                   The tenancy of the instance (if the instance is running in a VPC).
       string                  always            Sample:
                                                 default
     private_dns_name                            The private DNS name.
     string                    always            Sample:
                                                 ip-10-0-0-1.ap-southeast-2.compute.internal
     private_ip_address                          The IPv4 address of the network interface within the subnet.
     string                    always            Sample:
                                                 10.0.0.1
     product_codes             always            One or more product codes.
     list of complex
       product_code_id                           The product code.
       string                  always            Sample:
                                                 aw0evgkw8ef3n2498gndfgasdfsd5cce
       product_code_type                         The type of product code.
       string                  always            Sample:
                                                 marketplace
     public_dns_name           always            The public DNS name assigned to the instance.
     string
     public_ip_address                           The public IPv4 address assigned to the instance
     string                    always            Sample:
                                                 52.0.0.1
     root_device_name                            The device name of the root device
     string                    always            Sample:
                                                 /dev/sda1
     root_device_type                            The type of root device used by the AMI.
     string                    always            Sample:
                                                 ebs
     security_groups           always            One or more security groups for the instance.
     list of complex
       group_id                                  The ID of the security group.
       string                  always            Sample:
                                                 sg-0123456
       group_name                                The name of the security group.
       string                  always            Sample:
                                                 my-security-group
     state                     always            The current state of the instance.
     complex
       code                                      The low byte represents the state.
       integer                 always            Sample:
                                                 16
       name                                      The name of the state.
       string                  always            Sample:
                                                 running
     state_transition_reason   always            The reason for the most recent state transition.
     string
     subnet_id                                   The ID of the subnet in which the instance is running.
     string                    always            Sample:
                                                 subnet-00abcdef
     tags                      always            Any tags assigned to the instance.
     dictionary
     virtualization_type                         The type of virtualization of the AMI.
     string                    always            Sample:
                                                 hvm
     vpc_id                                      The ID of the VPC the instance is in.
     dictionary                always            Sample:
                                                 vpc-0011223344

STATUS                   *ec2_instance-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Ryan Scott Brown (@ryansb)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *ec2_instance-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/ec2_instance_module.html
