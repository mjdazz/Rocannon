SYNOPSIS                   *postgresql_slot*

     • Add or remove physical or logical replication slots from a PostgreSQL database.

REQUIREMENTS                   *postgresql_slot-requirements*

   The below requirements are needed on the host that executes this module.

     • psycopg2

PARAMETERS                   *postgresql_slot-parameters*

        Parameter      Choices/Defaults                                                                           Comments
   ca_cert                              Specifies the name of a file containing SSL certificate authority (CA) certificate(s).
   string                               If the file exists, the server's certificate will be verified to be signed by one of these authorities.
                                        aliases: ssl_rootcert
   db                                   Name of database to connect to.
   string                               aliases: login_db
                                        Optional parameter that when yes specifies that the LSN for this replication slot be reserved immediately, otherwise the default, no, specifies that the LSN
   immediately_reserve   Choices:       is reserved on the first connection from a streaming replication client.
   boolean               • no ←         Is available from PostgreSQL version 9.6.
                         • yes          Uses only with slot_type=physical.
                                        Mutually exclusive with slot_type=logical.
   login_host                           Host running the database.
   string
   login_password                       The password used to authenticate with.
   string
   login_unix_socket                    Path to a Unix domain socket for local connections.
   string
   login_user          Default:         The username used to authenticate with.
   string              "postgres"
   name                                 Name of the replication slot to add or remove.
   string / required                    aliases: slot_name
   output_plugin       Default:         All logical slots must indicate which output plugin decoder they're using.
   string              "test_decoding"  This parameter does not apply to physical slots.
                                        It will be ignored with slot_type=physical.
   port                Default:         Database port to connect to.
   integer             5432             aliases: login_port
   session_role                         Switch to session_role after connecting. The specified session_role must be a role that the current login_user is a member of.
   string                               Permissions checking for SQL commands is carried out as though the session_role were the one that had logged in originally.
   slot_type             Choices:
   string                • logical      Slot type.
                         • physical ←
                         Choices:
                         • allow
   ssl_mode              • disable      Determines whether or with what priority a secure SSL TCP/IP connection will be negotiated with the server.
   string                • prefer ←     See https://www.postgresql.org/docs/current/static/libpq-ssl.html for more information on the modes.
                         • require      Default of prefer matches libpq default.
                         • verify-ca
                         • verify-full
   state                 Choices:       The slot state.
   string                • absent       state=present implies the slot must be present in the system.
                         • present ←    state=absent implies the groups must be revoked from target_roles.

NOTES                   *postgresql_slot-notes*

   Note

     • Physical replication slots were introduced to PostgreSQL with version 9.4, while logical replication slots were added beginning with version 10.0.
     • The default authentication assumes that you are either logging in as or sudo’ing to the postgres account on the host.
     • To avoid “Peer authentication failed for user postgres” error, use postgres user as a become_user.
     • This module uses psycopg2, a Python PostgreSQL database adapter. You must ensure that psycopg2 is installed on the host before using this module.
     • If the remote host is the PostgreSQL server (which is the default case), then PostgreSQL must also be installed on the remote host.
     • For Ubuntu-based systems, install the postgresql, libpq-dev, and python-psycopg2 packages on the remote host before using this module.
     • The ca_cert parameter requires at least Postgres version 8.4 and psycopg2 version 2.4.3.

SEE ALSO                   *postgresql_slot-see also*

   See also

   PostgreSQL pg_replication_slots view reference
   Complete reference of the PostgreSQL pg_replication_slots view.

   PostgreSQL streaming replication protocol reference
   Complete reference of the PostgreSQL streaming replication protocol documentation.

   PostgreSQL logical replication protocol reference
   Complete reference of the PostgreSQL logical replication protocol documentation.

EXAMPLES                   *postgresql_slot-examples*

 - name: Create physical_one physical slot if doesn't exist
   become_user: postgres
   postgresql_slot:
     slot_name: physical_one
     db: ansible

 - name: Remove physical_one slot if exists
   become_user: postgres
   postgresql_slot:
     slot_name: physical_one
     db: ansible
     state: absent

 - name: Create logical_one logical slot to the database acme if doesn't exist
   postgresql_slot:
     name: logical_slot_one
     slot_type: logical
     state: present
     output_plugin: custom_decoder_one
     db: "acme"

 - name: Remove logical_one slot if exists from the cluster running on another host and non-standard port
   postgresql_slot:
     name: logical_one
     login_host: mydatabase.example.org
     port: 5433
     login_user: ourSuperuser
     login_password: thePassword
     state: absent

RETURN VALUES                   *postgresql_slot-return values*

   Common return values are documented here, the following are the fields unique to this module:

     Key   Returned                                                                                    Description
   name             Name of the slot
   string  always   Sample:
                    physical_one
   queries          List of executed queries.
   string  always   Sample:
                    ["SELECT pg_create_physical_replication_slot('physical_one', False, False)"]

STATUS                   *postgresql_slot-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • John Scalia (@jscalia)
     • Andrew Klychkov (@Andersson007)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *postgresql_slot-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/postgresql_slot_module.html
