SYNOPSIS                   *vmware_guest_snapshot*

     • This module can be used to create, delete and update snapshot(s) of the given virtual machine.
     • All parameters and VMware object names are case sensitive.

REQUIREMENTS                   *vmware_guest_snapshot-requirements*

   The below requirements are needed on the host that executes this module.

     • python >= 2.6
     • PyVmomi

PARAMETERS                   *vmware_guest_snapshot-parameters*

       Parameter     Choices/Defaults                                                                            Comments
   datacenter                         Destination datacenter for the deploy operation.
   string / required
   description       Default:         Define an arbitrary description to attach to snapshot.
   string            ""
                                      Destination folder, absolute or relative path to find an existing guest.
                                      This is required parameter, if name is supplied.
                                      The folder should include the datacenter. ESX's datacenter is ha-datacenter.
                                      Examples:
                                      folder: /ha-datacenter/vm
   folder                             folder: ha-datacenter/vm
   string                             folder: /datacenter1/vm
                                      folder: datacenter1/vm
                                      folder: /datacenter1/vm/folder1
                                      folder: datacenter1/vm/folder1
                                      folder: /folder1/datacenter1/vm
                                      folder: folder1/datacenter1/vm
                                      folder: /folder1/datacenter1/vm/folder2
   hostname                           The hostname or IP address of the vSphere vCenter or ESXi server.
   string                             If the value is not specified in the task, the value of environment variable VMWARE_HOST will be used instead.
                                      Environment variable support added in Ansible 2.6.
   memory_dump         Choices:       If set to true, memory dump of virtual machine is also included in snapshot.
   boolean             • no ←         Note that memory snapshots take time and resources, this will take longer time to create.
   added in 2.4        • yes          If virtual machine does not provide capability to take memory snapshot, then this flag is set to false.
   moid                               Managed Object ID of the instance to manage if known, this is a unique identifier only within a single vCenter instance.
   string                             This is required if name or uuid is not supplied.
   added in 2.9
   name                               Name of the virtual machine to work with.
   string                             This is required parameter, if uuid or moid is not supplied.
   name_match          Choices:
   string              • first ←      If multiple VMs matching the name, use the first or last found.
                       • last
   new_description
   string                             Value to change the description of an existing snapshot to.
   added in 2.5
   new_snapshot_name
   string                             Value to rename the existing snapshot to.
   added in 2.5
                                      The password of the vSphere vCenter or ESXi server.
   password                           If the value is not specified in the task, the value of environment variable VMWARE_PASSWORD will be used instead.
   string                             Environment variable support added in Ansible 2.6.
                                      aliases: pass, pwd
   port              Default:         The port number of the vSphere vCenter or ESXi server.
   integer           443              If the value is not specified in the task, the value of environment variable VMWARE_PORT will be used instead.
   added in 2.5                       Environment variable support added in Ansible 2.6.
   proxy_host                         Address of a proxy that will receive all HTTPS requests and relay them.
   string                             The format is a hostname or a IP.
   added in 2.9                       If the value is not specified in the task, the value of environment variable VMWARE_PROXY_HOST will be used instead.
                                      This feature depends on a version of pyvmomi greater than v6.7.1.2018.12
   proxy_port                         Port of the HTTP proxy that will receive all HTTPS requests and relay them.
   integer                            If the value is not specified in the task, the value of environment variable VMWARE_PROXY_PORT will be used instead.
   added in 2.9
   quiesce             Choices:       If set to true and virtual machine is powered on, it will quiesce the file system in virtual machine.
   boolean             • no ←         Note that VMware Tools are required for this flag.
   added in 2.4        • yes          If virtual machine is powered off or VMware Tools are not available, then this flag is set to false.
                                      If virtual machine does not provide capability to take quiesce snapshot, then this flag is set to false.
   remove_children     Choices:
   boolean             • no ←         If set to true and state is set to absent, then entire snapshot subtree is set for removal.
   added in 2.4        • yes
   snapshot_name                      Sets the snapshot name to manage.
   string                             This param is required only if state is not remove_all
                                      Manage snapshot(s) attached to a specific virtual machine.
                                      If set to present and snapshot absent, then will create a new snapshot with the given name.
                       Choices:       If set to present and snapshot present, then no changes are made.
   state               • present ←    If set to absent and snapshot present, then snapshot with the given name is removed.
   string / required   • absent       If set to absent and snapshot absent, then no changes are made.
                       • revert       If set to revert and snapshot present, then virtual machine state is reverted to the given snapshot.
                       • remove_all   If set to revert and snapshot absent, then no changes are made.
                                      If set to remove_all and snapshot(s) present, then all snapshot(s) will be removed.
                                      If set to remove_all and snapshot(s) absent, then no changes are made.
   use_instance_uuid   Choices:
   boolean             • no ←         Whether to use the VMware instance UUID rather than the BIOS UUID.
   added in 2.8        • yes
                                      The username of the vSphere vCenter or ESXi server.
   username                           If the value is not specified in the task, the value of environment variable VMWARE_USER will be used instead.
   string                             Environment variable support added in Ansible 2.6.
                                      aliases: admin, user
   uuid                               UUID of the instance to manage if known, this is VMware's BIOS UUID by default.
   string                             This is required if name or moid parameter is not supplied.
                       Choices:       Allows connection when SSL certificates are not valid. Set to false when certificates are not trusted.
   validate_certs      • no           If the value is not specified in the task, the value of environment variable VMWARE_VALIDATE_CERTS will be used instead.
   boolean             • yes ←        Environment variable support added in Ansible 2.6.
                                      If set to yes, please make sure Python >= 2.7.9 is installed on the given machine.

NOTES                   *vmware_guest_snapshot-notes*

   Note

     • Tested on vSphere 5.5, 6.0 and 6.5

EXAMPLES                   *vmware_guest_snapshot-examples*

 - name: Create a snapshot
   vmware_guest_snapshot:
     hostname: "{{ vcenter_hostname }}"
     username: "{{ vcenter_username }}"
     password: "{{ vcenter_password }}"
     datacenter: "{{ datacenter_name }}"
     folder: "/{{ datacenter_name }}/vm/"
     name: "{{ guest_name }}"
     state: present
     snapshot_name: snap1
     description: snap1_description
   delegate_to: localhost

 - name: Remove a snapshot
   vmware_guest_snapshot:
     hostname: "{{ vcenter_hostname }}"
     username: "{{ vcenter_username }}"
     password: "{{ vcenter_password }}"
     datacenter: "{{ datacenter_name }}"
     folder: "/{{ datacenter_name }}/vm/"
     name: "{{ guest_name }}"
     state: absent
     snapshot_name: snap1
   delegate_to: localhost

 - name: Revert to a snapshot
   vmware_guest_snapshot:
     hostname: "{{ vcenter_hostname }}"
     username: "{{ vcenter_username }}"
     password: "{{ vcenter_password }}"
     datacenter: "{{ datacenter_name }}"
     folder: "/{{ datacenter_name }}/vm/"
     name: "{{ guest_name }}"
     state: revert
     snapshot_name: snap1
   delegate_to: localhost

 - name: Remove all snapshots of a VM
   vmware_guest_snapshot:
     hostname: "{{ vcenter_hostname }}"
     username: "{{ vcenter_username }}"
     password: "{{ vcenter_password }}"
     datacenter: "{{ datacenter_name }}"
     folder: "/{{ datacenter_name }}/vm/"
     name: "{{ guest_name }}"
     state: remove_all
   delegate_to: localhost

 - name: Remove all snapshots of a VM using MoID
   vmware_guest_snapshot:
     hostname: "{{ vcenter_hostname }}"
     username: "{{ vcenter_username }}"
     password: "{{ vcenter_password }}"
     datacenter: "{{ datacenter_name }}"
     folder: "/{{ datacenter_name }}/vm/"
     moid: vm-42
     state: remove_all
   delegate_to: localhost

 - name: Take snapshot of a VM using quiesce and memory flag on
   vmware_guest_snapshot:
     hostname: "{{ vcenter_hostname }}"
     username: "{{ vcenter_username }}"
     password: "{{ vcenter_password }}"
     datacenter: "{{ datacenter_name }}"
     folder: "/{{ datacenter_name }}/vm/"
     name: "{{ guest_name }}"
     state: present
     snapshot_name: dummy_vm_snap_0001
     quiesce: yes
     memory_dump: yes
   delegate_to: localhost

 - name: Remove a snapshot and snapshot subtree
   vmware_guest_snapshot:
     hostname: "{{ vcenter_hostname }}"
     username: "{{ vcenter_username }}"
     password: "{{ vcenter_password }}"
     datacenter: "{{ datacenter_name }}"
     folder: "/{{ datacenter_name }}/vm/"
     name: "{{ guest_name }}"
     state: absent
     remove_children: yes
     snapshot_name: snap1
   delegate_to: localhost

 - name: Rename a snapshot
   vmware_guest_snapshot:
     hostname: "{{ vcenter_hostname }}"
     username: "{{ vcenter_username }}"
     password: "{{ vcenter_password }}"
     datacenter: "{{ datacenter_name }}"
     folder: "/{{ datacenter_name }}/vm/"
     name: "{{ guest_name }}"
     state: present
     snapshot_name: current_snap_name
     new_snapshot_name: im_renamed
     new_description: "{{ new_snapshot_description }}"
   delegate_to: localhost

RETURN VALUES                   *vmware_guest_snapshot-return values*

   Common return values are documented here, the following are the fields unique to this module:

         Key        Returned                                                                               Description
                             metadata about the virtual machine snapshots
   snapshot_results          Sample:
   dictionary       always   {'current_snapshot': {'creation_time': '2019-04-09T14:40:26.617427+00:00', 'description': 'Snapshot 4 example', 'id': 4, 'name': 'snapshot4', 'state': 'poweredOff'},
                             'snapshots': [{'creation_time': '2019-04-09T14:38:24.667543+00:00', 'description': 'Snapshot 3 example', 'id': 3, 'name': 'snapshot3', 'state': 'poweredOff'},
                             {'creation_time': '2019-04-09T14:40:26.617427+00:00', 'description': 'Snapshot 4 example', 'id': 4, 'name': 'snapshot4', 'state': 'poweredOff'}]}

STATUS                   *vmware_guest_snapshot-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Loic Blot (@nerzhul) <loic.blot@unix-experience.fr>

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *vmware_guest_snapshot-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/vmware_guest_snapshot_module.html
