SYNOPSIS                   *ovirt_template*

     • Module to manage virtual machine templates in oVirt/RHV.

REQUIREMENTS                   *ovirt_template-requirements*

   The below requirements are needed on the host that executes this module.

     • python >= 2.7
     • ovirt-engine-sdk-python >= 4.3.0

PARAMETERS                   *ovirt_template-parameters*

          Parameter         Choices/Defaults                                                                         Comments
   allow_partial_import       Choices:
   boolean                    • no           Boolean indication whether to allow partial registration of a template when state is registered.
   added in 2.4               • yes
   auth                                      Dictionary with values needed to create HTTP/HTTPS connection to oVirt:
   dictionary / required
                                             A PEM file containing the trusted CA certificates.
       ca_file                               The certificate presented by the server will be verified using these CA certificates.
       string                                If ca_file parameter is not set, system wide CA certificate store is used.
                                             Default value is set by OVIRT_CAFILE environment variable.
       headers                               Dictionary of HTTP headers to be added to each API call.
       dictionary
       hostname                              A string containing the hostname of the server, usually something like `server.example.com`.
       string                                Default value is set by OVIRT_HOSTNAME environment variable.
                                             Either url or hostname is required.
       insecure               Choices:
       boolean                • no           A boolean flag that indicates if the server TLS certificate and host name should be checked.
                              • yes
       kerberos               Choices:
       boolean                • no           A boolean flag indicating if Kerberos authentication should be used instead of the default basic authentication.
                              • yes
       password                              The password of the user.
       string / required                     Default value is set by OVIRT_PASSWORD environment variable.
       token                                 Token to be used instead of login with username/password.
       string                                Default value is set by OVIRT_TOKEN environment variable.
       url                                   A string containing the API URL of the server, usually something like `https://server.example.com/ovirt-engine/api`.
       string                                Default value is set by OVIRT_URL environment variable.
                                             Either url or hostname is required.
       username                              The name of the user, something like [email protected].
       string / required                     Default value is set by OVIRT_USERNAME environment variable.
   ballooning_enabled         Choices:       If true, use memory ballooning.
   boolean                    • no           Memory balloon is a guest device, which may be used to re-distribute / reclaim the host memory based on VM needs in a dynamic way. In this way it's
   added in 2.9               • yes          possible to create memory over commitment states.
   clone_name                                Name for importing Template from storage domain.
   -                                         If not defined, name will be used.
   added in 2.8
   clone_permissions          Choices:       If True then the permissions of the VM (only the direct ones, not the inherited ones) will be copied to the created template.
   boolean                    • no ←         This parameter is used only when state present.
                              • yes
   cloud_init
   -                                         Dictionary with values for Unix-like Virtual Machine initialization using cloud init.
   added in 2.9
       authorized_ssh_keys                   Use this SSH keys to login to Virtual Machine.
       -
       custom_script                         Cloud-init script which will be executed on Virtual Machine when deployed.
       -                                     This is appended to the end of the cloud-init script generated by any other options.
       dns_search                            DNS search domains to be configured on Virtual Machine.
       -
       dns_servers                           DNS servers to be configured on Virtual Machine.
       -
       host_name                             Hostname to be set to Virtual Machine when deployed.
       -
                              Choices:
       nic_boot_protocol      • none         Set boot protocol of the network interface of Virtual Machine.
       -                      • dhcp
                              • static
       nic_gateway                           If boot protocol is static, set this gateway to network interface of Virtual Machine.
       -
       nic_ip_address                        If boot protocol is static, set this IP address to network interface of Virtual Machine.
       -
       nic_name                              Set name to network interface of Virtual Machine.
       -
       nic_netmask                           If boot protocol is static, set this netmask to network interface of Virtual Machine.
       -
       nic_on_boot            Choices:
       boolean                • no           If True network interface will be set to start on boot.
                              • yes
       regenerate_ssh_keys    Choices:
       boolean                • no           If True SSH keys will be regenerated on Virtual Machine.
                              • yes
       root_password                         Password to be set for user specified by user_name parameter.
       -
       timezone                              Timezone to be set to Virtual Machine when deployed.
       -
       user_name                             Username to be used to set password to Virtual Machine when deployed.
       -
   cloud_init_nics                           List of dictionaries representing network interfaces to be setup by cloud init.
   -                                         This option is used, when user needs to setup more network interfaces via cloud init.
   added in 2.9                              If one network interface is enough, user should use cloud_init nic_" parameters. cloud_init nic_" parameters are merged with cloud_init_nics parameters.
       nic_boot_protocol                     Set boot protocol of the network interface of Virtual Machine. Can be one of none, dhcp or static.
       -
       nic_gateway                           If boot protocol is static, set this gateway to network interface of Virtual Machine.
       -
       nic_ip_address                        If boot protocol is static, set this IP address to network interface of Virtual Machine.
       -
       nic_name                              Set name to network interface of Virtual Machine.
       -
       nic_netmask                           If boot protocol is static, set this netmask to network interface of Virtual Machine.
       -
       nic_on_boot            Choices:
       boolean                • no           If True network interface will be set to start on boot.
                              • yes
   cluster                                   Name of the cluster, where template should be created/imported.
   -
   cluster_mappings                          Mapper which maps cluster name between Template's OVF and the destination cluster this Template should be registered to, relevant when state is
   -                                         registered. Cluster mapping is described by the following dictionary:
   added in 2.5
       dest_name                             The name of the destination cluster.
       -
       source_name                           The name of the source cluster.
       -
   cpu_profile                               CPU profile to be set to template.
   -
   description                               Description of the template.
   -
   domain_mappings                           Mapper which maps aaa domain name between Template's OVF and the destination aaa domain this Template should be registered to, relevant when state is
   -                                         registered. The aaa domain mapping is described by the following dictionary:
   added in 2.5
       dest_name                             The name of the destination aaa domain.
       -
       source_name                           The name of the source aaa domain.
       -
   exclusive                  Choices:
   boolean                    • no           When state is exported this parameter indicates if the existing templates with the same name should be overwritten.
                              • yes
   export_domain                             When state is exported or imported this parameter specifies the name of the export storage domain.
   -
   fetch_nested               Choices:       If True the module will fetch additional data from the API.
   boolean                    • no           It will fetch IDs of the VMs disks, snapshots, etc. User can configure to fetch other attributes of the nested entities by specifying nested_attributes.
                              • yes
   id
   -                                         ID of the template to be registered.
   added in 2.4
   image_disk                                When state is imported and image_provider is used this parameter specifies the name of disk to be imported as template.
   -                                         aliases: glance_image_disk_name
   image_provider                            When state is imported this parameter specifies the name of the image provider to be used.
   -
   io_threads
   -                                         Number of IO threads used by virtual machine. 0 means IO threading disabled.
   added in 2.7
   memory
   -                                         Amount of memory of the template. Prefix uses IEC 60027-2 standard (for example 1GiB, 1024MiB).
   added in 2.6
   memory_guaranteed                         Amount of minimal guaranteed memory of the template. Prefix uses IEC 60027-2 standard (for example 1GiB, 1024MiB).
   -                                         memory_guaranteed parameter can't be lower than memory parameter.
   added in 2.6
   memory_max
   -                                         Upper bound of template memory up to which memory hot-plug can be performed. Prefix uses IEC 60027-2 standard (for example 1GiB, 1024MiB).
   added in 2.6
   name                                      Name of the template to manage.
   -
   nested_attributes                         Specifies list of the attributes which should be fetched from the API.
   list                                      This parameter apply only when fetch_nested is true.
   nics
   -                                         List of NICs, which should be attached to Virtual Machine. NIC is described by following dictionary.
   added in 2.9
                              Choices:
       interface              • virtio ←     Type of the network interface.
       -                      • e1000
                              • rtl8139
       mac_address                           Custom MAC address of the network interface, by default it's obtained from MAC pool.
       -
       name                                  Name of the NIC.
       -
       profile_name                          Profile name where NIC should be attached.
       -
                                             Operating system of the template.
                                             Default value is set by oVirt/RHV engine.
   operating_system                          Possible values: debian_7, freebsd, freebsdx64, other, other_linux, other_linux_kernel_4, other_linux_ppc64, other_linux_s390x, other_ppc64,
   -                                         other_s390x, rhcos_x64, rhel_3, rhel_3x64, rhel_4, rhel_4x64, rhel_5, rhel_5x64, rhel_6, rhel_6_9_plus_ppc64, rhel_6_ppc64, rhel_6x64, rhel_7_ppc64,
   added in 2.6                              rhel_7_s390x, rhel_7x64, rhel_8x64, rhel_atomic7x64, sles_11, sles_11_ppc64, sles_12_s390x, ubuntu_12_04, ubuntu_12_10, ubuntu_13_04, ubuntu_13_10,
                                             ubuntu_14_04, ubuntu_14_04_ppc64, ubuntu_16_04_s390x, windows_10, windows_10x64, windows_2003, windows_2003x64, windows_2008, windows_2008R2x64,
                                             windows_2008x64, windows_2012R2x64, windows_2012x64, windows_2016x64, windows_2019x64, windows_7, windows_7x64, windows_8, windows_8x64, windows_xp
   poll_interval            Default:         Number of the seconds the module waits until another poll request on entity status is sent.
   integer                  3
   role_mappings                             Mapper which maps role name between Template's OVF and the destination role this Template should be registered to, relevant when state is registered.
   -                                         Role mapping is described by the following dictionary:
   added in 2.5
       dest_name                             The name of the destination role.
       -
       source_name                           The name of the source role.
       -
   seal                       Choices:       'Sealing' is an operation that erases all machine-specific configurations from a filesystem: This includes SSH keys, UDEV rules, MAC addresses, system
   boolean                    • no ←         ID, hostname, etc. If true subsequent virtual machines made from this template will avoid configuration inheritance.
   added in 2.5               • yes          This parameter is used only when state present.
   smartcard_enabled          Choices:
   boolean                    • no           If true, use smart card authentication.
   added in 2.9               • yes
   soundcard_enabled          Choices:
   boolean                    • no           If true, the sound card is added to the virtual machine.
   added in 2.9               • yes
   sso                        Choices:
   boolean                    • no           True enable Single Sign On by Guest Agent, False to disable it. By default is chosen by oVirt/RHV engine.
   added in 2.9               • yes
                              Choices:
                              • present ←
   state                      • absent       Should the template be present/absent/exported/imported/registered. When state is registered and the unregistered template's name belongs to an already
   -                          • exported     registered in engine template in the same DC then we fail to register the unregistered template.
                              • imported
                              • registered
   storage_domain                            When state is imported this parameter specifies the name of the destination data storage domain. When state is registered this parameter specifies the
   -                                         name of the data storage domain of the unregistered template.
   sysprep
   -                                         Dictionary with values for Windows Virtual Machine initialization using sysprep.
   added in 2.9
       active_directory_ou                   Active Directory Organizational Unit, to be used for login of user.
       -
       domain                                Domain to be set to Windows Virtual Machine.
       -
       host_name                             Hostname to be set to Virtual Machine when deployed.
       -
       input_locale                          Input localization of the Windows Virtual Machine.
       -
       org_name                              Organization name to be set to Windows Virtual Machine.
       -
       root_password                         Password to be set for username to Windows Virtual Machine.
       -
       system_locale                         System localization of the Windows Virtual Machine.
       -
       timezone                              Timezone to be set to Windows Virtual Machine.
       -
       ui_language                           UI language of the Windows Virtual Machine.
       -
       user_name                             Username to be used for set password to Windows Virtual Machine.
       -
       windows_license_key                   License key to be set to Windows Virtual Machine.
       -
   template_image_disk_name                  When state is imported and image_provider is used this parameter specifies the new name for imported disk, if omitted then image_disk name is used by
   -                                         default. This parameter is used only in case of importing disk image from Glance domain.
   added in 2.4
   timeout                  Default:         The amount of time in seconds the module should wait for the instance to get into desired state.
   integer                  180
   timezone                                  Sets time zone offset of the guest hardware clock.
   -                                         For example Etc/GMT
   added in 2.9
   usb_support                Choices:
   boolean                    • no           True enable USB support, False to disable it. By default is chosen by oVirt/RHV engine.
   added in 2.9               • yes
   version                                   name - The name of this version.
   -                                         number - The index of this version in the versions hierarchy of the template. Used for editing of sub template.
   added in 2.8
   vm                                        Name of the VM, which will be used to create template.
   -
   vnic_profile_mappings                     Mapper which maps an external virtual NIC profile to one that exists in the engine when state is registered. vnic_profile is described by the following
   -                                         dictionary:
   added in 2.5
       source_network_name                   The network name of the source network.
       -
       source_profile_name                   The profile name related to the source network.
       -
       target_profile_id                     The id of the target profile id to be mapped to in the engine.
       -
   wait                       Choices:
   boolean                    • no           yes if the module should wait for the entity to get into desired state.
                              • yes ←

NOTES                   *ovirt_template-notes*

   Note

     • In order to use this module you have to install oVirt Python SDK. To ensure it’s installed with correct version you can create the following task: pip: name=ovirt-engine-sdk-python
       version=4.3.0

EXAMPLES                   *ovirt_template-examples*

 # Examples don't contain auth parameter for simplicity,
 # look at ovirt_auth module to see how to reuse authentication:

 # Create template from vm
 - ovirt_template:
     cluster: Default
     name: mytemplate
     vm: rhel7
     cpu_profile: Default
     description: Test

 # Import template
 - ovirt_template:
   state: imported
   name: mytemplate
   export_domain: myexport
   storage_domain: mystorage
   cluster: mycluster

 # Remove template
 - ovirt_template:
     state: absent
     name: mytemplate

 # Change Template Name
 - ovirt_template:
     id: 00000000-0000-0000-0000-000000000000
     name: "new_template_name"

 # Register template
 - ovirt_template:
   state: registered
   storage_domain: mystorage
   cluster: mycluster
   name: mytemplate

 # Register template using id
 - ovirt_template:
   state: registered
   storage_domain: mystorage
   cluster: mycluster
   id: 1111-1111-1111-1111

 # Register template, allowing partial import
 - ovirt_template:
   state: registered
   storage_domain: mystorage
   allow_partial_import: "True"
   cluster: mycluster
   id: 1111-1111-1111-1111

 # Register template with vnic profile mappings
 - ovirt_template:
     state: registered
     storage_domain: mystorage
     cluster: mycluster
     id: 1111-1111-1111-1111
     vnic_profile_mappings:
       - source_network_name: mynetwork
         source_profile_name: mynetwork
         target_profile_id: 3333-3333-3333-3333
       - source_network_name: mynetwork2
         source_profile_name: mynetwork2
         target_profile_id: 4444-4444-4444-4444

 # Register template with mapping
 - ovirt_template:
     state: registered
     storage_domain: mystorage
     cluster: mycluster
     id: 1111-1111-1111-1111
     role_mappings:
       - source_name: Role_A
         dest_name: Role_B
     domain_mappings:
       - source_name: Domain_A
         dest_name: Domain_B
     cluster_mappings:
       - source_name: cluster_A
         dest_name: cluster_B

 # Import image from Glance s a template
 - ovirt_template:
     state: imported
     name: mytemplate
     image_disk: "centos7"
     template_image_disk_name: centos7_from_glance
     image_provider: "glance_domain"
     storage_domain: mystorage
     cluster: mycluster

 # Edit template subversion
 - ovirt_template:
     cluster: mycluster
     name: mytemplate
     vm: rhel7
     version:
         number: 2
         name: subversion

 # Create new template subversion
 - ovirt_template:
     cluster: mycluster
     name: mytemplate
     vm: rhel7
     version:
         name: subversion

 - name: Template with cloud init
   ovirt_template:
     name: mytemplate
     cluster: Default
     memory: 1GiB
     cloud_init:
       nic_boot_protocol: static
       nic_ip_address: 10.34.60.86
       nic_netmask: 255.255.252.0
       nic_gateway: 10.34.63.254
       nic_name: eth1
       nic_on_boot: true
       host_name: example.com
       custom_script: |
         write_files:
          - content: |
              Hello, world!
            path: /tmp/greeting.txt
            permissions: '0644'
       user_name: root
       root_password: super_password

 - name: Template with cloud init, with multiple network interfaces
   ovirt_template:
     name: mytemplate
     cluster: mycluster
     cloud_init_nics:
     - nic_name: eth0
       nic_boot_protocol: dhcp
       nic_on_boot: true
     - nic_name: eth1
       nic_boot_protocol: static
       nic_ip_address: 10.34.60.86
       nic_netmask: 255.255.252.0
       nic_gateway: 10.34.63.254
       nic_on_boot: true

 - name: Template with timezone and nic
   ovirt_template:
     cluster: MyCluster
     name: mytemplate
     timezone: America/Godthab
     memory_max: 2Gib
     nics:
       - name: nic1

 - name: Template with sysprep
   ovirt_vm:
     name: windows2012R2_AD
     cluster: Default
     memory: 3GiB
     sysprep:
       host_name: windowsad.example.com
       user_name: Administrator
       root_password: SuperPassword123

RETURN VALUES                   *ovirt_template-return values*

   Common return values are documented here, the following are the fields unique to this module:

      Key     Returned                                                                                  Description
              On
              success  ID of the template which is managed
   id         if       Sample:
   string     template 7de90f31-222c-436c-a1ca-7e655bd5b60c
              is
              found.
              On
              success
   template   if       Dictionary of all the template attributes. Template attributes can be found on your oVirt/RHV instance at following url:
   dictionary template http://ovirt.github.io/ovirt-engine-api-model/master/#types/template.
              is
              found.

STATUS                   *ovirt_template-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Ondra Machacek (@machacekondra)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *ovirt_template-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/ovirt_template_module.html
