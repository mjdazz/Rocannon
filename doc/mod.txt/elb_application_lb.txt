SYNOPSIS                   *elb_application_lb*

     • Manage an AWS Application Elastic Load Balancer. See https://aws.amazon.com/blogs/aws/new-aws-application-load-balancer/ for details.

REQUIREMENTS                   *elb_application_lb-requirements*

   The below requirements are needed on the host that executes this module.

     • boto
     • boto3
     • python >= 2.6

PARAMETERS                   *elb_application_lb-parameters*

            Parameter             Choices/Defaults                                                                       Comments
   access_logs_enabled            Choices:
   boolean                        • no                Whether or not to enable access logs. When true, access_logs_s3_bucket must be set.
                                  • yes
                                                      The name of the S3 bucket for the access logs.
   access_logs_s3_bucket                              Required if access logs in Amazon S3 are enabled.
   -                                                  The bucket must exist in the same region as the load balancer and have a bucket policy that grants Elastic Load Balancing permission to write
                                                      to the bucket.
   access_logs_s3_prefix                              The prefix for the log location in the S3 bucket.
   -                                                  If you don't specify a prefix, the access logs are stored in the root of the bucket.
                                                      Cannot begin or end with a slash.
   aws_access_key                                     AWS access key. If not set then the value of the AWS_ACCESS_KEY_ID, AWS_ACCESS_KEY or EC2_ACCESS_KEY environment variable is used.
   string                                             aliases: ec2_access_key, access_key
   aws_secret_key                                     AWS secret key. If not set then the value of the AWS_SECRET_ACCESS_KEY, AWS_SECRET_KEY, or EC2_SECRET_KEY environment variable is used.
   string                                             aliases: ec2_secret_key, secret_key
   debug_botocore_endpoint_logs   Choices:            Use a botocore.endpoint logger to parse the unique (rather than total) "resource:action" API calls made during a task, outputing the set to the
   boolean                        • no ←              resource_actions key in the task results. Use the aws_resource_action callback to output to total list made during a playbook. The
   added in 2.8                   • yes               ANSIBLE_DEBUG_BOTOCORE_LOGS environment variable may also be used.
   deletion_protection            Choices:
   boolean                        • no ←              Indicates whether deletion protection for the ELB is enabled.
                                  • yes
   ec2_url                                            Url to use to connect to EC2 or your Eucalyptus cloud (by default the module will use EC2 endpoints). Ignored for modules where region is
   string                                             required. Must be specified for all other modules if region is not used. If not set then the value of the EC2_URL environment variable, if any,
                                                      is used.
   http2                          Choices:
   boolean                        • no ←              Indicates whether to enable HTTP2 routing.
   added in 2.6                   • yes
   idle_timeout                 Default:              The number of seconds to wait before an idle connection is closed.
   -                            60
   listeners                                          A list of dicts containing listeners to attach to the ELB. See examples for detail of the dict required. Note that listener keys are
   -                                                  CamelCased.
   name                                               The name of the load balancer. This name must be unique within your AWS account, can have a maximum of 32 characters, must contain only
   - / required                                       alphanumeric characters or hyphens, and must not begin or end with a hyphen.
   profile                                            Uses a boto profile. Only works with boto >= 2.24.0.
   string
   purge_listeners                Choices:            If yes, existing listeners will be purged from the ELB to match exactly what is defined by listeners parameter. If the listeners parameter is
   boolean                        • no                not set then listeners will not be modified
                                  • yes ←
   purge_rules                    Choices:
   boolean                        • no                When set to no, keep the existing load balancer rules in place. Will modify and add, but will not delete.
   added in 2.7                   • yes ←
   purge_tags                     Choices:            If yes, existing tags will be purged from the resource to match exactly what is defined by tags parameter. If the tags parameter is not set
   boolean                        • no                then tags will not be modified.
                                  • yes ←
   region                                             The AWS region to use. If not specified then the value of the AWS_REGION or EC2_REGION environment variable, if any, is used. See
   string                                             http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region
                                                      aliases: aws_region, ec2_region
   scheme                         Choices:
   -                              • internet-facing ← Internet-facing or internal load balancer. An ELB scheme can not be modified after creation.
                                  • internal
   security_groups              Default:              A list of the names or IDs of the security groups to assign to the load balancer. Required if state=present.
   -                            []
   security_token                                     AWS STS security token. If not set then the value of the AWS_SECURITY_TOKEN or EC2_SECURITY_TOKEN environment variable is used.
   string                                             aliases: access_token
   state                          Choices:
   -                              • present ←         Create or destroy the load balancer.
                                  • absent
   subnets                                            A list of the IDs of the subnets to attach to the load balancer. You can specify only one subnet per Availability Zone. You must specify
   -                                                  subnets from at least two Availability Zones. Required if state=present.
   tags                                               A dictionary of one or more tags to assign to the load balancer.
   -
   validate_certs                 Choices:
   boolean                        • no                When set to "no", SSL certificates will not be validated for boto versions >= 2.6.0.
                                  • yes ←
   wait                           Choices:            Wait for the load balancer to have a state of 'active' before completing. A status check is performed every 15 seconds until a successful state
   boolean                        • no ←              is reached. An error is returned after 40 failed checks.
   added in 2.6                   • yes
   wait_timeout
   -                                                  The time in seconds to use in conjunction with wait.
   added in 2.6

NOTES                   *elb_application_lb-notes*

   Note

     • Listeners are matched based on port. If a listener’s port is changed then a new listener will be created.
     • Listener rules are matched based on priority. If a rule’s priority is changed then a new rule will be created.
     • If parameters are not set within the module, the following environment variables can be used in decreasing order of precedence AWS_URL or EC2_URL, AWS_ACCESS_KEY_ID or AWS_ACCESS_KEY or
       EC2_ACCESS_KEY, AWS_SECRET_ACCESS_KEY or AWS_SECRET_KEY or EC2_SECRET_KEY, AWS_SECURITY_TOKEN or EC2_SECURITY_TOKEN, AWS_REGION or EC2_REGION
     • Ansible uses the boto configuration file (typically ~/.boto) if no credentials are provided. See https://boto.readthedocs.io/en/latest/boto_config_tut.html
     • AWS_REGION or EC2_REGION can be typically be used to specify the AWS region, when required, but this can also be configured in the boto config file

EXAMPLES                   *elb_application_lb-examples*

 # Note: These examples do not set authentication details, see the AWS Guide for details.

 # Create an ELB and attach a listener
 - elb_application_lb:
     name: myelb
     security_groups:
       - sg-12345678
       - my-sec-group
     subnets:
       - subnet-012345678
       - subnet-abcdef000
     listeners:
       - Protocol: HTTP # Required. The protocol for connections from clients to the load balancer (HTTP or HTTPS) (case-sensitive).
         Port: 80 # Required. The port on which the load balancer is listening.
         # The security policy that defines which ciphers and protocols are supported. The default is the current predefined security policy.
         SslPolicy: ELBSecurityPolicy-2015-05
         Certificates: # The ARN of the certificate (only one certficate ARN should be provided)
           - CertificateArn: arn:aws:iam::12345678987:server-certificate/test.domain.com
         DefaultActions:
           - Type: forward # Required.
             TargetGroupName: # Required. The name of the target group
     state: present

 # Create an ELB and attach a listener with logging enabled
 - elb_application_lb:
     access_logs_enabled: yes
     access_logs_s3_bucket: mybucket
     access_logs_s3_prefix: "logs"
     name: myelb
     security_groups:
       - sg-12345678
       - my-sec-group
     subnets:
       - subnet-012345678
       - subnet-abcdef000
     listeners:
       - Protocol: HTTP # Required. The protocol for connections from clients to the load balancer (HTTP or HTTPS) (case-sensitive).
         Port: 80 # Required. The port on which the load balancer is listening.
         # The security policy that defines which ciphers and protocols are supported. The default is the current predefined security policy.
         SslPolicy: ELBSecurityPolicy-2015-05
         Certificates: # The ARN of the certificate (only one certficate ARN should be provided)
           - CertificateArn: arn:aws:iam::12345678987:server-certificate/test.domain.com
         DefaultActions:
           - Type: forward # Required.
             TargetGroupName: # Required. The name of the target group
     state: present

 # Create an ALB with listeners and rules
 - elb_application_lb:
     name: test-alb
     subnets:
       - subnet-12345678
       - subnet-87654321
     security_groups:
       - sg-12345678
     scheme: internal
     listeners:
       - Protocol: HTTPS
         Port: 443
         DefaultActions:
           - Type: forward
             TargetGroupName: test-target-group
         Certificates:
           - CertificateArn: arn:aws:iam::12345678987:server-certificate/test.domain.com
         SslPolicy: ELBSecurityPolicy-2015-05
         Rules:
           - Conditions:
               - Field: path-pattern
                 Values:
                   - '/test'
             Priority: '1'
             Actions:
               - TargetGroupName: test-target-group
                 Type: forward
           - Conditions:
               - Field: path-pattern
                 Values:
                   - "/redirect-path/""
             Priority: '2'
             Actions:
               - Type: redirect
                 RedirectConfig:
                   Host: "#{host}"
                   Path: "/example/redir" # or /#{path}
                   Port: "#{port}"
                   Protocol: "#{protocol}"
                   Query: "#{query}"
                   StatusCode: "HTTP_302" # or HTTP_301
           - Conditions:
               - Field: path-pattern
                 Values:
                   - "/fixed-response-path/"
             Priority: '3'
             Actions:
               - Type: fixed-response
                 FixedResponseConfig:
                   ContentType: "text/plain"
                   MessageBody: "This is the page you're looking for"
                   StatusCode: "200"
           - Conditions:
               - Field: host-header
                 Values:
                   - "hostname.domain.com"
                   - "alternate.domain.com"
             Priority: '4'
             Actions:
               - TargetGroupName: test-target-group
                 Type: forward
     state: present

 # Remove an ELB
 - elb_application_lb:
     name: myelb
     state: absent

RETURN VALUES                   *elb_application_lb-return values*

   Common return values are documented here, the following are the fields unique to this module:

               Key                    Returned                                                                          Description
   access_logs_s3_bucket                              The name of the S3 bucket for the access logs.
   string                       when state is present Sample:
                                                      mys3bucket
   access_logs_s3_enabled                             Indicates whether access logs stored in Amazon S3 are enabled.
   string                       when state is present Sample:
                                                      True
   access_logs_s3_prefix                              The prefix for the location in the S3 bucket.
   string                       when state is present Sample:
                                                      my/logs
   availability_zones                                 The Availability Zones for the load balancer.
   list                         when state is present Sample:
                                                      [{'subnet_id': 'subnet-aabbccddff', 'zone_name': 'ap-southeast-2a'}]
   canonical_hosted_zone_id                           The ID of the Amazon Route 53 hosted zone associated with the load balancer.
   string                       when state is present Sample:
                                                      ABCDEF12345678
   created_time                                       The date and time the load balancer was created.
   string                       when state is present Sample:
                                                      2015-02-12T02:14:02+00:00
   deletion_protection_enabled                        Indicates whether deletion protection is enabled.
   string                       when state is present Sample:
                                                      True
   dns_name                                           The public DNS name of the load balancer.
   string                       when state is present Sample:
                                                      internal-my-elb-123456789.ap-southeast-2.elb.amazonaws.com
   idle_timeout_timeout_seconds                       The idle timeout value, in seconds.
   string                       when state is present Sample:
                                                      60
   ip_address_type                                    The type of IP addresses used by the subnets for the load balancer.
   string                       when state is present Sample:
                                                      ipv4
   listeners                    when state is present Information about the listeners.
   complex
          certificates          when state is present The SSL server certificate.
          complex
              certificate_arn   when state is present The Amazon Resource Name (ARN) of the certificate.
              string
          default_actions       when state is present The default actions for the listener.
          string
              target_group_arn  when state is present The Amazon Resource Name (ARN) of the target group.
              string
              type              when state is present The type of action.
              string
          listener_arn          when state is present The Amazon Resource Name (ARN) of the listener.
          string
          load_balancer_arn     when state is present The Amazon Resource Name (ARN) of the load balancer.
          string
          port                                        The port on which the load balancer is listening.
          integer               when state is present Sample:
                                                      80
          protocol                                    The protocol for connections from clients to the load balancer.
          string                when state is present Sample:
                                                      HTTPS
          ssl_policy            when state is present The security policy that defines which ciphers and protocols are supported.
          string
   load_balancer_arn                                  The Amazon Resource Name (ARN) of the load balancer.
   string                       when state is present Sample:
                                                      arn:aws:elasticloadbalancing:ap-southeast-2:0123456789:loadbalancer/app/my-elb/001122334455
   load_balancer_name                                 The name of the load balancer.
   string                       when state is present Sample:
                                                      my-elb
   routing_http2_enabled                              Indicates whether HTTP/2 is enabled.
   string                       when state is present Sample:
                                                      True
   scheme                                             Internet-facing or internal load balancer.
   string                       when state is present Sample:
                                                      internal
   security_groups                                    The IDs of the security groups for the load balancer.
   list                         when state is present Sample:
                                                      ['sg-0011223344']
   state                                              The state of the load balancer.
   dictionary                   when state is present Sample:
                                                      {'code': 'active'}
   tags                                               The tags attached to the load balancer.
   dictionary                   when state is present Sample:
                                                      { 'Tag': 'Example' }
   type                                               The type of load balancer.
   string                       when state is present Sample:
                                                      application
   vpc_id                                             The ID of the VPC for the load balancer.
   string                       when state is present Sample:
                                                      vpc-0011223344

STATUS                   *elb_application_lb-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Rob White (@wimnat)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *elb_application_lb-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/elb_application_lb_module.html
