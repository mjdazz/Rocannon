SYNOPSIS                   *certificate_complete_chain*

     • This module completes a given chain of certificates in PEM format by finding intermediate certificates from a given set of certificates, until it finds a root certificate in another given
       set of certificates.
     • This can for example be used to find the root certificate for a certificate chain returned by acme_certificate.
     • Note that this module does not check for validity of the chains. It only checks that issuer and subject match, and that the signature is correct. It ignores validity dates and key usage
       completely. If you need to verify that a generated chain is valid, please use openssl verify ....

REQUIREMENTS                   *certificate_complete_chain-requirements*

   The below requirements are needed on the host that executes this module.

     • cryptography >= 1.5

PARAMETERS                   *certificate_complete_chain-parameters*

           Parameter         Choices/Defaults                                                                        Comments
   input_chain                                A concatenated set of certificates in PEM format forming a chain.
   string / required                          The module will try to complete this chain.
                                              A list of filenames or directories.
                                              A filename is assumed to point to a file containing one or more certificates in PEM format. All certificates in this file will be added to the set of
   intermediate_certificates Default:         root certificates.
   list / elements=path      []               If a directory name is given, all files in the directory and its subdirectories will be scanned and tried to be parsed as concatenated certificates in
                                              PEM format.
                                              Symbolic links will be followed.
                                              A list of filenames or directories.
   root_certificates                          A filename is assumed to point to a file containing one or more certificates in PEM format. All certificates in this file will be added to the set of
   list / elements=path /                     root certificates.
   required                                   If a directory name is given, all files in the directory and its subdirectories will be scanned and tried to be parsed as concatenated certificates in
                                              PEM format.
                                              Symbolic links will be followed.

EXAMPLES                   *certificate_complete_chain-examples*

 # Given a leaf certificate for www.ansible.com and one or more intermediate
 # certificates, finds the associated root certificate.
 - name: Find root certificate
   certificate_complete_chain:
     input_chain: "{{ lookup('file', '/etc/ssl/csr/www.ansible.com-fullchain.pem') }}"
     root_certificates:
     - /etc/ca-certificates/
   register: www_ansible_com
 - name: Write root certificate to disk
   copy:
     dest: /etc/ssl/csr/www.ansible.com-root.pem
     content: "{{ www_ansible_com.root }}"

 # Given a leaf certificate for www.ansible.com, and a list of intermediate
 # certificates, finds the associated root certificate.
 - name: Find root certificate
   certificate_complete_chain:
     input_chain: "{{ lookup('file', '/etc/ssl/csr/www.ansible.com.pem') }}"
     intermediate_certificates:
     - /etc/ssl/csr/www.ansible.com-chain.pem
     root_certificates:
     - /etc/ca-certificates/
   register: www_ansible_com
 - name: Write complete chain to disk
   copy:
     dest: /etc/ssl/csr/www.ansible.com-completechain.pem
     content: "{{ ''.join(www_ansible_com.complete_chain) }}"
 - name: Write root chain (intermediates and root) to disk
   copy:
     dest: /etc/ssl/csr/www.ansible.com-rootchain.pem
     content: "{{ ''.join(www_ansible_com.chain) }}"

RETURN VALUES                   *certificate_complete_chain-return values*

   Common return values are documented here, the following are the fields unique to this module:

            Key           Returned                                                                            Description
   chain                  success  The chain added to the given input chain. Includes the root certificate.
   list / elements=string          Returned as a list of PEM certificates.
   complete_chain         success  The completed chain, including leaf, all intermediates, and root.
   list / elements=string          Returned as a list of PEM certificates.
   root                   success  The root certificate in PEM format.
   string

STATUS                   *certificate_complete_chain-status*

     • This module is not guaranteed to have a backwards compatible interface. [preview]
     • This module is maintained by the Ansible Community. [community]

     • Felix Fontein (@felixfontein)

   Hint

   If you notice any issues in this documentation, you can edit this document to improve it.

   ══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════

MORE INFO                          *certificate_complete_chain-moreinfo*
>
All arguments are omni-completed, but if you really want to see the online docs:
https://docs.ansible.com/ansible/latest/modules/certificate_complete_chain_module.html
